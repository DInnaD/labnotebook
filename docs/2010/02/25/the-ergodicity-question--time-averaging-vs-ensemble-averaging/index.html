<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Hugo 0.21" />
  <meta name="author" content="Carl Boettiger">
  

  
  
  
    
    
    <link rel="stylesheet" href="../../../../css/highlight.min.css">
    
  
  
  <link rel="stylesheet" href="../../../../css/bootstrap.min.css">
  <link rel="stylesheet" href="../../../../css/font-awesome.min.css">
  <link rel="stylesheet" href="../../../../css/academicons.min.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700|Merriweather|Roboto+Mono">
  
  
    <link rel="stylesheet" href="../../../../css/cboettig.css">
  
  
  <link rel="alternate" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">
  <link rel="feed" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">

  <link rel="icon" type="image/png" href="../../../../img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="../../../../img/apple-touch-icon.png">
  <link rel="canonical" href="../../../../2010/02/25/the-ergodicity-question--time-averaging-vs-ensemble-averaging/">


  <title>The Ergodicity Question- Time averaging vs Ensemble averaging | Boettiger Group</title>

</head>
<body id="top" data-spy="scroll" data-target="#navbar-main" data-offset="71">


<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../../../">Boettiger Group</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav navbar-right">
        

        

        <li class="nav-item">
          <a href="../../../../index.html">
            
            <span>Home</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../members/">
            
            <span>Members</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../vita/">
            
            <span>Publications</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../teaching/">
            
            <span>Teaching</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../lab-notebook">
            
            <span>Lab Notebook</span>
          </a>
        </li>

        
        
      </ul>

    </div>
  </div>
</nav>


<div class = "container">


<div class="row">
  <div class="col-md-7 col-md-offset-1">
    <article>
    <h1>The Ergodicity Question- Time averaging vs Ensemble averaging</h1> 
      
    

<p>11am &ndash; 3pm</p>

<ul>
<li>Tried time averaging over the entire time window (set sample_size
to 1 less than max time); in close agreement with the ensemble
predictions (getting around 1355).</li>
<li>Mystery doesn&rsquo;t seem to actually be a problem in the method, but
just innate variability! Even over reasonable time-averages and
ensemble averages there&rsquo;s significant deviation from the expected
variance! This variation around the warning signal/leading indicator
is exactly what might frustrate the warning signal. So within a run,
the observed variance averaged over a given window may fluctuate
significantly.</li>
</ul>

<p><img src="http://openwetware.org/images/thumb/c/ca/Falsealarmpng.png/400px-Falsealarmpng.png" alt="image" /></p>

<p><img src="../../../../skins/common/images/magnify-clip.png" alt="image" /></p>

<ul>
<li>Note that variance almost doubles just by chance, and the average
looks pretty close to the analytic calculation for these parameters
(1352). This samples every unit time on a window of 149 time units
(single replicate).</li>
<li>Code that produces this found in version 26 (run warning_signals
and then plot data with that version of plot.py). <strong>Note:</strong> seed was
randomized in this compile.</li>
<li>Gillespie header file has a flag to turn on random seed!</li>
</ul>

<h3 id="next-steps">Next Steps</h3>

<ul>
<li>Parallelization &ndash; restructure my_pars and record classes.</li>
<li>Compute variance in variance (and in other warning signals) across
ensembles. Shows not just the expected signal, but the collection of
possible signals. Think about analytic version of this calculation.</li>
<li>Update records class for these kinds of ensemble averaging. Ensemble
Variance in temporal mean with windowsize 1 will then give the
variance across ensembles alone, rather than calculating separately
(which I&rsquo;m currently using the ar1 and arN blocks to compute).</li>
</ul>

<p></p>

<h3 id="parallelizing-code">Parallelizing Code</h3>

<ul>
<li>Large ensemble averaging can benefit from relatively trivial
parallelization. Parallelizing other sections of the code will be
more demanding and less obviously an efficiency boost. I have been
doing basic parallelization for multicore, shared memory machines
using OpenMP, allowing me to take advantage of the up to eight cores
we have on the server (<code>one</code>.)</li>
<li>Makefile now has a make parallel option to call the compiler with
the openmp flag, <code>-f openmp</code></li>
<li>My first try added an OpenMP command to the Gillespie code to
parallelize the for loop over ensembles:</li>
</ul>

<p><syntax type="c"\></p>

<ol>
<li>pragma omp parallel for default(none) shared(rng, rate_fn, outcome)
private(lambda, t, tmp, i, check) firstprivate(rates_data,
my_pars)</li>
</ol>

<p>for(l = 0; l &lt; ensembles; l++){ </syntax\></p>

<p>I haven&rsquo;t worked with firstprivate before, but seems necessary for
dynamically allocated private variables. This isn&rsquo;t going to work, as
my_pars contains information that must be shared (like where the global
data is collected) and private (like the state variables). A successful
parallelization of this algorithm will require being more explicit.
Basically everything in <code>record</code> needs to be shared and the rest of
<code>my_pars</code> needs to be private&hellip;</p>

<p>As the random number generator is called in a different order in
parallel and serial runs I don&rsquo;t think I can compare values simply by
keeping constant seed, but I can compare convergent values.</p>

<ul>
<li><strong>Will need to separate my parameters data structure into global
recording data and private state variable data</strong> before the
Gillespie code can be effectively parallelized. Will need to
consider checks to prevent user from mismatching these.</li>
</ul>

<p><em>edit on Fri 26th</em></p>

<ul>
<li><p>Anything declared private in openmp must be initialized in the loop
or declared firstprivate instead. If it&rsquo;s dynamically allocated
compiler will complain about private but not firstprivate. Making a
copy of a constant pointer (as in promotions from void pointers)
lets you change the values of things it points to.</p></li>

<li><p>Parallel code not very compatible with GSL&rsquo;s creative use of void
pointers as agnostic ways to pass parameters to functions. Fine for
shared parameters, creates a problem for private parameters. Using
restrict declaration might help with this, will need to investigate
further. Meanwhile, experimental directory has simplified code for
exploring the parallel error. currently cannot get time series to
cumulatively sum results from different replicates rather than
overwrite.</p></li>
</ul>

<p><em>edits Sun Feb 28</em></p>

<ul>
<li>Parallel code works if I can avoid firstprivate. this means
specifying predetermined size arrays for checkpts and my_pars
explicitly. Will have to figure out how to get openmp to work with
dynamically allocated variables. Time to actually spend some time in
openmp tutorials&hellip;</li>
</ul>

<p></p>

    </article>
  </div>
  <div class="col-md-4">
    <div class="sidebar">
      <aside prefix="og:http://ogp.me/ns/article#">
  
  
  
<div class="article-metadata">

  <p>
  <span class="article-date">
    <i class="fa fa-calendar"></i>
    
    <time datetime="2010-02-25 00:00:00 &#43;0000 UTC" itemprop="datePublished">
      Thu, Feb 25, 2010
    </time>
    
  </span>
  </p>
    

  <p>
  
  
  
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="../../../../categories/ecology">ecology</a
    >
    
  </span>
  
  
  </p>
  
  <p>
  
  
  
  <span class="article-tags">
    <i class="fa fa-tags"></i>
    
    <a href="../../../../tags/warning-signals">warning-signals</a
    >, 
    
    <a href="../../../../tags/code-tricks">code-tricks</a
    >
    
  </span>
  
  
  </p>

</div>

 
  <br />
  
  <p><a class="btn btn-default" rel="prev" href='../../../../2010/02/26/friday/'><i class="fa fa-chevron-left"></i> prev</a>
    <a class="btn btn-default" rel="next" href='../../../../2010/02/25/thursday/'>next <i class="fa fa-chevron-right"></i></a></p>

  <br />

  <p> <a class="btn btn-default" 
         href="https://github.com/cboettig/cboettig.github.io/commits/master/content/lab-notebook/2010-02-25-The-Ergodicity-Question--Time-averaging-vs-Ensemble-averaging.md"><i class="fa fa-clock-o"></i> history</a></p>

  <p> <i class="fa fa-barcode"></i> SHA: <a href="https://github.com/cboettig/cboettig.github.io/blob/9d9072923c46d635718a4624d6afff6b1ec2439f/content/lab-notebook/2010-02-25-The-Ergodicity-Question--Time-averaging-vs-Ensemble-averaging.md">9d90729</a></p> 


</aside>

    </div>
  </div>
</div>


<section id="comments">
  <div id="disqus_thread">
    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'cboettig';
    var disqus_identifier = '\/2010\/02\/25\/the-ergodicity-question--time-averaging-vs-ensemble-averaging\/';
    var disqus_title = 'The Ergodicity Question- Time averaging vs Ensemble averaging';
    var disqus_url = '\/2010\/02\/25\/the-ergodicity-question--time-averaging-vs-ensemble-averaging\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>
</section>


</div>

<footer class="site-footer">
  <hr />
  <div class="container">

  <div class="row">
    <div class="col-md-3 col-xs-4 socialicons" style="font-size:20px" typeof="foaf:Person" about="https://carlboettiger.info/#me">
      <p>
      <script type="text/javascript" src="../../../../js/obfuscate-email-link.js"></script> 

          <a rel="foaf:account" href="https://twitter.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Twitter'); 
             return false;"><span class="showtooltip" title="follow me on twitter (reading, discussing)"><i class="fa fa-twitter"></i></span></a> 

          <a rel="foaf:account" href="https://github.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Github'); 
             return false;"><span class="showtooltip" title="follow me on Github (code, research)"><i class="fa fa-github"></i></span></a>
           <a rel="foaf:weblog" type="application/atom+xml" href="../../../../index.xml"  
        class="showtooltip" title="RSS feeds for my blog-style entries." 
         onclick="recordOutboundLink(this, 'Outbound Links', 'RSS'); 
         return false;"><i class="fa fa-rss"></i></a>
       </p>
    </div>

    
    


    <div class="col-md-4 col-md-offset-1 col-xs-4">
	    <p><a onclick="recordOutboundLink(this, 'Outbound Links', 'ONS_claim'); return false;" href="http://onsclaims.wikispaces.com/"><img src="../../../../img/ons-aci2-icon.svg" alt="ONS" class="showtooltip" title="An Open Notebook Science (ONS) project claim: Entry provides all content (AC) immediately (I) or without significant delay.  See link for details"/></a></p>
    </div>


    <div class="col-md-3 col-md-offset-1 col-xs-4">
      <p>
      <a rel="license" property="http://creativecommons.org/ns#license" href="http://creativecommons.org/publicdomain/zero/1.0/" onclick="recordOutboundLink(this, 'Outbound Links', 'CC0'); return false;"><img src="../../../../img/cc-zero.svg" alt="CC0"/></a> 
      </p>
    </div>
  </div>
</footer>


    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/TweenMax.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/latest/plugins/ScrollToPlugin.min.js"></script>
    <script src="../../../../js/jquery-1.12.3.min.js"></script>
    <script src="../../../../js/bootstrap.min.js"></script>
    <script src="../../../../js/isotope.pkgd.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.1/imagesloaded.pkgd.min.js"></script>
    <script src="../../../../js/hugo-academic.js"></script>
    

    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-18401403-1', 'auto');
        ga('send', 'pageview');

         
        var links = document.querySelectorAll('a');
        Array.prototype.map.call(links, function(item) {
            if (item.host != document.location.host) {
                item.addEventListener('click', function() {
                    var action = item.getAttribute('data-action') || 'follow';
                    ga('send', 'event', 'outbound', action, item.href);
                });
            }
        });
    </script>
    

    
    
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
    </script>
    <script async src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML"></script>
    

  </body>
</html>

   
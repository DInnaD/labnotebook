<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Hugo 0.20.2" />
  <meta name="author" content="Carl Boettiger">
  

  
  
  
    
    
    <link rel="stylesheet" href="../../../../css/highlight.min.css">
    
  
  
  <link rel="stylesheet" href="../../../../css/bootstrap.min.css">
  <link rel="stylesheet" href="../../../../css/font-awesome.min.css">
  <link rel="stylesheet" href="../../../../css/academicons.min.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700|Merriweather|Roboto+Mono">
  
  
    <link rel="stylesheet" href="../../../../css/cboettig.css">
  
  
  <link rel="alternate" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">
  <link rel="feed" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">

  <link rel="icon" type="image/png" href="../../../../img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="../../../../img/apple-touch-icon.png">
  <link rel="canonical" href="../../../../2010/11/30/tues-fitting-the-limiting-ou-models-to-each-bifurcation/">


  <title>Tues: Fitting the limiting OU models to each bifurcation | Boettiger Group</title>

</head>
<body id="top" data-spy="scroll" data-target="#navbar-main" data-offset="71">


<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../../../">Boettiger Group</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav navbar-right">
        

        

        <li class="nav-item">
          <a href="../../../../index.html">
            
            <span>Home</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../members/">
            
            <span>Members</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../vita/">
            
            <span>Publications</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../teaching/">
            
            <span>Teaching</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../lab-notebook">
            
            <span>Lab Notebook</span>
          </a>
        </li>

        
        
      </ul>

    </div>
  </div>
</nav>


<div class="row">
  <div class="col-md-7 col-md-offset-1">
    <article>
    <h1>Tues: Fitting the limiting OU models to each bifurcation</h1> 
      
    

<p>Yesterday I derived the linearized SDEs for the saddle node bifurcation :</p>

<p>$$ dX = 2\sqrt{r(t)} (\sqrt{r(t)} + \theta -X) dt + \sigma \sqrt{\sqrt{r(t)}+\theta} dB_t $$</p>

<p>and the transcritical bifurcation</p>

<p>$$ dX = r(t) (K - X) dt + \sqrt{K} dB_t $$</p>

<p>Now to implement them for fitting by likelihood using generic $ r(t) $.  I go back to the warning() model implemented in sde_likelihood.R code.  We can just solve the odes directly:</p>

<pre><code class="language-r">
	moments &lt;- function(t,y,p){ 
		sqrtR &lt;- sqrt(R(t,pars)) 
		yd1 &lt;- 2*sqrtR*(sqrtR+pars['theta'] - y[1]) 
		yd2 &lt;- -2*sqrtR*y[2] + p[&quot;sigma&quot;]^2*(sqrtR+pars['theta'])
		list(c(yd1=yd1, yd2=yd2))
	}

</code></pre>

<p>See full code in likelihood_bifur_models.R, note the somewhat verbose apply calls simply handle a vector of initial conditions so the likelihood of the whole timeseries can be evaluated in a single function call.</p>

<p>Of course we can numerically integrate first, for the easier LTC mean:
$$
x\left( t\right) ={e}^{-\int \alpha\left( t\right) dt}\,\left( {e}^{\int \alpha\left( t\right) dt}\,\theta+c\right)
$$</p>

<p>and variance:
$$
x\left( t\right) ={e}^{-\int \alpha\left( t\right) dt}\,\left( {\sigma}^{2}\,\int {e}^{\int \alpha\left( t\right) dt}dt+c\right)
$$</p>

<p>and just finish off the generic integral numerically, though it is unclear whether that will actually be faster than the numerical ode.  For now I&rsquo;ll start with the ode solve approach.</p>

<h3 id="writing-up-class-constructs-for-these-linearized-models">Writing up Class constructs for these Linearized models</h3>

<p>All right, back from a few hours of coding and now have a nice lil <a href="https://github.com/cboettig/structured-populations/commit/91619e47e1cbdd65d5a1a5ae44bbaa7dcdc4ea0e#diff-0">library for Gaussian Processes</a>.  This should be much more efficient then writing out nearly identical functions for probability density, random sampling, likelihood and mle estimation.  Just specify the Gaussian process such as either of the above (<a href="https://github.com/cboettig/structured-populations/commit/91619e47e1cbdd65d5a1a5ae44bbaa7dcdc4ea0e#diff-1">see code</a>), and voila:</p>

<h4 id="linearized-transcritical-bifurcation-example">Linearized Transcritical Bifurcation example</h4>

<pre><code class="language-r">
&gt; source(&quot;../R/likelihood_bifur_models.R&quot;)
&gt; source(&quot;../R/gaussian_process.R&quot;)
&gt; 
&gt; gaussmodel &lt;- setLTC
&gt; 
&gt; pars &lt;- c(Ro=1, m=0, theta=1, sigma=1)
&gt; X &lt;- simulate.gauss(gaussmodel, pars, N=500, T=10)
&gt; start &lt;- c(Ro=.5, m=0, theta=.1, sigma=.1)
&gt; M &lt;- update.gauss(gaussmodel, start, X)
&gt; M$par
       Ro         m     theta     sigma 
 2.788049 -0.280440  1.296090  1.002597 


</code></pre>

<p>Which returns a nice convergence.</p>

<h4 id="linearized-saddle-node-bifurcation-example">Linearized Saddle Node Bifurcation example</h4>

<p>This model has more trouble with the default maxit, needs more to converge.  Also needs to avoid negative R values since it takes the square root (these produce the warnings).</p>

<pre><code class="language-r">
&gt; source(&quot;../R/likelihood_bifur_models.R&quot;)
&gt; source(&quot;../R/gaussian_process.R&quot;)
&gt; 
&gt; #gaussmodel &lt;- setLTC
&gt; gaussmodel &lt;- setLSN
&gt; 
&gt; pars &lt;- c(Ro=1, m=0, theta=1, sigma=1)
&gt; X &lt;- simulate.gauss(gaussmodel, pars, N=500, T=10)
&gt; start &lt;- c(Ro=.5, m=0, theta=.1, sigma=.1)
&gt;  M &lt;- update.gauss(gaussmodel, start, X, control=list(maxit=1000))
&gt; M$optim_output
$par
        Ro          m      theta      sigma 
2.04075853 0.01060771 0.57580070 1.02352678 

$value
[1] -86.25758

$counts
function gradient 
     641       NA 

$convergence
[1] 0

$message
NULL

</code></pre>

<p><a href="https://github.com/cboettig/structured-populations/commit/91619e47e1cbdd65d5a1a5ae44bbaa7dcdc4ea0e#diff-2">Full example code.</a></p>

<h3 id="real-time-series-and-proper-model-choice">&ldquo;Real&rdquo; time-series and proper model-choice</h3>

<p>With this machinery in place, can now test against some real timeseries (simulated from the ecological birth-death models, not directly from the linearized SDE), and also do model choice on the changing parameter.</p>

<p>For speed and efficiency the likelihood function will probably need to moved into C, takes a few minutes for a single maximum-likelihood fit.</p>

    </article>
  </div>
  <div class="col-md-4">
    <div class="sidebar">
      <aside prefix="og:http://ogp.me/ns/article#">
  
  
  
<div class="article-metadata">

  <p>
  <span class="article-date">
    <i class="fa fa-calendar"></i>
    
    <time datetime="2010-11-30 22:56:03 &#43;0000 UTC" itemprop="datePublished">
      Tue, Nov 30, 2010
    </time>
    
  </span>
  </p>
    

  <p>
  
  
  
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="../../../../categories/ecology">ecology</a
    >
    
  </span>
  
  
  </p>
  
  <p>
  
  
  
  <span class="article-tags">
    <i class="fa fa-tags"></i>
    
    <a href="../../../../tags/derivation">derivation</a
    >, 
    
    <a href="../../../../tags/warning-signals">warning-signals</a
    >
    
  </span>
  
  
  </p>

</div>

 
  <br />
  
  <p><a class="btn btn-default" rel="prev" href='Page%28%22Further%20treatment%20of%20the%20limiting%20models%22%29'><i class="icon-chevron-left"></i> prev</a>
    <a class="btn btn-default" rel="next" href='#ZgotmplZ'>next <i class="icon-chevron-right"></i></a></p>

  <br />

  <p> <a class="btn btn-default" 
         href="https://github.com/cboettig/cboettig.github.io/commits/master/content/lab-notebook/2010-11-30-tues-fitting-the-limiting-ou-models-to-each-bifurcation.md"><i class="icon-time"></i> history</a></p>

  <p> <i class="fa fa-barcode"></i> SHA: <a href="https://github.com/cboettig/cboettig.github.io/blob/2785abfe840b0094f2f939c64e6647ff25f766c8/content/lab-notebook/2010-11-30-tues-fitting-the-limiting-ou-models-to-each-bifurcation.md">2785abf</a></p> 


</aside>

    </div>
  </div>
</div>


<section id="comments">
  <div id="disqus_thread">
    
  </div>
</section>

<footer class="site-footer">
  <hr />
  <div class="container">

  <div class="row">
    <div class="col-md-3 col-xs-4 socialicons" style="font-size:20px" typeof="foaf:Person" about="https://carlboettiger.info/#me">
      <p>
      <script type="text/javascript" src="../../../../js/obfuscate-email-link.js"></script> 

          <a rel="foaf:account" href="https://twitter.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Twitter'); 
             return false;"><span class="showtooltip" title="follow me on twitter (reading, discussing)"><i class="fa fa-twitter"></i></span></a> 

          <a rel="foaf:account" href="https://github.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Github'); 
             return false;"><span class="showtooltip" title="follow me on Github (code, research)"><i class="fa fa-github"></i></span></a>
           <a rel="foaf:weblog" type="application/atom+xml" href="../../../../index.xml"  
        class="showtooltip" title="RSS feeds for my blog-style entries." 
         onclick="recordOutboundLink(this, 'Outbound Links', 'RSS'); 
         return false;"><i class="fa fa-rss"></i></a>
       </p>
    </div>

    
    


    <div class="col-md-4 col-md-offset-1 col-xs-4">
	    <p><a onclick="recordOutboundLink(this, 'Outbound Links', 'ONS_claim'); return false;" href="http://onsclaims.wikispaces.com/"><img src="../../../../img/ons-aci2-icon.svg" alt="ONS" class="showtooltip" title="An Open Notebook Science (ONS) project claim: Entry provides all content (AC) immediately (I) or without significant delay.  See link for details"/></a></p>
    </div>


    <div class="col-md-3 col-md-offset-1 col-xs-4">
      <p>
      <a rel="license" property="http://creativecommons.org/ns#license" href="http://creativecommons.org/publicdomain/zero/1.0/" onclick="recordOutboundLink(this, 'Outbound Links', 'CC0'); return false;"><img src="../../../../img/cc-zero.svg" alt="CC0"/></a> 
      </p>
    </div>
  </div>
</footer>


    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/TweenMax.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/latest/plugins/ScrollToPlugin.min.js"></script>
    <script src="../../../../js/jquery-1.12.3.min.js"></script>
    <script src="../../../../js/bootstrap.min.js"></script>
    <script src="../../../../js/isotope.pkgd.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.1/imagesloaded.pkgd.min.js"></script>
    <script src="../../../../js/hugo-academic.js"></script>
    

    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-18401403-1', 'auto');
        ga('send', 'pageview');

         
        var links = document.querySelectorAll('a');
        Array.prototype.map.call(links, function(item) {
            if (item.host != document.location.host) {
                item.addEventListener('click', function() {
                    var action = item.getAttribute('data-action') || 'follow';
                    ga('send', 'event', 'outbound', action, item.href);
                });
            }
        });
    </script>
    

    
    
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

 

<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Hugo 0.20.2" />
  <meta name="author" content="Carl Boettiger">
  

  
  
  
    
    
    <link rel="stylesheet" href="../../../../css/highlight.min.css">
    
  
  
  <link rel="stylesheet" href="../../../../css/bootstrap.min.css">
  <link rel="stylesheet" href="../../../../css/font-awesome.min.css">
  <link rel="stylesheet" href="../../../../css/academicons.min.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700|Merriweather|Roboto+Mono">
  
  
    <link rel="stylesheet" href="../../../../css/cboettig.css">
  
  
  <link rel="alternate" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">
  <link rel="feed" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">

  <link rel="icon" type="image/png" href="../../../../img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="../../../../img/apple-touch-icon.png">
  <link rel="canonical" href="../../../../2011/03/10/numerical-challenges-in-likelihood-estimation-of-time-dep-ou-models/">


  <title>Numerical challenges in likelihood estimation of time-dep OU models | Boettiger Group</title>

</head>
<body id="top" data-spy="scroll" data-target="#navbar-main" data-offset="71">


<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../../../">Boettiger Group</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav navbar-right">
        

        

        <li class="nav-item">
          <a href="../../../../index.html">
            
            <span>Home</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../members/">
            
            <span>Members</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../vita/">
            
            <span>Publications</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../teaching/">
            
            <span>Teaching</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../lab-notebook">
            
            <span>Lab Notebook</span>
          </a>
        </li>

        
        
      </ul>

    </div>
  </div>
</nav>


<div class="row">
  <div class="col-md-7 col-md-offset-1">
    <article>
    <h1>Numerical challenges in likelihood estimation of time-dep OU models</h1> 
      
    

<p>Worried about accurate maximum likelihood estimates of parameters, as the optimization could still converge on values not far from the starting conditions (not as surprising as the starting parameters are estimated intelligently first from the summary statistics) but could also vary depending on initial conditions.</p>

<p>Second, while it requires some re-parameterization, the stationary model for both linearized transcritical (LTC) bifurcation model and the linearized saddle-node (LSN) model are identically Ornstein-Uhlenbeck models.  As this model is stationary, it&rsquo;s unnecessary to continue numerically integrating the SDE to get the moments of the probability distribution, I can just use the analytic solution for the moments.  I&rsquo;ve written this in as a model class &ldquo;constOU&rdquo; in the likelihood_bifur_models.R library, which is of course much faster:</p>

<pre><code>constOU &lt;- function(Xo, to, t1, pars){
    Dt &lt;- t1 - to
    Ex &lt;- Xo*(1 - exp(-pars[&quot;Ro&quot;]*Dt)) + pars[&quot;theta&quot;]*exp(-pars[&quot;Ro&quot;]*Dt) 
    Vx &lt;- 0.5*pars[&quot;sigma&quot;]^2 *(1-exp(-2*pars[&quot;Ro&quot;]*Dt))/pars[&quot;Ro&quot;]
    if(pars['Ro'] &lt; 0 ) Vx = Inf 
    if(pars['sigma'] &lt; 0 ) Vx = Inf 
    return(list(Ex=Ex, Vx=Vx))
}
</code></pre>

<p>Turning these parameters into those used by LTC should not require any scaling, while the estimated Ro becomes root Ro in LSN.</p>

<p>As I explored earlier, with linear change in stability the analytic expression for the moments gives some integrals that can be solved, but still leaves some to be done numerically, so integrating the moment equations directly seems just as well.  Note that I&rsquo;m still using the Gaussian character of the model to integrate the moments, by using the linear noise approximation:</p>

<pre><code>## LSN
    moments &lt;- function(t,y,p){ 
        sqrtR &lt;- sqrt(R(t,pars)) 
        yd1 &lt;- 2*sqrtR*(sqrtR+pars['theta'] - y[1]) 
        yd2 &lt;- -2*sqrtR*y[2] + p[&quot;sigma&quot;]^2*(sqrtR+pars['theta'])
        list(c(yd1=yd1, yd2=yd2))
    }
## LTC
    moments &lt;- function(t,y,p){ 
        yd1 &lt;- R(t,pars)*(pars['theta'] - y[1]) 
        yd2 &lt;- -2*R(t,pars)*y[2] + p[&quot;sigma&quot;]^2 ##check?
        list(c(yd1=yd1, yd2=yd2))
    }
</code></pre>

<h3 id="improving-speed">Improving speed?</h3>

<p>Attempting to improve the speed of the time-dependent fits.  Most of the time is used by lsoda, not surprisingly.  Worried that this time was simply in the initialization/allocation/cleanup of the integrator, which has to be called for each timestep in every calculation of the likelihood.  If true, moving this into C I could have only a single allocation of the ode integrator which I could use for all timesteps, and I&rsquo;d get a substantial speed increase.</p>

<p>R&rsquo;s profile of time spent in lsoda:</p>

<pre><code>$by.total
                          total.time total.pct self.time self.pct
&quot;setmodel&quot;                    322.26      99.7      0.00      0.0
&quot;lapply&quot;                      322.06      99.6      0.62      0.2
&quot;&lt;anonymous&gt;&quot;                 321.96      99.6    122.98     38.0
&quot;setLTC&quot;                      321.60      99.4      0.04      0.0
&quot;FUN&quot;                         321.38      99.4      2.34      0.7
&quot;lik.gauss&quot;                   320.02      99.0      0.02      0.0
&quot;dc.gauss&quot;                    319.78      98.9      0.00      0.0
&quot;fn&quot;                          319.38      98.8      0.00      0.0
&quot;optim&quot;                       319.38      98.8      0.00      0.0
&quot;updateGauss&quot;                 319.38      98.8      0.00      0.0
&quot;lsoda&quot;                       318.88      98.6     15.56      4.8
&quot;.Call&quot;                       286.84      88.7     17.42      5.4
</code></pre>

<p>Not so much.  Whole day of coding, debugging a few typos, and still bad performance when given long time intervals for the ode.  Not clear why this is happening.  See <a href="https://github.com/cboettig/structured-populations/commit/57b3ef3b9272bb656006b227ad7809e6d9bcb865">code here</a>, may simply pull from future package.</p>

<p>Estimating Ro and the initial step-size for Nelder-Meade seem to be related to the issue &ndash; shrinking the step-size reduces the optimizer stalling, as does removing the dependence on &ldquo;m&rdquo; (the time-dependence) in the integration.</p>

<h4 id="no-go">No go</h4>

<p><img src="http://farm6.staticflickr.com/5258/5517529987_8f209d24a8_o.png" alt="" /></p>

<p>Whether the time is really being lost in the allocation also isn&rsquo;t clear.  We can compare this at least in the context of the C code:  5399 runs code initializing only once per likelihood calc (over 50 pts).  Most time is spent applying the ode evolver.  5556 runs the code initializing every interval.  So overall doesn&rsquo;t seem like this approach can save as much time as I had hoped. Pity I couldn&rsquo;t get profile results from R&rsquo;s lsoda alloc first.  Lot of programming just to perform these profiles.<br />
<img src="http://farm6.staticflickr.com/5091/5518135110_0783b062e0_o.png" alt="" /></p>

<h3 id="better-optimized-searching">Better optimized searching</h3>

<p>Several decent approximation routines to the likelihood of a generic (i.e. including our time-heterogeneous coefficients) SDE in Iacus&rsquo;s sde package for R.  Should probably pursue these instead, and continue the R based implementation.  Need further study on convergence of estimates, but hopefully with faster likelihood optimization first.  Will require a bit more exploring.  Meanwhile, need more time on writing.</p>

    </article>
  </div>
  <div class="col-md-4">
    <div class="sidebar">
      <aside prefix="og:http://ogp.me/ns/article#">
  
  
  
<div class="article-metadata">

  <p>
  <span class="article-date">
    <i class="fa fa-calendar"></i>
    
    <time datetime="2011-03-10 23:46:46 &#43;0000 UTC" itemprop="datePublished">
      Thu, Mar 10, 2011
    </time>
    
  </span>
  </p>
    

  <p>
  
  
  
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="../../../../categories/ecology">ecology</a
    >
    
  </span>
  
  
  </p>
  
  <p>
  
  
  
  <span class="article-tags">
    <i class="fa fa-tags"></i>
    
    <a href="../../../../tags/warning-signals">warning-signals</a
    >
    
  </span>
  
  
  </p>

</div>

 
  <br />
  
  <p><a class="btn btn-default" rel="prev" href='../../../../2011/03/11/warning-signals-summary-stats-vs-likelihood-on-real-and-simulated-data/'><i class="fa fa-chevron-left"></i> prev</a>
    <a class="btn btn-default" rel="next" href='../../../../2011/03/09/warning-signals-data-examples/'>next <i class="fa fa-chevron-right"></i></a></p>

  <br />

  <p> <a class="btn btn-default" 
         href="https://github.com/cboettig/cboettig.github.io/commits/master/content/lab-notebook/2011-03-10-numerical-challenges-in-likelihood-estimation-of-time-dep-ou-models.md"><i class="fa fa-clock-o"></i> history</a></p>

  <p> <i class="fa fa-barcode"></i> SHA: <a href="https://github.com/cboettig/cboettig.github.io/blob/9d9072923c46d635718a4624d6afff6b1ec2439f/content/lab-notebook/2011-03-10-numerical-challenges-in-likelihood-estimation-of-time-dep-ou-models.md">9d9072923</a></p> 


</aside>

    </div>
  </div>
</div>


<section id="comments">
  <div id="disqus_thread">
    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'cboettig';
    var disqus_identifier = '\/2011\/03\/10\/numerical-challenges-in-likelihood-estimation-of-time-dep-ou-models\/';
    var disqus_title = 'Numerical challenges in likelihood estimation of time-dep OU models';
    var disqus_url = '\/2011\/03\/10\/numerical-challenges-in-likelihood-estimation-of-time-dep-ou-models\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>
</section>

<footer class="site-footer">
  <hr />
  <div class="container">

  <div class="row">
    <div class="col-md-3 col-xs-4 socialicons" style="font-size:20px" typeof="foaf:Person" about="https://carlboettiger.info/#me">
      <p>
      <script type="text/javascript" src="../../../../js/obfuscate-email-link.js"></script> 

          <a rel="foaf:account" href="https://twitter.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Twitter'); 
             return false;"><span class="showtooltip" title="follow me on twitter (reading, discussing)"><i class="fa fa-twitter"></i></span></a> 

          <a rel="foaf:account" href="https://github.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Github'); 
             return false;"><span class="showtooltip" title="follow me on Github (code, research)"><i class="fa fa-github"></i></span></a>
           <a rel="foaf:weblog" type="application/atom+xml" href="../../../../index.xml"  
        class="showtooltip" title="RSS feeds for my blog-style entries." 
         onclick="recordOutboundLink(this, 'Outbound Links', 'RSS'); 
         return false;"><i class="fa fa-rss"></i></a>
       </p>
    </div>

    
    


    <div class="col-md-4 col-md-offset-1 col-xs-4">
	    <p><a onclick="recordOutboundLink(this, 'Outbound Links', 'ONS_claim'); return false;" href="http://onsclaims.wikispaces.com/"><img src="../../../../img/ons-aci2-icon.svg" alt="ONS" class="showtooltip" title="An Open Notebook Science (ONS) project claim: Entry provides all content (AC) immediately (I) or without significant delay.  See link for details"/></a></p>
    </div>


    <div class="col-md-3 col-md-offset-1 col-xs-4">
      <p>
      <a rel="license" property="http://creativecommons.org/ns#license" href="http://creativecommons.org/publicdomain/zero/1.0/" onclick="recordOutboundLink(this, 'Outbound Links', 'CC0'); return false;"><img src="../../../../img/cc-zero.svg" alt="CC0"/></a> 
      </p>
    </div>
  </div>
</footer>


    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/TweenMax.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/latest/plugins/ScrollToPlugin.min.js"></script>
    <script src="../../../../js/jquery-1.12.3.min.js"></script>
    <script src="../../../../js/bootstrap.min.js"></script>
    <script src="../../../../js/isotope.pkgd.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.1/imagesloaded.pkgd.min.js"></script>
    <script src="../../../../js/hugo-academic.js"></script>
    

    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-18401403-1', 'auto');
        ga('send', 'pageview');

         
        var links = document.querySelectorAll('a');
        Array.prototype.map.call(links, function(item) {
            if (item.host != document.location.host) {
                item.addEventListener('click', function() {
                    var action = item.getAttribute('data-action') || 'follow';
                    ga('send', 'event', 'outbound', action, item.href);
                });
            }
        });
    </script>
    

    
    
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

 

<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Hugo 0.20.2" />
  <meta name="author" content="Carl Boettiger">
  

  
  
  
    
    
    <link rel="stylesheet" href="../../../../css/highlight.min.css">
    
  
  
  <link rel="stylesheet" href="../../../../css/bootstrap.min.css">
  <link rel="stylesheet" href="../../../../css/font-awesome.min.css">
  <link rel="stylesheet" href="../../../../css/academicons.min.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700|Merriweather|Roboto+Mono">
  
  
    <link rel="stylesheet" href="../../../../css/cboettig.css">
  
  
  <link rel="alternate" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">
  <link rel="feed" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">

  <link rel="icon" type="image/png" href="../../../../img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="../../../../img/apple-touch-icon.png">
  <link rel="canonical" href="../../../../2011/11/28/monday-11/">


  <title>Monday: submodels for full traits | Boettiger Group</title>

</head>
<body id="top" data-spy="scroll" data-target="#navbar-main" data-offset="71">


<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../../../">Boettiger Group</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav navbar-right">
        

        

        <li class="nav-item">
          <a href="../../../../index.html">
            
            <span>Home</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../members/">
            
            <span>Members</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../vita/">
            
            <span>Publications</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../teaching/">
            
            <span>Teaching</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../lab-notebook">
            
            <span>Lab Notebook</span>
          </a>
        </li>

        
        
      </ul>

    </div>
  </div>
</nav>


<div class="row">
  <div class="col-md-7 col-md-offset-1">
    <article>
    <h1>Monday: submodels for full traits</h1> 
      
    

<h2 id="two-shifts">Two shifts</h2>

<h3 id="alpha">alpha</h3>

<p><img src="http://farm7.staticflickr.com/6036/6419878719_2e7cee4b99_o.png" alt="" /></p>

<h3 id="sigma">sigma</h3>

<p><img src="http://farm8.staticflickr.com/7023/6419877949_4fab63904b_o.png" alt="" /></p>

<h3 id="likelihood">likelihood</h3>

<p><img src="http://farm8.staticflickr.com/7025/6419677919_6c5a5ee452_o.png" alt="" /></p>

<h2 id="pharyngeal-shift">Pharyngeal shift</h2>

<h3 id="alpha-1">alpha</h3>

<p><img src="http://farm8.staticflickr.com/7158/6419878253_5c03a39887_o.png" alt="" /></p>

<h3 id="sigma-1">sigma</h3>

<p><img src="http://farm8.staticflickr.com/7151/6420059863_83821a57ed_o.png" alt="" /></p>

<h3 id="likelihood-1">likelihood</h3>

<p><img src="http://farm8.staticflickr.com/7009/6419230695_ab5c45a489_o.png" alt="" /></p>

<h2 id="intramandibular-shift">Intramandibular shift</h2>

<h3 id="alpha-2">alpha</h3>

<p><img src="http://farm7.staticflickr.com/6211/6419877455_0dbff60168_o.png" alt="" /></p>

<h3 id="sigma-2">sigma</h3>

<p><img src="http://farm8.staticflickr.com/7170/6419876967_d785955d96_o.png" alt="" /></p>

<h3 id="likelihood-2">likelihood</h3>

<p><img src="http://farm8.staticflickr.com/7164/6419690343_d921fc12d6_o.png" alt="" /></p>

<h2 id="intramandibular-shift-parrotfish-only">Intramandibular shift (parrotfish only)</h2>

<h3 id="alpha-3">alpha</h3>

<p><img src="http://farm7.staticflickr.com/6112/6419878425_80f3297424_o.png" alt="" /></p>

<h3 id="sigma-3">sigma</h3>

<p><img src="http://farm7.staticflickr.com/6091/6419877923_f3819b9979_o.png" alt="" /></p>

<h3 id="likelihood-3">likelihood</h3>

<p><img src="http://farm8.staticflickr.com/7034/6416542987_2ed9f4e0d7_o.png" alt="" /></p>

<h2 id="troubleshooting">Troubleshooting</h2>

<p>It seems alpha is often higher in the regime that has a the higher sigma when variance is restricted to sigma.  This cannot be right.</p>

<p>Creating unit tests:</p>

<p>Sigma behaves correctly in the following way. Simulate data where regimes have different sigmas.</p>

<pre><code class="language-R">
require(wrightscape)
data(labrids)
s1_spec  &lt;- list(alpha = &quot;global&quot;, sigma = &quot;indep&quot;, theta = &quot;global&quot;)
s1 &lt;- multiTypeOU(data = dat[&quot;close&quot;], tree = tree, regimes = pharyngeal,
             model_spec = s1_spec,  control = list(maxit=5000))
# Order of entries in sigma is the order regime names are given by levels (alphabetical)
names(s1$sigma) &lt;- levels(pharyngeal)
s1$sigma[&quot;other&quot;] &lt;- .01
s1$sigma[&quot;pharyngeal&quot;] &lt;- 10
testcase &lt;- simulate(s1)[[1]]
testcase[pharyngeal==&quot;other&quot; &amp; !is.na(testcase) &amp; testcase != 0 ] -&gt; lowvar
testcase[pharyngeal!=&quot;other&quot; &amp; !is.na(testcase) &amp; testcase != 0 ] -&gt; highvar

</code></pre>

<p>Results check out.</p>

<pre><code class="language-R">
&gt; var(lowvar)
[1] 0.009888678
&gt; var(highvar)
[1] 12.22513
&gt; # and the recovered estimates are pretty close to the underlying simulation parameters
&gt; dummy &lt;- update(s1, testcase)
&gt; dummy$sigma
[1] 0.1015016 7.6793429
&gt; levels(pharyngeal)
[1] &quot;other&quot;      &quot;pharyngeal&quot;

</code></pre>

<p>lowvar indeed has the lower variance (the regime with smaller sigma).  And the higher sigma is estimated for the pharyngeal regime (with some expected error: 7.7 instead of 10, and 0.1 instead of 0.01).</p>

<p>BUT repeat with alpha:</p>

<pre><code class="language-R">
data(labrids)
a1_spec  &lt;- list(alpha = &quot;indep&quot;, sigma = &quot;global&quot;, theta = &quot;global&quot;)
a1 &lt;- multiTypeOU(data = dat[&quot;close&quot;], tree = tree, regimes = pharyngeal,
             model_spec = a1_spec,  control = list(maxit=5000))
names(a1$alpha) &lt;- levels(pharyngeal)

data(labrids)
a1_spec  &lt;- list(alpha = &quot;indep&quot;, sigma = &quot;global&quot;, theta = &quot;global&quot;)
a1 &lt;- multiTypeOU(data = dat[&quot;close&quot;], tree = tree, regimes = pharyngeal,
             model_spec = a1_spec,  control = list(maxit=5000))
names(a1$alpha) &lt;- levels(pharyngeal)
a1$alpha[&quot;other&quot;] &lt;- 10
a1$alpha[&quot;pharyngeal&quot;] &lt;- 1e-12
a1$sigma &lt;- c(5,5)
dat[[&quot;simulated_a1&quot;]] &lt;-simulate(a1)[[1]]
dummy &lt;- update(a1, dat[[&quot;simulated_a1&quot;]])

testcase &lt;- dat[[&quot;simulated_a1&quot;]]
testcase[pharyngeal==&quot;other&quot; &amp; !is.na(testcase) &amp; testcase != 0 ] -&gt; lowvar
testcase[pharyngeal!=&quot;other&quot; &amp; !is.na(testcase) &amp; testcase != 0 ] -&gt; highvar

</code></pre>

<p>and we get</p>

<pre><code class="language-R">
&gt; var(lowvar)
[1] 1.187643
&gt; var(highvar)
[1] 0.000385144
&gt; dummy$alpha
[1] 10.0551960  0.2670818

</code></pre>

<p>And the variances are backwards.  Note that the parameter estimates reasonably reflect the simulated regimes (other = 10.1, vs 10, intramandibular = 0.27 vs 1e-12).</p>

<p>How is this possible?  The indexing routine is handling the sigma case correctly, and the same code is used to handle the indexing of each.</p>

<p>Does this have anything to do with the simulation function: No.  We can recreate the issue by drawing data as iid variables instead of using the simulation along the tree:</p>

<pre><code class="language-R">
require(wrightscape)
data(labrids)
spec = list(alpha=&quot;indep&quot;, sigma=&quot;global&quot;, theta=&quot;global&quot;)
#spec = list(alpha=&quot;global&quot;, sigma=&quot;indep&quot;, theta=&quot;global&quot;)
testcase &lt;- dat[[&quot;prot.y&quot;]]
other.prot.data &lt;- testcase[intramandibular==&quot;other&quot; &amp; !is.na(testcase)]
intra.prot.data &lt;- testcase[intramandibular!=&quot;other&quot; &amp; !is.na(testcase)] 
## Set the distribution of &quot;other&quot;
testcase[intramandibular==&quot;other&quot; &amp; !is.na(testcase)] &lt;- rnorm(length(other.prot.data), sd=.1)
#Set the distribution of the focal trait
testcase[intramandibular!=&quot;other&quot; &amp; !is.na(testcase)] &lt;- rnorm(length(intra.prot.data), sd=10)

m &lt;- multiTypeOU(data=testcase, tree=tree, regimes=intramandibular, model_spec=spec)
names(m$sigma) &lt;- levels(intramandibular)
names(m$alpha) &lt;- levels(intramandibular)

</code></pre>

<p>The higher alpha is estimated on the regime that has higher variance</p>

<pre><code class="language-R">
&gt; print(m$alpha)
intramandibular           other 
      13.121679        5.981398 

</code></pre>

<p>The data has higher variance among the intramandibular traits.  (same is true for pharyngeal).  This problem does not face the sigmas model, hence appears to do with the indexing of alphas somehow.</p>

<p>Trying direct debug:</p>

<pre><code class="language-R">
require(wrightscape)
data(labrids)
spec = list(alpha=&quot;indep&quot;, sigma=&quot;global&quot;, theta=&quot;global&quot;)
testcase &lt;- dat[[&quot;prot.y&quot;]]
other.prot.data &lt;- testcase[intramandibular==&quot;other&quot; &amp; !is.na(testcase)]
intra.prot.data &lt;- testcase[intramandibular!=&quot;other&quot; &amp; !is.na(testcase)] 
testcase[intramandibular==&quot;other&quot; &amp; !is.na(testcase)] &lt;- rnorm(length(other.prot.data), sd=.1)
testcase[intramandibular!=&quot;other&quot; &amp; !is.na(testcase)] &lt;- rnorm(length(intra.prot.data), sd=10)

# Load internal functions
require(devtools)
load_all(&quot;..&quot;)
data &lt;- testcase
lca &lt;- lca_calc(tree)
multiOU_lik_lca(data, tree, intramandibular, alpha=c(2,7), sigma=c(16,5), theta=c(0.5, 0.5), Xo=0.5, lca)

</code></pre>

<p>Looks to be keeping the alpha with sigma at least.</p>

<p>Check that in global ou mode, smaller alphas fit high variance better:  (yup)</p>

<pre><code class="language-R">
# Test of single OU
test &lt;- dat[[&quot;prot.y&quot;]]
test[!is.na(test)] &lt;- rnorm(sum(!is.na(test)), sd=10)
ou  &lt;- list(alpha = &quot;global&quot;, sigma = &quot;global&quot;, theta = &quot;global&quot;)
m1 &lt;- multiTypeOU(data=test, tree=tree, regimes=intramandibular, model_spec=ou)
test[!is.na(test)] &lt;- rnorm(sum(!is.na(test)), sd=.1)
m2 &lt;- multiTypeOU(data=test, tree=tree, regimes=intramandibular, model_spec=ou)
m1$alpha # larger variance has smaller alpha
m2$alpha

</code></pre>

<p>All okay.  But compare fits</p>

<pre><code class="language-R">
testcase &lt;- dat[[&quot;prot.y&quot;]]
other.prot.data &lt;- testcase[intramandibular==&quot;other&quot; &amp; !is.na(testcase)]
intra.prot.data &lt;- testcase[intramandibular!=&quot;other&quot; &amp; !is.na(testcase)] 
testcase[intramandibular==&quot;other&quot; &amp; !is.na(testcase)] &lt;- rnorm(length(other.prot.data), sd=.1)
testcase[intramandibular!=&quot;other&quot; &amp; !is.na(testcase)] &lt;- rnorm(length(intra.prot.data), sd=10)
# Load internal functions
require(devtools)
load_all(&quot;..&quot;)
data &lt;- testcase
lca &lt;- lca_calc(tree)

# expect higher alpha on &quot;other&quot; (alpha2) to be best, higher on alpha1 is worst
# BUT NO!
&gt; multiOU_lik_lca(testcase, tree, intramandibular, alpha=c(2,2), sigma=c(5,5), theta=c(0.5, 0.5), Xo=0.5, lca)
[1] -1802.169
&gt; multiOU_lik_lca(testcase, tree, intramandibular, alpha=c(5,2), sigma=c(5,5), theta=c(0.5, 0.5), Xo=0.5, lca)
[1] -248.6667
&gt; multiOU_lik_lca(testcase, tree, intramandibular, alpha=c(2,5), sigma=c(5,5), theta=c(0.5, 0.5), Xo=0.5, lca)
[1] -110821.8



&gt; a1_spec  &lt;- list(alpha = &quot;indep&quot;, sigma = &quot;global&quot;, theta = &quot;global&quot;)
&gt; a1 &lt;- multiTypeOU(data=testcase, tree=tree, regimes=intramandibular, model_spec=a1_spec)
&gt; a1$alpha
[1] 14.165247  6.579535

</code></pre>

<p>[flickr-gallery mode=&ldquo;search&rdquo; tags=&ldquo;phylogenetics&rdquo; min_upload_date=&ldquo;2011-11-28 10:15:00&rdquo; max_upload_date=&ldquo;2011-11-28 10:30:20&rdquo;]</p>

    </article>
  </div>
  <div class="col-md-4">
    <div class="sidebar">
      <aside prefix="og:http://ogp.me/ns/article#">
  
  
  
<div class="article-metadata">

  <p>
  <span class="article-date">
    <i class="fa fa-calendar"></i>
    
    <time datetime="2011-11-28 11:00:24 &#43;0000 UTC" itemprop="datePublished">
      Mon, Nov 28, 2011
    </time>
    
  </span>
  </p>
    

  <p>
  
  
  
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="../../../../categories/evolution">evolution</a
    >
    
  </span>
  
  
  </p>
  
  <p>
  
  </p>

</div>

 
  <br />
  
  <p><a class="btn btn-default" rel="prev" href='../../../../2011/11/29/tuesday-debugging/'><i class="fa fa-chevron-left"></i> prev</a>
    <a class="btn btn-default" rel="next" href='../../../../2011/11/28/handling-other-sources-of-noise/'>next <i class="fa fa-chevron-right"></i></a></p>

  <br />

  <p> <a class="btn btn-default" 
         href="https://github.com/cboettig/cboettig.github.io/commits/master/content/lab-notebook/2011-11-28-monday-11.md"><i class="fa fa-clock-o"></i> history</a></p>

  <p> <i class="fa fa-barcode"></i> SHA: <a href="https://github.com/cboettig/cboettig.github.io/blob/21c35f18f26809fba50d510222998c5f9963fff4/content/lab-notebook/2011-11-28-monday-11.md">21c35f1</a></p> 


</aside>

    </div>
  </div>
</div>


<section id="comments">
  <div id="disqus_thread">
    
  </div>
</section>

<footer class="site-footer">
  <hr />
  <div class="container">

  <div class="row">
    <div class="col-md-3 col-xs-4 socialicons" style="font-size:20px" typeof="foaf:Person" about="https://carlboettiger.info/#me">
      <p>
      <script type="text/javascript" src="../../../../js/obfuscate-email-link.js"></script> 

          <a rel="foaf:account" href="https://twitter.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Twitter'); 
             return false;"><span class="showtooltip" title="follow me on twitter (reading, discussing)"><i class="fa fa-twitter"></i></span></a> 

          <a rel="foaf:account" href="https://github.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Github'); 
             return false;"><span class="showtooltip" title="follow me on Github (code, research)"><i class="fa fa-github"></i></span></a>
           <a rel="foaf:weblog" type="application/atom+xml" href="../../../../index.xml"  
        class="showtooltip" title="RSS feeds for my blog-style entries." 
         onclick="recordOutboundLink(this, 'Outbound Links', 'RSS'); 
         return false;"><i class="fa fa-rss"></i></a>
       </p>
    </div>

    
    


    <div class="col-md-4 col-md-offset-1 col-xs-4">
	    <p><a onclick="recordOutboundLink(this, 'Outbound Links', 'ONS_claim'); return false;" href="http://onsclaims.wikispaces.com/"><img src="../../../../img/ons-aci2-icon.svg" alt="ONS" class="showtooltip" title="An Open Notebook Science (ONS) project claim: Entry provides all content (AC) immediately (I) or without significant delay.  See link for details"/></a></p>
    </div>


    <div class="col-md-3 col-md-offset-1 col-xs-4">
      <p>
      <a rel="license" property="http://creativecommons.org/ns#license" href="http://creativecommons.org/publicdomain/zero/1.0/" onclick="recordOutboundLink(this, 'Outbound Links', 'CC0'); return false;"><img src="../../../../img/cc-zero.svg" alt="CC0"/></a> 
      </p>
    </div>
  </div>
</footer>


    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/TweenMax.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/latest/plugins/ScrollToPlugin.min.js"></script>
    <script src="../../../../js/jquery-1.12.3.min.js"></script>
    <script src="../../../../js/bootstrap.min.js"></script>
    <script src="../../../../js/isotope.pkgd.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.1/imagesloaded.pkgd.min.js"></script>
    <script src="../../../../js/hugo-academic.js"></script>
    

    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-18401403-1', 'auto');
        ga('send', 'pageview');

         
        var links = document.querySelectorAll('a');
        Array.prototype.map.call(links, function(item) {
            if (item.host != document.location.host) {
                item.addEventListener('click', function() {
                    var action = item.getAttribute('data-action') || 'follow';
                    ga('send', 'event', 'outbound', action, item.href);
                });
            }
        });
    </script>
    

    
    
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

 

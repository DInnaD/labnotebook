<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Hugo 0.20.2" />
  <meta name="author" content="Carl Boettiger">
  

  
  
  
    
    
    <link rel="stylesheet" href="../../../../css/highlight.min.css">
    
  
  
  <link rel="stylesheet" href="../../../../css/bootstrap.min.css">
  <link rel="stylesheet" href="../../../../css/font-awesome.min.css">
  <link rel="stylesheet" href="../../../../css/academicons.min.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700|Merriweather|Roboto+Mono">
  
  
    <link rel="stylesheet" href="../../../../css/cboettig.css">
  
  
  <link rel="alternate" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">
  <link rel="feed" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">

  <link rel="icon" type="image/png" href="../../../../img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="../../../../img/apple-touch-icon.png">
  <link rel="canonical" href="../../../../2011/05/19/algorithms-group-mcmcmc/">


  <title>Algorithms group: MCMCMC | Boettiger Group</title>

</head>
<body id="top" data-spy="scroll" data-target="#navbar-main" data-offset="71">


<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../../../">Boettiger Group</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav navbar-right">
        

        

        <li class="nav-item">
          <a href="../../../../index.html">
            
            <span>Home</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../members/">
            
            <span>Members</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../vita/">
            
            <span>Publications</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../teaching/">
            
            <span>Teaching</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../lab-notebook">
            
            <span>Lab Notebook</span>
          </a>
        </li>

        
        
      </ul>

    </div>
  </div>
</nav>


<div class="row">
  <div class="col-md-7 col-md-offset-1">
    <article>
    <h1>Algorithms group: MCMCMC</h1> 
      
    

<p>Discussed $\text{MC}^3$, the <a href="http://en.wikipedia.org/wiki/Bayesian_inference_in_phylogeny#Metropolis-coupled_MCMC_.28Geyer.29">Metropolis coupled Markov Chain Monte Carlo</a>, in Monday&rsquo;s algorithms group meeting, just getting around to posting code.  The MrBayes paper is a good reference for this (Altekar <em>et. al.</em> 2004).  Our<a href="https://gist.github.com/956311"> practice example</a> needed some debugging. I re-wrote a general purpose mcmcmc function in R to illustrate the algorithm, below.  Recall that it modifies our original MCMC in two ways.  The normal proposal step gets weighted by temperature, allowing heated chains to step downhill more often.  We draw a uniform (0,1) random number and accept the move R is larger than it, where:</p>

<p>$$ R = \min\left[ 1, \left( \frac{f(X|\theta^{\prime})}{f(X|\theta)} \times \frac{f(\theta^{\prime})}{f(\theta)} \right)^{\beta_i} \times \frac{q(\theta)}{q(\theta^{\prime})} \right] $$</p>

<p>where</p>

<p>$$ \beta_i = \frac{1}{1+\Delta T \times (i-1)} $$</p>

<p>for priors $ f(\theta) $, likelihood $ f(X|\theta) $, proposed parameters $ \theta^{\prime} $, and proposal density $ q(\theta) $</p>

<p>In this mode chains evolve along independently.  We occasionally propose a swap between chains, where the Hastings ratio takes on the specific form:</p>

<p>$$R = \min \left[1, \left( \frac{f(\theta_k|X)}{f(\theta_j|X)} \right)^{\beta_j} \left( \frac{f(\theta_j|X)}{f(\theta_k|X)}\right)^{\beta_k} \right]$$</p>

<p>Note that for the posterior $ f(\theta | X) $ we use $ f(X|\theta) f(\theta) $, just as in the single chain case, which is true modulo the normalization $ f(X) $.</p>

<p>[gist id=981399]</p>

<p>Note this code doesn&rsquo;t run anything, we have to specify temperature ratios $ \beta_i $, the likelihood function, and the prior, and then it can give us back chains.  Here&rsquo;s a trivial example based on our Gaussian process:</p>

<pre><code class="language-r">
## Observed Data
X &lt;- rnorm(20, 2, 5)

loglik &lt;- function(pars){
  ## The likelihood function
  sum( dnorm(X, mean=pars[1], sd=pars[2], log=TRUE) )
}
prior &lt;- function(pars){
1/pars[2]^2
#  dnorm(pars[1], 0, 1000, log=TRUE)+
 # dnorm(pars[2], 0, 1000, log=TRUE)
}

# chains can have different or matching starting conditions, will mix anyway
pars &lt;- list(c(1,2), c(1,2))

chains &lt;- mcmcmc_fn(pars, loglik, prior, MaxTime=1e3, indep=100, stepsizes=.02)

</code></pre>

<p>Works rather well:
<img src="http://farm4.staticflickr.com/3642/5752281143_ea460ec9a2_o.png" alt="" /></p>

<p>With different prior:</p>

<pre><code class="language-r">
prior &lt;- function(pars){
  dnorm(pars[1], 0, 1000, log=TRUE) + dexp(pars[2], 10, log=TRUE)
}

</code></pre>

<p>The run converges on an erroneous sigma value:</p>

<p><img src="http://farm6.staticflickr.com/5023/5752308597_18ec63132b_o.png" alt="" /></p>

<p>Longer runs don&rsquo;t seem to fix this, but increasing the number of sample points in the data (from 20 to say, to 200) does.</p>

<p>Plotting code:</p>

<pre><code class="language-r">

layout(t(matrix(c(1,1,2,3), nrow=2)))
par(cex.lab=1.5, cex.axis=1.5)
plot(chains[[2]][-burnin, 1], type='l', col=rgb(0,0,1,.8),
 main=&quot;mixing chains&quot;, ylab=&quot;log prob density&quot;)
lines(chains[[1]][-burnin, 1], col=&quot;black&quot;)
legend(&quot;bottomright&quot;, c(&quot;normal&quot;, &quot;heated&quot;), col=c(&quot;black&quot;, &quot;blue&quot;), lty=1,cex=1.5)
plot(density((chains[[1]][-burnin, 2])), lwd=3, main=&quot;mu&quot;)
#curve(dnorm(x, 0, 1000), add=TRUE, lty=2)
abline(v=2, col=&quot;red&quot;, lwd=2, lty=2)
plot(density((chains[[1]][-burnin, 3])), lwd=3, main=&quot;sigma&quot;)
#curve(dexp(x, 10), add=TRUE, lty=2)
abline(v=5, col=&quot;red&quot;, lwd=2, lty=2)


</code></pre>

<h2 id="references">References</h2>

<ul>
<li>Altekar G, Dwarkadas S, Huelsenbeck J and Ronquist F (2004).
&ldquo;Parallel Metropolis Coupled Markov Chain Monte Carlo For Bayesian Phylogenetic Inference.&rdquo;
<em>Bioinformatics</em>, <strong>20</strong>.
ISSN 1367-4803, <a href="http://dx.doi.org/10.1093/bioinformatics/btg427">http://dx.doi.org/10.1093/bioinformatics/btg427</a>.</li>
</ul>

    </article>
  </div>
  <div class="col-md-4">
    <div class="sidebar">
      <aside prefix="og:http://ogp.me/ns/article#">
  
  
  
<div class="article-metadata">

  <p>
  <span class="article-date">
    <i class="fa fa-calendar"></i>
    
    <time datetime="2011-05-19 12:52:34 &#43;0000 UTC" itemprop="datePublished">
      Thu, May 19, 2011
    </time>
    
  </span>
  </p>
    

  <p>
  
  
  
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="../../../../categories/evolution">evolution</a
    >
    
  </span>
  
  
  </p>
  
  <p>
  
  
  
  <span class="article-tags">
    <i class="fa fa-tags"></i>
    
    <a href="../../../../tags/algorithms">algorithms</a
    >
    
  </span>
  
  
  </p>

</div>

 
  <br />
  
  <p><a class="btn btn-default" rel="prev" href='../../../../2011/05/22/end-of-nceas-the-legacy-of-synthetic-data/'><i class="fa fa-chevron-left"></i> prev</a>
    <a class="btn btn-default" rel="next" href='../../../../2011/05/19/thursday-5/'>next <i class="fa fa-chevron-right"></i></a></p>

  <br />

  <p> <a class="btn btn-default" 
         href="https://github.com/cboettig/cboettig.github.io/commits/master/content/lab-notebook/2011-05-19-algorithms-group-mcmcmc.md"><i class="fa fa-clock-o"></i> history</a></p>

  <p> <i class="fa fa-barcode"></i> SHA: <a href="https://github.com/cboettig/cboettig.github.io/blob/21c35f18f26809fba50d510222998c5f9963fff4/content/lab-notebook/2011-05-19-algorithms-group-mcmcmc.md">21c35f1</a></p> 


</aside>

    </div>
  </div>
</div>


<section id="comments">
  <div id="disqus_thread">
    
  </div>
</section>

<footer class="site-footer">
  <hr />
  <div class="container">

  <div class="row">
    <div class="col-md-3 col-xs-4 socialicons" style="font-size:20px" typeof="foaf:Person" about="https://carlboettiger.info/#me">
      <p>
      <script type="text/javascript" src="../../../../js/obfuscate-email-link.js"></script> 

          <a rel="foaf:account" href="https://twitter.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Twitter'); 
             return false;"><span class="showtooltip" title="follow me on twitter (reading, discussing)"><i class="fa fa-twitter"></i></span></a> 

          <a rel="foaf:account" href="https://github.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Github'); 
             return false;"><span class="showtooltip" title="follow me on Github (code, research)"><i class="fa fa-github"></i></span></a>
           <a rel="foaf:weblog" type="application/atom+xml" href="../../../../index.xml"  
        class="showtooltip" title="RSS feeds for my blog-style entries." 
         onclick="recordOutboundLink(this, 'Outbound Links', 'RSS'); 
         return false;"><i class="fa fa-rss"></i></a>
       </p>
    </div>

    
    


    <div class="col-md-4 col-md-offset-1 col-xs-4">
	    <p><a onclick="recordOutboundLink(this, 'Outbound Links', 'ONS_claim'); return false;" href="http://onsclaims.wikispaces.com/"><img src="../../../../img/ons-aci2-icon.svg" alt="ONS" class="showtooltip" title="An Open Notebook Science (ONS) project claim: Entry provides all content (AC) immediately (I) or without significant delay.  See link for details"/></a></p>
    </div>


    <div class="col-md-3 col-md-offset-1 col-xs-4">
      <p>
      <a rel="license" property="http://creativecommons.org/ns#license" href="http://creativecommons.org/publicdomain/zero/1.0/" onclick="recordOutboundLink(this, 'Outbound Links', 'CC0'); return false;"><img src="../../../../img/cc-zero.svg" alt="CC0"/></a> 
      </p>
    </div>
  </div>
</footer>


    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/TweenMax.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/latest/plugins/ScrollToPlugin.min.js"></script>
    <script src="../../../../js/jquery-1.12.3.min.js"></script>
    <script src="../../../../js/bootstrap.min.js"></script>
    <script src="../../../../js/isotope.pkgd.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.1/imagesloaded.pkgd.min.js"></script>
    <script src="../../../../js/hugo-academic.js"></script>
    

    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-18401403-1', 'auto');
        ga('send', 'pageview');

         
        var links = document.querySelectorAll('a');
        Array.prototype.map.call(links, function(item) {
            if (item.host != document.location.host) {
                item.addEventListener('click', function() {
                    var action = item.getAttribute('data-action') || 'follow';
                    ga('send', 'event', 'outbound', action, item.href);
                });
            }
        });
    </script>
    

    
    
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

 

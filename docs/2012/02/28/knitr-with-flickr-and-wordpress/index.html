<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Hugo 0.20.2" />
  <meta name="author" content="Carl Boettiger">
  

  
  
  
    
    
    <link rel="stylesheet" href="../../../../css/highlight.min.css">
    
  
  
  <link rel="stylesheet" href="../../../../css/bootstrap.min.css">
  <link rel="stylesheet" href="../../../../css/font-awesome.min.css">
  <link rel="stylesheet" href="../../../../css/academicons.min.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700|Merriweather|Roboto+Mono">
  
  
    <link rel="stylesheet" href="../../../../css/cboettig.css">
  
  
  <link rel="alternate" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">
  <link rel="feed" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">

  <link rel="icon" type="image/png" href="../../../../img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="../../../../img/apple-touch-icon.png">
  <link rel="canonical" href="../../../../2012/02/28/knitr-with-flickr-and-wordpress/">


  <title>Knitr with flickr and wordpress | Boettiger Group</title>

</head>
<body id="top" data-spy="scroll" data-target="#navbar-main" data-offset="71">


<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../../../">Boettiger Group</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav navbar-right">
        

        

        <li class="nav-item">
          <a href="../../../../index.html">
            
            <span>Home</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../members/">
            
            <span>Members</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../vita/">
            
            <span>Publications</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../teaching/">
            
            <span>Teaching</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../lab-notebook">
            
            <span>Lab Notebook</span>
          </a>
        </li>

        
        
      </ul>

    </div>
  </div>
</nav>


<div class="row">
  <div class="col-md-7 col-md-offset-1">
    <article>
    <h1>Knitr with flickr and wordpress</h1> 
      
    

<p>It&rsquo;s amazing how nice it is to work with well-developed software.  It took me about 20 minutes to extend Yuhui&rsquo;s interface to allow me to upload images through flickr instead of imgur, and embed them into a wordpress blog using the shortcode from the flickr gallery plugin.</p>

<p>To do this, I just modified the hook used by the markdown format.  First, I define a quick R function that uploads to flickr and returns the flickr identifier number.  For the moment this is just calling<a href="http://search.cpan.org/~cpb/Flickr-Upload-1.32/flickr_upload"> a command-line flickr uploader</a>, though it should be straight-forward to replace this with something like <a href="http://www.omegahat.org/Rflickr/">Rflickr</a>.</p>

<pre><code class="language-r">
flickr &lt;- function(file, 
    tags = &quot;&quot;, description = &quot;&quot;, 
    public = TRUE) {
    out &lt;- system(paste(&quot;flickr_upload --tag=\&quot;&quot;, 
        tags, &quot; \&quot; --description=\&quot;&quot;, 
        description, &quot;\&quot;&quot;, 
        &quot; --public &quot;, as.integer(public), 
        file), intern = TRUE)
    gsub(&quot;.*ids=(\\d+)&quot;, 
        &quot;\\1&quot;, out[3])
}

</code></pre>

<p>Once we have such an uploading function, it&rsquo;s super simple to wrap into knitr.  I let my function be triggered by the same &ldquo;upload&rdquo; option that Yuhui introduced for imgur, but instead call the flickr function above,</p>

<pre><code class="language-r">
.flickr.url = function(x) {
    file = paste(x, collapse = &quot;.&quot;)
    if (opts_knit$get(&quot;upload&quot;)) {
        flickr(file)
    } else file
}

</code></pre>

<p>Lastly I define the function hook to run the upload and return the shortcode:</p>

<pre><code class="language-r">
hook_plot_flickr = function(x, 
    options) {
    sprintf(&quot;[flickr]%s[/flickr]&quot;, 
        .flickr.url(x))
}

</code></pre>

<p>I can then define a wordpress rendering environment by mapping the hooks to my choices.</p>

<pre><code class="language-r">
render_wordpress &lt;- function() {
    render_gfm()
    options(width = 30)
    opts_knit$set(upload = TRUE)
    output = function(x, 
        options) paste(&quot;[ code]\n&quot;, 
        x, &quot;[ /code]\n&quot;, 
        sep = &quot;&quot;)
    warning = function(x, 
        options) paste(&quot;[ code]\n&quot;, 
        x, &quot;[ /code]\n&quot;, 
        sep = &quot;&quot;)
    message = function(x, 
        options) paste(&quot;[ code]\n&quot;, 
        x, &quot;[ /code]\n&quot;, 
        sep = &quot;&quot;)
    inline = function(x, 
        options) paste(&quot;&lt;pre&gt;&quot;, 
        x, &quot;&lt;/pre&gt;&quot;, sep = &quot;&quot;)
    error = function(x, 
        options) paste(&quot;[ code]\n&quot;, 
        x, &quot;[ /code]\n&quot;, 
        sep = &quot;&quot;)
    source = function(x, 
        options) paste(&quot;[ code lang='r']\n&quot;, 
        x, &quot;[ /code]\n&quot;, 
        sep = &quot;&quot;)
    knit_hooks$set(output = output, 
        warning = warning, 
        message = message, 
        inline = inline, 
        error = error, 
        source = source, 
        plot = hook_plot_flickr)
}

</code></pre>

<p>Note that the rendering sets a custom 30 character width that fits my theme better. Now simply adding the call to render_wordpress in the header of my documents will render this in wordpress format.  If you&rsquo;re reading this on wordpress, it was already in the header. Any figures will embed as flickr shortcode:</p>

<pre><code class="language-r">
library(ggplot2)
qplot(hp, mpg, 
    data = mtcars) + geom_smooth()

</code></pre>

<p><img src="http://farm8.staticflickr.com/7184/6793394960_94c5a5b017_o.png" alt="" /></p>

<p>It would be nicer to have built this around flickR, and provide the urls so that the image can be used without the wordpress flickr shortcode. But for now, the real point is that it&rsquo;s intuitive to extend knitr to this very customized format, specific to my platform, my plugins, and my shortcodes, with minimal effort.  All thanks to Yuhui&rsquo;s very nice implementation of knitr.</p>

<h3 id="addendum">Addendum</h3>

<p>If we&rsquo;d rather upload the images to wordpress itself (seems sensible), this is also straight forward thanks to Duncan&rsquo;s RWordPress package on <a href="http://www.omegahat.org/">Omegahat</a>. Writing the hooks would look like this:</p>

<pre><code class="language-R">
.wordpress.url = function(x) {
  require(RWordPress)
  file = paste(x, collapse = '.')
  if (opts_knit$get('upload')) {
            fileUpload(file)$url
      } else file
}

</code></pre>

<p>Note that RWordPress will look for the login credentials defined in &ldquo;options&rdquo;, i.e. put something like this in your .Rprofile.</p>

<pre><code class="language-R">
options(WordPressLogin = c(userid = &quot;password&quot;),
    WordPressURL = &quot;http://www.yourdomain.com/xmlrpc.php&quot;)

</code></pre>

<p>We then just define a hook based on the hook_plot_html that uses the Wordpress URL.</p>

<pre><code class="language-r">
.hook_plot_wordpress = function(x, options) {
a = options$fig.align
  sprintf('&lt;img src=&quot;%s&quot; class=&quot;plot&quot; %s/&gt;\n', .wordpress.url(x),
          switch(a,
                 default = '',
                 left = 'style=&quot;float: left&quot;',
                 right = 'style=&quot;float: right&quot;',
                 center = 'style=&quot;margin: auto; display: block&quot;'))
}

</code></pre>

<p>Put this hook in the render function instead/or as an option, and we&rsquo;re good to go.</p>

<h3 id="addendum-ii">Addendum II</h3>

<p>knitr now supports additional uploading protocols out of the box.  For instance, uploading to wordpress just requires a call to knitr options specifying the upload function:</p>

<pre><code class="language-r">
opts_knit$set(upload.fun = function(file){
   library(RWordPress) 
   uploadFile(file)$url
  })

</code></pre>

<p>We could likewise specify the flickr function there, etc.  Note that I don&rsquo;t need to worry about the &ldquo;paste&rdquo; or &ldquo;else&rdquo; conditions either, that&rsquo;s all handled automatically now.  Just specify an upload function and we&rsquo;re good to go.</p>

<p>Minor you (I) might think the one-line namespace call could be used instead of loading the library:</p>

<pre><code class="language-R">
RWordPress::uploadFile(file)$url

</code></pre>

<p>but it appears you&rsquo;d be wrong.</p>

    </article>
  </div>
  <div class="col-md-4">
    <div class="sidebar">
      <aside prefix="og:http://ogp.me/ns/article#">
  
  
  
<div class="article-metadata">

  <p>
  <span class="article-date">
    <i class="fa fa-calendar"></i>
    
    <time datetime="2012-02-28 14:59:21 &#43;0000 UTC" itemprop="datePublished">
      Tue, Feb 28, 2012
    </time>
    
  </span>
  </p>
    

  <p>
  
  
  
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="../../../../categories/open-science">open-science</a
    >
    
  </span>
  
  
  </p>
  
  <p>
  
  </p>

</div>

 
  <br />
  
  <p><a class="btn btn-default" rel="prev" href='../../../../2012/02/28/warning-signals-in-fish-collapse/'><i class="fa fa-chevron-left"></i> prev</a>
    <a class="btn btn-default" rel="next" href='../../../../2012/02/27/using-knitr-and-rwordpress-to-publish-results-directly-from-r-6/'>next <i class="fa fa-chevron-right"></i></a></p>

  <br />

  <p> <a class="btn btn-default" 
         href="https://github.com/cboettig/cboettig.github.io/commits/master/content/lab-notebook/2012-02-28-knitr-with-flickr-and-wordpress.md"><i class="fa fa-clock-o"></i> history</a></p>

  <p> <i class="fa fa-barcode"></i> SHA: <a href="https://github.com/cboettig/cboettig.github.io/blob/9d9072923c46d635718a4624d6afff6b1ec2439f/content/lab-notebook/2012-02-28-knitr-with-flickr-and-wordpress.md">9d9072923</a></p> 


</aside>

    </div>
  </div>
</div>


<section id="comments">
  <div id="disqus_thread">
    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'cboettig';
    var disqus_identifier = '\/2012\/02\/28\/knitr-with-flickr-and-wordpress\/';
    var disqus_title = 'Knitr with flickr and wordpress';
    var disqus_url = '\/2012\/02\/28\/knitr-with-flickr-and-wordpress\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>
</section>

<footer class="site-footer">
  <hr />
  <div class="container">

  <div class="row">
    <div class="col-md-3 col-xs-4 socialicons" style="font-size:20px" typeof="foaf:Person" about="https://carlboettiger.info/#me">
      <p>
      <script type="text/javascript" src="../../../../js/obfuscate-email-link.js"></script> 

          <a rel="foaf:account" href="https://twitter.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Twitter'); 
             return false;"><span class="showtooltip" title="follow me on twitter (reading, discussing)"><i class="fa fa-twitter"></i></span></a> 

          <a rel="foaf:account" href="https://github.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Github'); 
             return false;"><span class="showtooltip" title="follow me on Github (code, research)"><i class="fa fa-github"></i></span></a>
           <a rel="foaf:weblog" type="application/atom+xml" href="../../../../index.xml"  
        class="showtooltip" title="RSS feeds for my blog-style entries." 
         onclick="recordOutboundLink(this, 'Outbound Links', 'RSS'); 
         return false;"><i class="fa fa-rss"></i></a>
       </p>
    </div>

    
    


    <div class="col-md-4 col-md-offset-1 col-xs-4">
	    <p><a onclick="recordOutboundLink(this, 'Outbound Links', 'ONS_claim'); return false;" href="http://onsclaims.wikispaces.com/"><img src="../../../../img/ons-aci2-icon.svg" alt="ONS" class="showtooltip" title="An Open Notebook Science (ONS) project claim: Entry provides all content (AC) immediately (I) or without significant delay.  See link for details"/></a></p>
    </div>


    <div class="col-md-3 col-md-offset-1 col-xs-4">
      <p>
      <a rel="license" property="http://creativecommons.org/ns#license" href="http://creativecommons.org/publicdomain/zero/1.0/" onclick="recordOutboundLink(this, 'Outbound Links', 'CC0'); return false;"><img src="../../../../img/cc-zero.svg" alt="CC0"/></a> 
      </p>
    </div>
  </div>
</footer>


    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/TweenMax.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/latest/plugins/ScrollToPlugin.min.js"></script>
    <script src="../../../../js/jquery-1.12.3.min.js"></script>
    <script src="../../../../js/bootstrap.min.js"></script>
    <script src="../../../../js/isotope.pkgd.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.1/imagesloaded.pkgd.min.js"></script>
    <script src="../../../../js/hugo-academic.js"></script>
    

    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-18401403-1', 'auto');
        ga('send', 'pageview');

         
        var links = document.querySelectorAll('a');
        Array.prototype.map.call(links, function(item) {
            if (item.host != document.location.host) {
                item.addEventListener('click', function() {
                    var action = item.getAttribute('data-action') || 'follow';
                    ga('send', 'event', 'outbound', action, item.href);
                });
            }
        });
    </script>
    

    
    
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

 

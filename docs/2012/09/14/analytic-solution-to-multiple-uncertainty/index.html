<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Hugo 0.20.2" />
  <meta name="author" content="Carl Boettiger">
  

  
  
  
    
    
    <link rel="stylesheet" href="../../../../css/highlight.min.css">
    
  
  
  <link rel="stylesheet" href="../../../../css/bootstrap.min.css">
  <link rel="stylesheet" href="../../../../css/font-awesome.min.css">
  <link rel="stylesheet" href="../../../../css/academicons.min.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700|Merriweather|Roboto+Mono">
  
  
    <link rel="stylesheet" href="../../../../css/cboettig.css">
  
  
  <link rel="alternate" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">
  <link rel="feed" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">

  <link rel="icon" type="image/png" href="../../../../img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="../../../../img/apple-touch-icon.png">
  <link rel="canonical" href="../../../../2012/09/14/analytic-solution-to-multiple-uncertainty/">


  <title> | Boettiger Group</title>

</head>
<body id="top" data-spy="scroll" data-target="#navbar-main" data-offset="71">


<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../../../">Boettiger Group</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav navbar-right">
        

        

        <li class="nav-item">
          <a href="../../../../index.html">
            
            <span>Home</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../members/">
            
            <span>Members</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../vita/">
            
            <span>Publications</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../teaching/">
            
            <span>Teaching</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../lab-notebook">
            
            <span>Lab Notebook</span>
          </a>
        </li>

        
        
      </ul>

    </div>
  </div>
</nav>


<div class="row">
  <div class="col-md-7 col-md-offset-1">
    <article>
    
      
    

<p><em>No idea where I went wrong, but the final graphs are not what I expected</em>
<em>Update: Integrated out some uncertainty in the expectation step, need to preserve full set of transtions</em></p>

<p>We consider adding additional sources of noise through observation error and implementation error to the orginal model of Reed (1979), which considers only growth error.  This follows in the line of exploration taken by Clark and Kirkwood (1987), Roughgarden (1996) and Sethi (2006).</p>

<p>In adding these two sources of error, our state variable becomes our <em>measured</em> (or believed) stock $x$, rather than the true stock size $y$, and our control variable becomes the quota $q$ set, rather than the realized harvest $h$.</p>

<h2 id="analytical-integrals">Analytical integrals</h2>

<p>The central calculation to accomodating additional sources of uncertainty is the determination of the transition matrix; the probability of going from state $x<em>t$ at time $t$ to state $x</em>{t+1}$ in the next interval, for each possible value of the control variable (quota).  We discritize the statespace onto a fine grid of values $x$ and $h$ to seek a stochastic dynamic programming solution.</p>

<pre><code class="language-r">xmin &lt;- 0
xmax &lt;- 150
grid_n &lt;- 100
</code></pre>

<p>We seek a harvest policy which maximizes the discounted profit from the fishery using a stochastic dynamic programming approach over a discrete grid of stock sizes from <code>0</code> to <code>150</code> on a grid of <code>100</code> points, and over an identical discrete grid of possible harvest values.</p>

<pre><code class="language-r">x_grid &lt;- seq(xmin, xmax, length = grid_n)
h_grid &lt;- x_grid
</code></pre>

<p>With purely growth noise, a row of the matrix is given by the probability density of the growth noise with mean $f(x,h)$, that is, the probability of tranistion from $x$ to $x_{t+1}$ at harvest $h$ is given by the function $P(x_t+1, f(x,h))$ for some probability density function $P$.  In the case of uncertainty in stock $y$ and harvest $h$, we must integrate over the probability distributions for possible harvests and possible stock sizes,</p>

<div> $$ \int dh \int dy P(x_{t+1}, f(y, h))P(y)P(h) $$</div>

<p>In general this convolution can be non-trivial to compute, but in the case of uniformly distributed harvest error of $\pm \sigma_i$ around some quota $q$, and uniform measurement error of $\pm \sigma_m$ around the true stock size $x$, the integrals can be written as,</p>

<div> $$ \frac{\int_{\max(q-\sigma_i,0)}^{q+\sigma_i} dh \int_{\max(y-\sigma_h,0)}^{y+\sigma_h} dy P(x_{t+1}, f(y, h))}{\left((q+\sigma_i) - \max(q-\sigma_i,0)\right) \left((x+\sigma_m) - \max(x-\sigma_m,0)\right)} $$ </div>

<p>Note we enforce the simple non-negative boundary on stock and harvest.</p>

<p>So now we are left to merely integrate the $f(y,h)$ over these finite intervals.  We can do this for arbitrary $f$ through multidimensional numerical integration (In fact we could have done this in the first place, but it is too slow for the convolutions of arbitrary probability densities)</p>

<pre><code class="language-r">int_f
</code></pre>

<pre><code class="language-r">function(f, x, q, sigma_m, sigma_i, pars){
  K &lt;- pars[2]
  sigma_m &lt;- K*sigma_m
  sigma_i &lt;- K*sigma_i # scale noise into units of K
  
  if(sigma_m &gt; 0 &amp;&amp; sigma_i &gt; 0){
    g &lt;- function(X) f(X[1], X[2], pars)
    lower &lt;- c(max(x - sigma_m, 0), max(q - sigma_i, 0))
    upper &lt;- c(x + sigma_m, q + sigma_i)
    A &lt;- adaptIntegrate(g, lower, upper)
    out &lt;- A$integral/((q+sigma_i-max(q-sigma_i, 0))*(x+sigma_m-max(x-sigma_m, 0)))
  } else if(sigma_m == 0 &amp;&amp; sigma_i &gt; 0){ 
    g &lt;- function(h) f(x, h, pars)
    lower &lt;- max(q - sigma_i, 0)
    upper &lt;- q + sigma_i
    A &lt;- adaptIntegrate(g, lower, upper)
    out &lt;- A$integral/(q+sigma_i-max(q-sigma_i, 0))
  } else if(sigma_i == 0 &amp;&amp; sigma_m &gt; 0){ 
    g &lt;- function(y) f(y, q, pars)
    lower &lt;- max(x - sigma_m, 0)
    upper &lt;- x + sigma_m
    A &lt;- adaptIntegrate(g, lower, upper)
    out &lt;- A$integral/(x+sigma_m-max(x-sigma_m, 0))
  } else if (m == 0 &amp;&amp; n == 0){
    out &lt;- f(x,q,pars)
  } else {
    stop(&quot;distribution widths cannot be negative&quot;)
  }
  out
}
&lt;environment: namespace:pdgControl&gt;
</code></pre>

<p>If we assume a simple function like logistic growth, \(f(s) = r s (1-s/K) + s \), where \(s = x - h\),</p>

<pre><code class="language-r">f &lt;- function(x, h, p) {
    sapply(x, function(x) {
        S = max(x - h, 0)
        p[1] * S * (1 - S/p[2]) + S
    })
}
</code></pre>

<p>With parameters</p>

<pre><code class="language-r">r &lt;- 1
K &lt;- 100
pars &lt;- c(r, K)
</code></pre>

<p><code>r</code> = <code>1</code> and <code>K</code> = <code>100</code>.</p>

<p>Following Sethi et al, we can do this in closed form,</p>

<pre><code class="language-r">function(x,q, m, n, pars){
  K &lt;- pars[2]
  m &lt;- K*m
  n &lt;- K*n # scale noise by K
  if(m &gt; 0 &amp;&amp; n &gt; 0){
  out &lt;- ((q+n-max(0,q-n))*(x+m-max(0,x-m))*(6*x*K-6*q*K-6*n*K+6*m*K+6*max(0,x-m)*K-6*
    max(0,q-n)*K-2*x^2+3*q*x+3*n*x-4*m*x-2*max(0,x-m)*x+3*max(0,q-n)*x-2*q^2-4*n*q+3*m*q+3*
    max(0,x-m)*q-2*max(0,q-n)*q-2*n^2+3*m*n+3*max(0,x-m)*n-2*max(0,q-n)*n-2*m^2-2*max(0,x-m)*m+3*
    max(0,q-n)*m-2*max(0,x-m)^2+3*max(0,q-n)*max(0,x-m)-2*max(0,q-n)^2))/(6*K)/((q+n-max(q-n, 0))*(x+m-max(x-m, 0)))
  } else if(m == 0 &amp;&amp; n &gt; 0) {
    y &lt;- x
    out &lt;- (((6*q+6*n-6*max(0,q-n))*y-3*q^2-6*n*q-3*n^2+3*max(0,q-n)^2)*K+(-3*q-3*n+3*max(0,q-n))*
      y^2+(3*q^2+6*n*q+3*n^2-3*max(0,q-n)^2)*y-q^3-3*n*q^2-3*n^2*q-n^3+max(0,q-n)^3)/(3*K*(q+n-max(q-n, 0)))
  } else if(n == 0 &amp;&amp; m &gt; 0){
    h &lt;- q
    out &lt;- ((3*x^2+(6*m-6*h)*x+3*m^2-6*h*m+6*max(0,x-m)*h-3*max(0,x-m)^2)*K-x^3+(3*h-3*m)*x^2+
      (-3*m^2+6*h*m-3*h^2)*x-m^3+3*h*m^2-3*h^2*m+3*max(0,x-m)*h^2-3*max(0,x-m)^2*h+max(0,x-m)^3)/(3*K*(x+m-max(x-m, 0)))
  } else if (m == 0 &amp;&amp; n == 0){
    S &lt;- max(x - q, 0)
    out &lt;- S * (1 - S/K) + S
  } else {
    stop(&quot;distribution widths cannot be negative&quot;)
  }
  max(out,0)
}
&lt;environment: namespace:pdgControl&gt;
</code></pre>

<p>We can compare timing and equivalence of these two expressions:</p>

<pre><code class="language-r">require(cubature)
# Confirm that these give the same value, and time performance
system.time(a &lt;- sapply(x_grid, function(x) int_f(f, x, 1, 0.1, 0.1, 
    pars)))
</code></pre>

<pre><code>   user  system elapsed 
  7.444   0.000   7.394 
</code></pre>

<pre><code class="language-r">system.time(b &lt;- sapply(x_grid, function(x) F(x, 1, 0.1, 0.1, pars)))
</code></pre>

<pre><code>   user  system elapsed 
  0.012   0.000   0.015 
</code></pre>

<pre><code class="language-r">ggplot(data.frame(x = x_grid, a = a, b = b)) + geom_line(aes(x, a), 
    col = &quot;red&quot;) + geom_line(aes(x, b), lty = 2)
</code></pre>

<p><img src="http://farm9.staticflickr.com/8443/7986666475_3fce0b9e96_o.png" alt="plot of chunk unnamed-chunk-6" /></p>

<p>Note that as the uncertainy gets small, we recover the original transition probability $f$:</p>

<pre><code class="language-r">F(50, 4, 0.1, 0.1, pars)
</code></pre>

<pre><code>[1] 67.01
</code></pre>

<pre><code class="language-r">F(50, 4, 1e-04, 1e-04, pars)
</code></pre>

<pre><code>[1] 70.84
</code></pre>

<pre><code class="language-r">f(50, 4, pars)
</code></pre>

<pre><code>[1] 70.84
</code></pre>

<p>When the noise width is much smaller than the bin width we may have trouble, particularly with the uniform distribution, since part of the bin corresponds to zero density, part to high density.</p>

<h2 id="numerical-implementation">Numerical implementation</h2>

<p>We consider a profits from fishing to be a function of harvest <code>h</code> and stock size <code>x</code>,  \( \Pi(x,h) = h - \left( c_0  + c_1 \frac{h}{x} \right) \frac{h}{x} \), conditioned on \( h &gt; x \) and \(x &gt; 0 \),</p>

<pre><code class="language-r">price &lt;- 1
c0 &lt;- 0
c1 &lt;- 0
profit &lt;- profit_harvest(price = price, c0 = c0, c1 = c1)
</code></pre>

<p>with price = <code>1</code>, <code>c0</code> = <code>0</code> and <code>c1</code> = <code>0</code>.</p>

<p>Additional parameters</p>

<pre><code class="language-r">delta &lt;- 0.05
xT &lt;- 0
OptTime &lt;- 25
sigma_g &lt;- 0.1
sigma_m &lt;- 0.5
sigma_i &lt;- 0.5
</code></pre>

<p>The uniform distribution must be careful for noise sizes smaller than binwidth</p>

<pre><code class="language-r">pdfn &lt;- function(P, s) dunif(P, 1 - s, 1 + s)
# pdfn &lt;- function(P, s) dlnorm(P, 0, s)
</code></pre>

<p>We will determine the optimal solution over a <code>25</code> time step window with boundary condition for stock at <code>0</code> and discounting rate of <code>0.05</code>.</p>

<h1 id="scenarios">Scenarios:</h1>

<pre><code class="language-r">sdp &lt;- SDP_uniform(f, pars, x_grid, h_grid, sigma_g = sigma_g, pdfn, 
    sigma_m = sigma_m, sigma_i = sigma_i, F)
</code></pre>

<pre><code class="language-r">uniform &lt;- find_dp_optim(sdp, x_grid, h_grid, OptTime, xT, profit, 
    delta, reward = 0)
</code></pre>

<p>Do the deterministic exactly,</p>

<pre><code class="language-r">
SDP_Mat &lt;- determine_SDP_matrix(f, pars, x_grid, h_grid, sigma_g = sigma_g, 
    pdfn)
det &lt;- find_dp_optim(SDP_Mat, x_grid, h_grid, OptTime, xT, profit, 
    delta, reward = 0)
</code></pre>

<p>Determine the policies for each of the scenarios (noise combinations).</p>

<h3 id="plots">plots</h3>

<pre><code class="language-r">require(reshape2)
# policy &lt;- melt(data.frame(stock = x_grid, deterministic=det$D[,1],
# uniform = uniform$D[,1], mc=opt$D[,1]), id = 'stock')
policy &lt;- melt(data.frame(stock = x_grid, deterministic = det$D[, 
    1], uniform = uniform$D[, 1]), id = &quot;stock&quot;)

ggplot(policy) + geom_jitter(aes(stock, stock - x_grid[value], color = variable), 
    shape = &quot;+&quot;)
</code></pre>

<p><img src="http://farm9.staticflickr.com/8456/7986667113_28574bc620_o.png" alt="" /></p>

<pre><code class="language-r">dat &lt;- subset(policy, stock &lt; 140)
dt &lt;- data.table(dat)
linear &lt;- dt[, approx(stock, stock - x_grid[value], xout = seq(1, 
    150, length = 15)), by = variable]
ggplot(linear) + stat_smooth(aes(x, y, color = variable), degree = 1, 
    se = FALSE, span = 0.3) + xlab(&quot;Measured Stock&quot;) + ylab(&quot;Optimal Expected Escapement&quot;)
</code></pre>

<p><img src="http://farm9.staticflickr.com/8031/7986675144_095fd50f94_o.png" alt="" /></p>

    </article>
  </div>
  <div class="col-md-4">
    <div class="sidebar">
      <aside prefix="og:http://ogp.me/ns/article#">
  
  
  
<div class="article-metadata">

  <p>
  <span class="article-date">
    <i class="fa fa-calendar"></i>
    
    <time datetime="2012-09-14 00:00:00 &#43;0000 UTC" itemprop="datePublished">
      Fri, Sep 14, 2012
    </time>
    
  </span>
  </p>
    

  <p>
  
  
  
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="../../../../categories/ecology">ecology</a
    >
    
  </span>
  
  
  </p>
  
  <p>
  
  
  
  <span class="article-tags">
    <i class="fa fa-tags"></i>
    
    <a href="../../../../tags/decision-theory">decision-theory</a
    >, 
    
    <a href="../../../../tags/multiple-uncertainty">multiple-uncertainty</a
    >
    
  </span>
  
  
  </p>

</div>

 
  <br />
  
  <p><a class="btn btn-default" rel="prev" href='../../../../2012/09/19/prosecutors-fallacy/'><i class="fa fa-chevron-left"></i> prev</a>
    <a class="btn btn-default" rel="next" href='../../../../2012/09/12/notes/'>next <i class="fa fa-chevron-right"></i></a></p>

  <br />

  <p> <a class="btn btn-default" 
         href="https://github.com/cboettig/cboettig.github.io/commits/master/content/lab-notebook/2012-09-14-analytic-solution-to-multiple-uncertainty.md"><i class="fa fa-clock-o"></i> history</a></p>

  <p> <i class="fa fa-barcode"></i> SHA: <a href="https://github.com/cboettig/cboettig.github.io/blob/b3630889a5584cd1240e1c9d2208759615c88af4/content/lab-notebook/2012-09-14-analytic-solution-to-multiple-uncertainty.md">b3630889a</a></p> 


</aside>

    </div>
  </div>
</div>


<section id="comments">
  <div id="disqus_thread">
    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'cboettig';
    var disqus_identifier = '\/2012\/09\/14\/analytic-solution-to-multiple-uncertainty\/';
    var disqus_title = '';
    var disqus_url = '\/2012\/09\/14\/analytic-solution-to-multiple-uncertainty\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>
</section>

<footer class="site-footer">
  <hr />
  <div class="container">

  <div class="row">
    <div class="col-md-3 col-xs-4 socialicons" style="font-size:20px" typeof="foaf:Person" about="https://carlboettiger.info/#me">
      <p>
      <script type="text/javascript" src="../../../../js/obfuscate-email-link.js"></script> 

          <a rel="foaf:account" href="https://twitter.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Twitter'); 
             return false;"><span class="showtooltip" title="follow me on twitter (reading, discussing)"><i class="fa fa-twitter"></i></span></a> 

          <a rel="foaf:account" href="https://github.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Github'); 
             return false;"><span class="showtooltip" title="follow me on Github (code, research)"><i class="fa fa-github"></i></span></a>
           <a rel="foaf:weblog" type="application/atom+xml" href="../../../../index.xml"  
        class="showtooltip" title="RSS feeds for my blog-style entries." 
         onclick="recordOutboundLink(this, 'Outbound Links', 'RSS'); 
         return false;"><i class="fa fa-rss"></i></a>
       </p>
    </div>

    
    


    <div class="col-md-4 col-md-offset-1 col-xs-4">
	    <p><a onclick="recordOutboundLink(this, 'Outbound Links', 'ONS_claim'); return false;" href="http://onsclaims.wikispaces.com/"><img src="../../../../img/ons-aci2-icon.svg" alt="ONS" class="showtooltip" title="An Open Notebook Science (ONS) project claim: Entry provides all content (AC) immediately (I) or without significant delay.  See link for details"/></a></p>
    </div>


    <div class="col-md-3 col-md-offset-1 col-xs-4">
      <p>
      <a rel="license" property="http://creativecommons.org/ns#license" href="http://creativecommons.org/publicdomain/zero/1.0/" onclick="recordOutboundLink(this, 'Outbound Links', 'CC0'); return false;"><img src="../../../../img/cc-zero.svg" alt="CC0"/></a> 
      </p>
    </div>
  </div>
</footer>


    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/TweenMax.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/latest/plugins/ScrollToPlugin.min.js"></script>
    <script src="../../../../js/jquery-1.12.3.min.js"></script>
    <script src="../../../../js/bootstrap.min.js"></script>
    <script src="../../../../js/isotope.pkgd.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.1/imagesloaded.pkgd.min.js"></script>
    <script src="../../../../js/hugo-academic.js"></script>
    

    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-18401403-1', 'auto');
        ga('send', 'pageview');

         
        var links = document.querySelectorAll('a');
        Array.prototype.map.call(links, function(item) {
            if (item.host != document.location.host) {
                item.addEventListener('click', function() {
                    var action = item.getAttribute('data-action') || 'follow';
                    ga('send', 'event', 'outbound', action, item.href);
                });
            }
        });
    </script>
    

    
    
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

 

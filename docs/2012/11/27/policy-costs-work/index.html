<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Hugo 0.21" />
  <meta name="author" content="Carl Boettiger">
  

  
  
  
    
    
    <link rel="stylesheet" href="../../../../css/highlight.min.css">
    
  
  
  <link rel="stylesheet" href="../../../../css/bootstrap.min.css">
  <link rel="stylesheet" href="../../../../css/font-awesome.min.css">
  <link rel="stylesheet" href="../../../../css/academicons.min.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700|Merriweather|Roboto+Mono">
  
  
    <link rel="stylesheet" href="../../../../css/cboettig.css">
  
  
  <link rel="alternate" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">
  <link rel="feed" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">

  <link rel="icon" type="image/png" href="../../../../img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="../../../../img/apple-touch-icon.png">
  <link rel="canonical" href="../../../../2012/11/27/policy-costs-work/">


  <title> | Boettiger Group</title>

</head>
<body id="top" data-spy="scroll" data-target="#navbar-main" data-offset="71">


<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../../../">Boettiger Group</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav navbar-right">
        

        

        <li class="nav-item">
          <a href="../../../../index.html">
            
            <span>Home</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../members/">
            
            <span>Members</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../vita/">
            
            <span>Publications</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../teaching/">
            
            <span>Teaching</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../lab-notebook">
            
            <span>Lab Notebook</span>
          </a>
        </li>

        
        
      </ul>

    </div>
  </div>
</nav>


<div class = "container">


<div class="row">
  <div class="col-md-7 col-md-offset-1">
    <article>
    
      
    

<p>Scripts to estimate apples to apples comparisons for different penalty functions and plot instances of the resulting policy.
Example run with fixed linear costs on effort.</p>

<ul>
<li>Double the actual variance leads to terminal overfishing <a href="https://github.com/cboettig/nonparametric-bayes/commit/ee608e9a5dc94f98c7cb97e13133e01bd0823815">11:16 am 2012/11/28</a></li>
<li>use fixed seed. <a href="https://github.com/cboettig/nonparametric-bayes/commit/22930fb2a81b2e89d848516b6bbca4278fc1e59b">09:45 am 2012/11/28</a></li>
<li>Compare GP to Reed optimum for BH (successful run this time) <a href="https://github.com/cboettig/nonparametric-bayes/commit/59d864f621fbe6926407fb2e9adf7a255f8b84a7">09:37 am 2012/11/28</a></li>
<li>basic GP example in BH system, compared to Reed Optimum <a href="https://github.com/cboettig/nonparametric-bayes/commit/05e096fce1f65155b7b288be39d983717069edef">09:17 am 2012/11/28</a></li>
</ul>

<p>Content of current working example,  run on server <em>zero</em>.  See commit <a href="https://github.com/cboettig/pdg_control/blob/942b2faa91d4930622133f7c9385ef2c65e976f1/inst/examples/policycosts/policycosts_writeup_c0_30.md">942b2faa91</a></p>

<pre><code class="language-r">seed &lt;- 123  # Random seed (replicable results)
delta &lt;- 0.05  # economic discounting rate
OptTime &lt;- 100  # stopping time
gridsize &lt;- 50  # grid size for fish stock and harvest rate (discretized population)
sigma_g &lt;- 0.2  # Noise in population growth
reward &lt;- 0  # bonus for satisfying the boundary condition
z_g &lt;- function() rlnorm(1, 0, sigma_g)  # mean 1
z_m &lt;- function() 1  # No measurement noise,
z_i &lt;- function() 1  # No implemenation noise
f &lt;- BevHolt  # Select the state equation
pars &lt;- c(1.5, 0.05)  # parameters for the state equation
K &lt;- (pars[1] - 1)/pars[2]  # Carrying capacity (for reference
xT &lt;- 0  # boundary conditions
x0 &lt;- K
profit &lt;- profit_harvest(price = 10, c0 = 30, c1 = 0)
x_grid &lt;- seq(0.01, 1.2 * K, length = gridsize)
h_grid &lt;- seq(0.01, 0.8 * K, length = gridsize)
</code></pre>

<pre><code class="language-r">SDP_Mat &lt;- determine_SDP_matrix(f, pars, x_grid, h_grid, sigma_g)
opt &lt;- find_dp_optim(SDP_Mat, x_grid, h_grid, OptTime, xT, profit, delta, reward = reward)
</code></pre>

<pre><code class="language-r">L1 &lt;- function(c2) function(h, h_prev) c2 * abs(h - h_prev)
free_increase &lt;- function(c2) function(h, h_prev) c2 * abs(min(h - h_prev, 0))  # increasing harvest is free
free_decrease &lt;- function(c2) function(h, h_prev) c2 * max(h - h_prev, 0)  # decreasing harvest is free
fixed &lt;- function(c2) function(h, h_prev) c2 * as.numeric(!(h == h_prev))
L2 &lt;- function(c2) function(h, h_prev) c2 * (h - h_prev)^2
none &lt;- function(h, h_prev) 0
penaltyfns &lt;- list(L2 = L2, L1 = L1, free_decrease = free_decrease, fixed = fixed, 
    free_increase = free_increase)
c2 &lt;- seq(0, 10, length.out = 30)
</code></pre>

<h2 id="apples-to-apples-levels">Apples to Apples levels</h2>

<p>This can take a while, so we use explicit parallelization,</p>

<pre><code class="language-r">require(snowfall)
sfInit(cpu = 8, parallel = T)
</code></pre>

<pre><code>R Version:  R version 2.15.2 (2012-10-26) 

</code></pre>

<pre><code class="language-r">sfLibrary(pdgControl)
</code></pre>

<pre><code>Library pdgControl loaded.
</code></pre>

<pre><code class="language-r">sfExportAll()
</code></pre>

<h2 id="loop-over-penalty-functions-and-magnitudes">Loop over penalty functions and magnitudes</h2>

<pre><code class="language-r">policies &lt;- sfSapply(penaltyfns, function(penalty) {
    policies &lt;- sapply(c2, function(c2) {
        policycost &lt;- optim_policy(SDP_Mat, x_grid, h_grid, OptTime, xT, profit, 
            delta, reward, penalty = penalty(c2))
        i &lt;- which(x_grid &gt; K)[1]
        max(policycost$penalty_free_V[i, ])
    })
})
</code></pre>

<p>Note that <code>optim_policy</code> has been updated to return the equilibrium value of profits from fish harvests before the adjustment costs have been paid, <code>penalty_free_V</code>.  This containst the values for all possible states, we simply evaluate it at the carrying capacity (which is our initial condition.)  The index in <code>x_grid</code> that corresponds to the carrying capacity (initial condition) <code>i</code> indicates this.</p>

<p>Quadratic costs on fishing effort have to be done separately,</p>

<pre><code class="language-r">quad &lt;- sapply(c2, function(c2) {
    effort_penalty = function(x, h) 0.1 * c2 * h/x
    policycost &lt;- optim_policy(SDP_Mat, x_grid, h_grid, OptTime, xT, profit, 
        delta, reward, penalty = fixed(0), effort_penalty)
    i &lt;- which(x_grid &gt; K)[1]
    max(policycost$penalty_free_V[i, ])  # chooses the most sensible harvest in t=1
})
dat &lt;- cbind(policies, quad)
</code></pre>

<p>Tidy up the data and plot the net present value (before the penalty has been paid) relative to that achieved when managed without a penalty.</p>

<pre><code class="language-r">npv0 &lt;- dat[1, 3]
npv0
</code></pre>

<pre><code>free_decrease 
        709.7 
</code></pre>

<pre><code class="language-r">dat &lt;- data.frame(c2 = c2, dat)
dat &lt;- melt(dat, id = &quot;c2&quot;)
ggplot(dat, aes(c2, value, col = variable)) + geom_point() + geom_line()
</code></pre>

<p><img src="../../../../2012/assets/figures/2012-11-28-5e6d8d80ac-npv-plot.png" alt="plot of chunk npv-plot" /></p>

<p>Find the value of <code>c2</code> that brings each penalty closest to 75% of the cost-free adjustment value:</p>

<pre><code class="language-r">ggplot(dat, aes(c2, (npv0 - value)/npv0, col = variable)) + geom_point() + geom_line()
</code></pre>

<p><img src="../../../../2012/assets/figures/2012-11-28-5e6d8d80ac-apples_plot.png" alt="plot of chunk apples_plot" /></p>

<pre><code class="language-r">closest &lt;- function(x, v) {
    which.min(abs(v - x))
}
dt &lt;- data.table(dat)
index &lt;- dt[, closest(0.25, (npv0 - value)/value), by = variable]
apples &lt;- c2[index$V1]
names(apples) = index$variable
apples
</code></pre>

<pre><code>           L2            L1 free_decrease         fixed free_increase 
        1.034         1.724         0.000         8.276         0.000 
         quad 
        1.034 
</code></pre>

<h2 id="results">Results</h2>

<p>Solve the policy cost for the specified penalty function</p>

<pre><code class="language-r">L2_policy &lt;- optim_policy(SDP_Mat, x_grid, h_grid, OptTime, xT, profit, delta, 
    reward, penalty = L2(apples[&quot;L2&quot;]))
</code></pre>

<pre><code class="language-r">fixed_policy &lt;- optim_policy(SDP_Mat, x_grid, h_grid, OptTime, xT, profit, delta, 
    reward, penalty = fixed(apples[&quot;fixed&quot;]))
</code></pre>

<pre><code class="language-r">L1_policy &lt;- optim_policy(SDP_Mat, x_grid, h_grid, OptTime, xT, profit, delta, 
    reward, penalty = L1(apples[&quot;L1&quot;]))
</code></pre>

<pre><code class="language-r">free_increase_policy &lt;- optim_policy(SDP_Mat, x_grid, h_grid, OptTime, xT, profit, 
    delta, reward, penalty = free_increase(apples[&quot;free_increase&quot;]))
</code></pre>

<pre><code class="language-r">free_decrease_policy &lt;- optim_policy(SDP_Mat, x_grid, h_grid, OptTime, xT, profit, 
    delta, reward, penalty = free_decrease(apples[&quot;free_decrease&quot;]))
</code></pre>

<p>We also compare to the case in which costs of harvesting increase quadratically with effort; a common approach to create smoother policies.</p>

<pre><code class="language-r">quad_profit &lt;- profit_harvest(price = 10, c0 = 30, c1 = apples[&quot;quad&quot;])
quad_costs &lt;- optim_policy(SDP_Mat, x_grid, h_grid, OptTime, xT, quad_profit, 
    delta, reward, penalty = none)
</code></pre>

<pre><code class="language-r">sims &lt;- list(L1 = simulate_optim(f, pars, x_grid, h_grid, x0, L1_policy$D, z_g, 
    z_m, z_i, opt$D, profit = profit, penalty = L1(apples[&quot;L1&quot;]), seed = seed), 
    L2 = simulate_optim(f, pars, x_grid, h_grid, x0, L2_policy$D, z_g, z_m, 
        z_i, opt$D, profit = profit, penalty = L2(apples[&quot;L2&quot;]), seed = seed), 
    fixed = simulate_optim(f, pars, x_grid, h_grid, x0, fixed_policy$D, z_g, 
        z_m, z_i, opt$D, profit = profit, penalty = fixed(apples[&quot;fixed&quot;]), 
        seed = seed), increase = simulate_optim(f, pars, x_grid, h_grid, x0, 
        free_increase_policy$D, z_g, z_m, z_i, opt$D, profit = profit, penalty = free_increase(apples[&quot;increase&quot;]), 
        seed = seed), decrease = simulate_optim(f, pars, x_grid, h_grid, x0, 
        free_decrease_policy$D, z_g, z_m, z_i, opt$D, profit = profit, penalty = free_decrease(apples[&quot;decrease&quot;]), 
        seed = seed), quad = simulate_optim(f, pars, x_grid, h_grid, x0, free_decrease_policy$D, 
        z_g, z_m, z_i, opt$D, profit = quad_profit, penalty = none, seed = seed))
</code></pre>

<pre><code class="language-r"># Make data tidy (melt), fast (data.tables), and nicely labeled.
dat &lt;- melt(sims, id = names(sims[[1]]))
dt &lt;- data.table(dat)
setnames(dt, &quot;L1&quot;, &quot;penalty_fn&quot;)  # names are nice
</code></pre>

<h1 id="plots">Plots</h1>

<pre><code class="language-r">p0 &lt;- ggplot(dt) + geom_line(aes(time, alternate), col = &quot;grey20&quot;, lwd = 1) + 
    geom_line(aes(time, fishstock, col = penalty_fn, lty = penalty_fn)) + labs(x = &quot;time&quot;, 
    y = &quot;stock size&quot;, title = &quot;Stock Dynamics&quot;)
p0
</code></pre>

<p><img src="../../../../2012/assets/figures/2012-11-28-5e6d8d80ac-p0.png" alt="plot of chunk p0" /></p>

<pre><code class="language-r">p1 &lt;- ggplot(dt) + geom_line(aes(time, alternate), col = &quot;grey20&quot;, lwd = 1) + 
    geom_line(aes(time, fishstock), col = rgb(0, 0, 1, 0.8)) + facet_wrap(~penalty_fn) + 
    labs(x = &quot;time&quot;, y = &quot;stock size&quot;, title = &quot;Stock Dynamics&quot;)
p1
</code></pre>

<p><img src="../../../../2012/assets/figures/2012-11-28-5e6d8d80ac-p1.png" alt="plot of chunk p1" /></p>

<pre><code class="language-r">p2 &lt;- ggplot(dt) + geom_line(aes(time, harvest_alt), col = &quot;grey20&quot;, lwd = 1) + 
    geom_line(aes(time, harvest), col = rgb(0, 0, 1, 0.8)) + facet_wrap(~penalty_fn) + 
    labs(x = &quot;time&quot;, y = &quot;havest intensity (fish taken)&quot;, title = &quot;Harvest Policy Dynamics&quot;)
p2
</code></pre>

<p><img src="../../../../2012/assets/figures/2012-11-28-5e6d8d80ac-p2.png" alt="plot of chunk p2" /></p>

    </article>
  </div>
  <div class="col-md-4">
    <div class="sidebar">
      <aside prefix="og:http://ogp.me/ns/article#">
  
  
  
<div class="article-metadata">

  <p>
  <span class="article-date">
    <i class="fa fa-calendar"></i>
    
    <time datetime="2012-11-27 00:00:00 &#43;0000 UTC" itemprop="datePublished">
      Tue, Nov 27, 2012
    </time>
    
  </span>
  </p>
    

  <p>
  
  
  
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="../../../../categories/ecology">ecology</a
    >
    
  </span>
  
  
  </p>
  
  <p>
  
  
  
  <span class="article-tags">
    <i class="fa fa-tags"></i>
    
    <a href="../../../../tags/pdg-control">pdg-control</a
    >
    
  </span>
  
  
  </p>

</div>

 
  <br />
  
  <p><a class="btn btn-default" rel="prev" href='../../../../2012/11/28/nonparametric-bayes-work/'><i class="fa fa-chevron-left"></i> prev</a>
    <a class="btn btn-default" rel="next" href='../../../../2012/11/23/citing-lab-notebook-entries/'>next <i class="fa fa-chevron-right"></i></a></p>

  <br />

  <p> <a class="btn btn-default" 
         href="https://github.com/cboettig/cboettig.github.io/commits/master/content/lab-notebook/2012-11-27-policy-costs-work.md"><i class="fa fa-clock-o"></i> history</a></p>

  <p> <i class="fa fa-barcode"></i> SHA: <a href="https://github.com/cboettig/cboettig.github.io/blob/9d9072923c46d635718a4624d6afff6b1ec2439f/content/lab-notebook/2012-11-27-policy-costs-work.md">9d90729</a></p> 


</aside>

    </div>
  </div>
</div>


<section id="comments">
  <div id="disqus_thread">
    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'cboettig';
    var disqus_identifier = '\/2012\/11\/27\/policy-costs-work\/';
    var disqus_title = '';
    var disqus_url = '\/2012\/11\/27\/policy-costs-work\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>
</section>


</div>

<footer class="site-footer">
  <hr />
  <div class="container">

  <div class="row">
    <div class="col-md-3 col-xs-4 socialicons" style="font-size:20px" typeof="foaf:Person" about="https://carlboettiger.info/#me">
      <p>
      <script type="text/javascript" src="../../../../js/obfuscate-email-link.js"></script> 

          <a rel="foaf:account" href="https://twitter.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Twitter'); 
             return false;"><span class="showtooltip" title="follow me on twitter (reading, discussing)"><i class="fa fa-twitter"></i></span></a> 

          <a rel="foaf:account" href="https://github.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Github'); 
             return false;"><span class="showtooltip" title="follow me on Github (code, research)"><i class="fa fa-github"></i></span></a>
           <a rel="foaf:weblog" type="application/atom+xml" href="../../../../index.xml"  
        class="showtooltip" title="RSS feeds for my blog-style entries." 
         onclick="recordOutboundLink(this, 'Outbound Links', 'RSS'); 
         return false;"><i class="fa fa-rss"></i></a>
       </p>
    </div>

    
    


    <div class="col-md-4 col-md-offset-1 col-xs-4">
	    <p><a onclick="recordOutboundLink(this, 'Outbound Links', 'ONS_claim'); return false;" href="http://onsclaims.wikispaces.com/"><img src="../../../../img/ons-aci2-icon.svg" alt="ONS" class="showtooltip" title="An Open Notebook Science (ONS) project claim: Entry provides all content (AC) immediately (I) or without significant delay.  See link for details"/></a></p>
    </div>


    <div class="col-md-3 col-md-offset-1 col-xs-4">
      <p>
      <a rel="license" property="http://creativecommons.org/ns#license" href="http://creativecommons.org/publicdomain/zero/1.0/" onclick="recordOutboundLink(this, 'Outbound Links', 'CC0'); return false;"><img src="../../../../img/cc-zero.svg" alt="CC0"/></a> 
      </p>
    </div>
  </div>
</footer>


    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/TweenMax.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/latest/plugins/ScrollToPlugin.min.js"></script>
    <script src="../../../../js/jquery-1.12.3.min.js"></script>
    <script src="../../../../js/bootstrap.min.js"></script>
    <script src="../../../../js/isotope.pkgd.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.1/imagesloaded.pkgd.min.js"></script>
    <script src="../../../../js/hugo-academic.js"></script>
    

    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-18401403-1', 'auto');
        ga('send', 'pageview');

         
        var links = document.querySelectorAll('a');
        Array.prototype.map.call(links, function(item) {
            if (item.host != document.location.host) {
                item.addEventListener('click', function() {
                    var action = item.getAttribute('data-action') || 'follow';
                    ga('send', 'event', 'outbound', action, item.href);
                });
            }
        });
    </script>
    

    
    
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
    </script>
    <script async src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML"></script>
    

  </body>
</html>

   
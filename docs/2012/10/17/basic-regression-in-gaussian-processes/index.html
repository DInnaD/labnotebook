<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Hugo 0.20.2" />
  <meta name="author" content="Carl Boettiger">
  

  
  
  
    
    
    <link rel="stylesheet" href="../../../../css/highlight.min.css">
    
  
  
  <link rel="stylesheet" href="../../../../css/bootstrap.min.css">
  <link rel="stylesheet" href="../../../../css/font-awesome.min.css">
  <link rel="stylesheet" href="../../../../css/academicons.min.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700|Merriweather|Roboto+Mono">
  
  
    <link rel="stylesheet" href="../../../../css/cboettig.css">
  
  
  <link rel="alternate" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">
  <link rel="feed" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">

  <link rel="icon" type="image/png" href="../../../../img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="../../../../img/apple-touch-icon.png">
  <link rel="canonical" href="../../../../2012/10/17/basic-regression-in-gaussian-processes/">


  <title>Basic regression in Gaussian processes | Boettiger Group</title>

</head>
<body id="top" data-spy="scroll" data-target="#navbar-main" data-offset="71">


<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../../../">Boettiger Group</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav navbar-right">
        

        

        <li class="nav-item">
          <a href="../../../../index.html">
            
            <span>Home</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../members/">
            
            <span>Members</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../vita/">
            
            <span>Publications</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../teaching/">
            
            <span>Teaching</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../lab-notebook">
            
            <span>Lab Notebook</span>
          </a>
        </li>

        
        
      </ul>

    </div>
  </div>
</nav>


<div class="row">
  <div class="col-md-7 col-md-offset-1">
    <article>
    <h1>Basic regression in Gaussian processes</h1> 
      
    

<p>Working out coded examples for basic Gaussian process regression using R.  I&rsquo;ve just read through the first few chapters of <a href="http://www.GaussianProcess.org/gpml">Rasmussen &amp; Williams (2006)</a>, this implements the examples discussed in Chapter 2.1-2.5.</p>

<!-- Also motivated by [James Keirstead](http://www.jameskeirstead.ca/r/gaussian-process-regression-with-r/), with cleaner code.  -->

<p>Required R libraries (for multivariate normal, also for plotting):</p>

<pre><code class="language-r">require(MASS)
require(reshape2)
require(ggplot2)
</code></pre>

<p>Set a seed for repeatable plots</p>

<pre><code class="language-r">set.seed(12345)
</code></pre>

<p>Define the points at which we want to compute the function values (x values of the prediction points or test points), and the scale parameter for the covariance function $\ell=1$</p>

<pre><code class="language-r">x_predict &lt;- seq(-5,5,len=50)
l &lt;- 1
</code></pre>

<p>We will use the squared exponential (also called radial basis or Gaussian, though it is not this that gives Gaussian process it&rsquo;s name; any covariance function would do) as the covariance function, $\operatorname{cov}(X_i, X_j) = \exp\left(-\frac{(X_i - X_j)^2}{2 \ell ^ 2}\right)$</p>

<pre><code class="language-r">SE &lt;- function(Xi,Xj, l) exp(-0.5 * (Xi - Xj) ^ 2 / l ^ 2)
cov &lt;- function(X, Y) outer(X, Y, SE, l)
</code></pre>

<pre><code class="language-r">COV &lt;- cov(x_predict, x_predict)
</code></pre>

<p>Generate a number of functions from the process</p>

<pre><code class="language-r">values &lt;- mvrnorm(3, rep(0, length=length(x_predict)), COV)
</code></pre>

<p>Reshape the data into long (tidy) form, listing x value, y value, and sample number</p>

<pre><code class="language-r">dat &lt;- data.frame(x=x_predict, t(values))
dat &lt;- melt(dat, id=&quot;x&quot;)
head(dat)
</code></pre>

<pre><code>       x variable   value
1 -5.000       X1 -0.6450
2 -4.796       X1 -0.9227
3 -4.592       X1 -1.1587
4 -4.388       X1 -1.3277
5 -4.184       X1 -1.4139
6 -3.980       X1 -1.4103
</code></pre>

<p>Plot the result</p>

<pre><code class="language-r">fig2a &lt;- ggplot(dat,aes(x=x,y=value)) +
  geom_rect(xmin=-Inf, xmax=Inf, ymin=-2, ymax=2, fill=&quot;grey80&quot;) +
  geom_line(aes(group=variable)) +   theme_bw() +
  scale_y_continuous(lim=c(-3,3), name=&quot;output, f(x)&quot;) +
  xlab(&quot;input, x&quot;)
fig2a
</code></pre>

<p><img src="http://farm9.staticflickr.com/8377/8591045456_0f9f7191d5_o.png" alt="plot of draws from the null distribution" /></p>

<h3 id="posterior-distribution-given-the-data">Posterior distribution given the data</h3>

<p>Imagine we have some data,</p>

<pre><code class="language-r">obs &lt;- data.frame(x = c(-4, -3, -1,  0,  2),
                  y = c(-2,  0,  1,  2, -1))
</code></pre>

<p>In general we aren&rsquo;t interested in drawing from the prior, but want to include information from the data as well.  We want the joint distribution of the observed values and the prior is:</p>

<p>$$\begin{pmatrix} y<em>{\textrm{obs}} \ y</em>{\textrm{pred}} \end{pmatrix} \sim \mathcal{N}\left( \mathbf{0}, \begin{bmatrix} cov(X_o,X_o) &amp; cov(X_o, X_p) \ cov(X_p,X_o) &amp; cov(X_p, X_p) \end{bmatrix} \right)$$</p>

<h2 id="no-observation-noise">No observation noise</h2>

<p>Assuming the data are known without error and conditioning on the data, and given $x \sim \mathcal{N}(0, cov(X_o, X_o))$, then the conditional probability of observing our data is easily solved by exploiting the nice properties of Gaussians,</p>

<p>$$x|y \sim \mathcal{N}\left(E,C\right)$$
$$E = cov(X_p, X_o) cov(X_o,X_o)^{-1} y$$
$$C= cov(X_p, X_p) - cov(X_p, X_o) cov(X_o,X_o)^{-1} cov(X_o, X_p) $$</p>

<p>(We use <code>solve(M)</code> which with no second argument will simply invert the matrix <code>M</code>, but should use the Cholsky decomposition instead for better numerical stability)</p>

<pre><code class="language-r">cov_xx_inv &lt;- solve(cov(obs$x, obs$x))
Ef &lt;- cov(x_predict, obs$x) %*% cov_xx_inv %*% obs$y
Cf &lt;- cov(x_predict, x_predict) - cov(x_predict, obs$x)  %*% cov_xx_inv %*% cov(obs$x, x_predict)
</code></pre>

<p>Now lets take 3 random samples from the posterior distribution,</p>

<pre><code class="language-r">values &lt;- mvrnorm(3, Ef, Cf)
</code></pre>

<p>and plot our solution (mean, 2 standard deviations, and the ranom samples.)</p>

<pre><code class="language-r">dat &lt;- data.frame(x=x_predict, t(values))
dat &lt;- melt(dat, id=&quot;x&quot;)

fig2b &lt;- ggplot(dat,aes(x=x,y=value)) +
  geom_ribbon(data=NULL, 
              aes(x=x_predict, y=Ef, ymin=(Ef-2*sqrt(diag(Cf))), ymax=(Ef+2*sqrt(diag(Cf)))),
              fill=&quot;grey80&quot;) +
  geom_line(aes(color=variable)) + #REPLICATES
  geom_line(data=NULL,aes(x=x_predict,y=Ef), size=1) + #MEAN
  geom_point(data=obs,aes(x=x,y=y)) +  #OBSERVED DATA
  scale_y_continuous(lim=c(-3,3), name=&quot;output, f(x)&quot;) +
  xlab(&quot;input, x&quot;)
fig2b
</code></pre>

<p><img src="http://farm9.staticflickr.com/8237/8591045344_918138a53a_o.png" alt="plot of draws from the posterior, with no proces noise" /></p>

<h2 id="additive-noise">Additive noise</h2>

<p>In general the model may have process error, and rather than observe the deterministic map $f(x)$ we only observe $y = f(x) + \varepsilon$.  Let us assume for the moment that $\varepsilon$ are independent, normally distributed random variables with variance $\sigma_n^2$.</p>

<pre><code class="language-r">sigma.n &lt;- 0.25
cov_xx_inv &lt;- solve(cov(obs$x, obs$x) + sigma.n^2 * diag(1, length(obs$x)))
Ef &lt;- cov(x_predict, obs$x) %*% cov_xx_inv %*% obs$y
Cf &lt;- cov(x_predict, x_predict) - cov(x_predict, obs$x)  %*% cov_xx_inv %*% cov(obs$x, x_predict)
</code></pre>

<p>Now lets take 3 random samples from the posterior distribution,</p>

<pre><code class="language-r">values &lt;- mvrnorm(3, Ef, Cf)
</code></pre>

<p>and plot</p>

<pre><code class="language-r">dat &lt;- data.frame(x=x_predict, t(values))
dat &lt;- melt(dat, id=&quot;x&quot;)

fig2c &lt;- ggplot(dat,aes(x=x,y=value)) +
  geom_ribbon(data=NULL, 
              aes(x=x_predict, y=Ef, ymin=(Ef-2*sqrt(diag(Cf))), ymax=(Ef+2*sqrt(diag(Cf)))),
              fill=&quot;grey80&quot;) + # Var
  geom_line(aes(color=variable)) + #REPLICATES
  geom_line(data=NULL,aes(x=x_predict,y=Ef), size=1) + #MEAN
  geom_point(data=obs,aes(x=x,y=y)) +  #OBSERVED DATA
  scale_y_continuous(lim=c(-3,3), name=&quot;output, f(x)&quot;) +
  xlab(&quot;input, x&quot;)
fig2c
</code></pre>

<p><img src="http://farm9.staticflickr.com/8380/8589945565_174d4ac88a_o.png" alt="plot of chunk unnamed-chunk-16" /></p>

<p>Note that unlike the previous case, the posterior no longer collapses completely around the neighborhood of the test points.</p>

<p>We can also compute the likelihood (and marginal likelihood over the prior) of the data directly from the inferred multivariate normal distribution, which can allow us to tune the hyperparameters such as the characteristic length scale $\ell$ and the observation noise $\sigma_n$.  The most obvious approach would be to do so by maximum likelihood, giving point estimates of the hyper-parameters, though presumably we could be Bayesian about these as well.</p>

    </article>
  </div>
  <div class="col-md-4">
    <div class="sidebar">
      <aside prefix="og:http://ogp.me/ns/article#">
  
  
  
<div class="article-metadata">

  <p>
  <span class="article-date">
    <i class="fa fa-calendar"></i>
    
    <time datetime="2012-10-17 00:00:00 &#43;0000 UTC" itemprop="datePublished">
      Wed, Oct 17, 2012
    </time>
    
  </span>
  </p>
    

  <p>
  
  
  
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="../../../../categories/ecology">ecology</a
    >
    
  </span>
  
  
  </p>
  
  <p>
  
  </p>

</div>

 
  <br />
  
  <p><a class="btn btn-default" rel="prev" href='../../../../2012/10/19/notes/'><i class="fa fa-chevron-left"></i> prev</a>
    <a class="btn btn-default" rel="next" href='../../../../2012/10/17/talkingpoints/'>next <i class="fa fa-chevron-right"></i></a></p>

  <br />

  <p> <a class="btn btn-default" 
         href="https://github.com/cboettig/cboettig.github.io/commits/master/content/lab-notebook/2012-10-17-basic-regression-in-gaussian-processes.md"><i class="fa fa-clock-o"></i> history</a></p>

  <p> <i class="fa fa-barcode"></i> SHA: <a href="https://github.com/cboettig/cboettig.github.io/blob/9d9072923c46d635718a4624d6afff6b1ec2439f/content/lab-notebook/2012-10-17-basic-regression-in-gaussian-processes.md">9d9072923</a></p> 


</aside>

    </div>
  </div>
</div>


<section id="comments">
  <div id="disqus_thread">
    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'cboettig';
    var disqus_identifier = '\/2012\/10\/17\/basic-regression-in-gaussian-processes\/';
    var disqus_title = 'Basic regression in Gaussian processes';
    var disqus_url = '\/2012\/10\/17\/basic-regression-in-gaussian-processes\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>
</section>

<footer class="site-footer">
  <hr />
  <div class="container">

  <div class="row">
    <div class="col-md-3 col-xs-4 socialicons" style="font-size:20px" typeof="foaf:Person" about="https://carlboettiger.info/#me">
      <p>
      <script type="text/javascript" src="../../../../js/obfuscate-email-link.js"></script> 

          <a rel="foaf:account" href="https://twitter.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Twitter'); 
             return false;"><span class="showtooltip" title="follow me on twitter (reading, discussing)"><i class="fa fa-twitter"></i></span></a> 

          <a rel="foaf:account" href="https://github.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Github'); 
             return false;"><span class="showtooltip" title="follow me on Github (code, research)"><i class="fa fa-github"></i></span></a>
           <a rel="foaf:weblog" type="application/atom+xml" href="../../../../index.xml"  
        class="showtooltip" title="RSS feeds for my blog-style entries." 
         onclick="recordOutboundLink(this, 'Outbound Links', 'RSS'); 
         return false;"><i class="fa fa-rss"></i></a>
       </p>
    </div>

    
    


    <div class="col-md-4 col-md-offset-1 col-xs-4">
	    <p><a onclick="recordOutboundLink(this, 'Outbound Links', 'ONS_claim'); return false;" href="http://onsclaims.wikispaces.com/"><img src="../../../../img/ons-aci2-icon.svg" alt="ONS" class="showtooltip" title="An Open Notebook Science (ONS) project claim: Entry provides all content (AC) immediately (I) or without significant delay.  See link for details"/></a></p>
    </div>


    <div class="col-md-3 col-md-offset-1 col-xs-4">
      <p>
      <a rel="license" property="http://creativecommons.org/ns#license" href="http://creativecommons.org/publicdomain/zero/1.0/" onclick="recordOutboundLink(this, 'Outbound Links', 'CC0'); return false;"><img src="../../../../img/cc-zero.svg" alt="CC0"/></a> 
      </p>
    </div>
  </div>
</footer>


    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/TweenMax.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/latest/plugins/ScrollToPlugin.min.js"></script>
    <script src="../../../../js/jquery-1.12.3.min.js"></script>
    <script src="../../../../js/bootstrap.min.js"></script>
    <script src="../../../../js/isotope.pkgd.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.1/imagesloaded.pkgd.min.js"></script>
    <script src="../../../../js/hugo-academic.js"></script>
    

    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-18401403-1', 'auto');
        ga('send', 'pageview');

         
        var links = document.querySelectorAll('a');
        Array.prototype.map.call(links, function(item) {
            if (item.host != document.location.host) {
                item.addEventListener('click', function() {
                    var action = item.getAttribute('data-action') || 'follow';
                    ga('send', 'event', 'outbound', action, item.href);
                });
            }
        });
    </script>
    

    
    
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

 

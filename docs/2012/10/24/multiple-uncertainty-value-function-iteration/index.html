<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Hugo 0.20.2" />
  <meta name="author" content="Carl Boettiger">
  

  
  
  
    
    
    <link rel="stylesheet" href="../../../../css/highlight.min.css">
    
  
  
  <link rel="stylesheet" href="../../../../css/bootstrap.min.css">
  <link rel="stylesheet" href="../../../../css/font-awesome.min.css">
  <link rel="stylesheet" href="../../../../css/academicons.min.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700|Merriweather|Roboto+Mono">
  
  
    <link rel="stylesheet" href="../../../../css/cboettig.css">
  
  
  <link rel="alternate" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">
  <link rel="feed" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">

  <link rel="icon" type="image/png" href="../../../../img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="../../../../img/apple-touch-icon.png">
  <link rel="canonical" href="../../../../2012/10/24/multiple-uncertainty-value-function-iteration/">


  <title> | Boettiger Group</title>

</head>
<body id="top" data-spy="scroll" data-target="#navbar-main" data-offset="71">


<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../../../">Boettiger Group</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav navbar-right">
        

        

        <li class="nav-item">
          <a href="../../../../index.html">
            
            <span>Home</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../members/">
            
            <span>Members</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../vita/">
            
            <span>Publications</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../teaching/">
            
            <span>Teaching</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../lab-notebook">
            
            <span>Lab Notebook</span>
          </a>
        </li>

        
        
      </ul>

    </div>
  </div>
</nav>


<div class="row">
  <div class="col-md-7 col-md-offset-1">
    <article>
    
      
    

<h3 id="multiple-uncertainty-algorithm">Multiple Uncertainty algorithm</h3>

<p>Define each of the transition matrices:</p>

<pre><code class="language-r">    D &lt;- matrix(NA, nrow=length(x_grid), ncol=Tmax)  
    P &lt;- outer(x_grid, h_grid, profit)
    F &lt;- outer(x_grid, f(x_grid, 0, p), pdfn, sigma_g)
    M &lt;- outer(x_grid, x_grid, pdfn, sigma_m)
    I &lt;- outer(h_grid, h_grid, pdfn, sigma_i)
</code></pre>

<p>Probably row-normalize each:</p>

<pre><code class="language-r">rownorm &lt;- function(M) t(apply(M, 1, function(x) x/sum(x))
</code></pre>

<p>(Note the transpose is needed since the silly function of a vector turns the column into a row.  Not an issue of margin 2)</p>

<p>If we have no uncertainty in measurement or implementation, then the algorithm is:</p>

<pre><code class="language-r">    V &lt;- P
    for(t in 1:Tmax){
      D[,(Tmax-t+1)] &lt;- apply(V, 1, which.max)
      V &lt;- P + delta * F %*% V %*% D[, (Tmax-t+1)]  
    }
    D
</code></pre>

<p>With uncertainty</p>

<pre><code class="language-r">Ep &lt;- M %*% P %*% I
U &lt;- t(M) %*% F %*% M 
V &lt;- Ep
  for(t in 1:Tmax){
    D[,(Tmax-t+1)] &lt;- apply(V, 1, which.max)
    V &lt;- Ep + delta * U %*% V %*% I %*% D[, (Tmax-t+1)]  
  }
</code></pre>

<h3 id="description">Description</h3>

<p>** rambling thinking while working out the above **</p>

<p>The <a href="http://www.carlboettiger.info/2012/10/01/multiple-uncertainty.html">October 1st entry</a> derives the rule for updating the state (measured stock),</p>

<p>$$ Y_{t+1} = \mathbb{F} \mathbb{M} \mathbb{I}_h \vec Y_t, $$</p>

<p>but this isn&rsquo;t sufficient to complete the value iteration. Recall from the Bellman recursion,</p>

<p>$$V_t = \max_h \operatorname{E}\left( \Pi(Y_t, h<em>t) + V(Y</em>{t+1}, h_{t+1}) \right) $$</p>

<p>In the final timestep with no scrap value, we assert that the vector of values for each possible state, $\vec V<em>T = {0}$.  The previous year is then the first year that can have profits, given by $\Pi(Y</em>{T-1}, h<em>{T-1})$.  Of course $Y</em>{T-1}$ is unknown, but is given by the recursion in (1).</p>

<p>Our strategy in discrete space is to work backwards from $T$, keeping track of the $h$ that maximizes the value-to-go for each possible state.  So at $T-1$, we put each possible state $y$ and each possible havest $h$ into $\Pi(y,h)$ and select the $h$ that maximizes the profit.  In the case of a deterministic harvest and a lack of measurement error this first iteration is trivial: harvest what you see $h=y$ (unless $h$ is bounded or there is a cost on effort), yielding the value $V_{T-1}$ for each state $y$ is $\Pi(y,y)$.  When profits are proportional to harvest, up to a constant this is simply $y$.</p>

<p>For a generic profit function that may have a cost on effort, we must store the map of which $h$ is optimal for each $y$.  In discrete space, call this the decision vector $D<em>{T-1}$ where the indices correspond to the states $y$ and the values correspond to the harvest (or harvest index) that is optimal for that state, and we write $\Pi(y</em>{T-1}, D<em>{T-1}(y</em>{T-1}))$</p>

<p>If there is uncertainty in either implementation of the harvest or measurement of the stock, or both, then we must integrate over this in determining the optimal $h$.  The expected profit derived from choosing a harvest quota $q$ and having measured a stock at $y$ is given by</p>

<p>$$ \Pi(y,q) = \int \int \Pi(x,h) P(x) dx P(h) dh $$</p>

<p>In matrix form, if $\mathbb{P}$ is the matrix of profits where element $p_{ij} = \Pi(x_i, h_j)$ and vector $\vec H$ with elements $H_i$ give the probability of harvesting $h_i$ fish given the quota $q$, then $\mathbb{P} \vec H$ is a vector of profits for each $x_i$.  Representing distribution in the measurement similarly as $\vec X$, the integration for the expected profit is $\vec X^T \mathbb{P} \vec H$ (giving the scalar value $\Pi(y,q)$).</p>

<p>We can store &amp; lookup $X$ using a matrix whose columns give $\vec X$ for each value $y$, and similarly for $H$ given $q$. These are our matrices $\mathbb{M}$ (each row is a fixed observed $y$, maps true $x$ into observed $y$, elements $P_m(y, x)$) $\mathbb{I}$ (mapping quota $q$ (columns) to implemented harvest $h$, elements $P_I(h_i, q_j)$) from before.  Then we can write $\operatorname{E}(\Pi(x,h) | y,q)$ as a matrix resulting from the product of matrices:</p>

<p>$$\tilde{\mathbb{P}} =  \mathbb{M} \mathbb{P} \mathbb{I} $$</p>

<p>In the next iteration, $T-2$, we realize that our choice of $h$ impacts the value we could get a time $T-1$ as well. In choosing the harvest quota in this interval we must also consider what value it introduces in the $T-1$ interval.  We already have the matrix above giving the profits for each $y$ and $h$, we just need to transition from the space of the current $y$ to the future $y$ through application of the transition matrix $T: y<em>t \to y</em>{t+1}$.  $F: x<em>t \to x</em>{t+1}$, $F(x_{t+1}, x_t)$, $M: x \to y$, $I: q \to h$, so</p>

<p>$$\mathbb{T} = M^T F M \tilde{P} I D_t $$</p>

    </article>
  </div>
  <div class="col-md-4">
    <div class="sidebar">
      <aside prefix="og:http://ogp.me/ns/article#">
  
  
  
<div class="article-metadata">

  <p>
  <span class="article-date">
    <i class="fa fa-calendar"></i>
    
    <time datetime="2012-10-24 00:00:00 &#43;0000 UTC" itemprop="datePublished">
      Wed, Oct 24, 2012
    </time>
    
  </span>
  </p>
    

  <p>
  
  
  
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="../../../../categories/ecology">ecology</a
    >
    
  </span>
  
  
  </p>
  
  <p>
  
  
  
  <span class="article-tags">
    <i class="fa fa-tags"></i>
    
    <a href="../../../../tags/decision-theory">decision-theory</a
    >, 
    
    <a href="../../../../tags/pdg-control">pdg-control</a
    >
    
  </span>
  
  
  </p>

</div>

 
  <br />
  
  <p><a class="btn btn-default" rel="prev" href='../../../../2012/10/24/evolutionary-covariance/'><i class="fa fa-chevron-left"></i> prev</a>
    <a class="btn btn-default" rel="next" href='../../../../2012/10/23/semantic-markup-examples-for-the-lab-notebook/'>next <i class="fa fa-chevron-right"></i></a></p>

  <br />

  <p> <a class="btn btn-default" 
         href="https://github.com/cboettig/cboettig.github.io/commits/master/content/lab-notebook/2012-10-24-multiple-uncertainty-value-function-iteration.md"><i class="fa fa-clock-o"></i> history</a></p>

  <p> <i class="fa fa-barcode"></i> SHA: <a href="https://github.com/cboettig/cboettig.github.io/blob/b3630889a5584cd1240e1c9d2208759615c88af4/content/lab-notebook/2012-10-24-multiple-uncertainty-value-function-iteration.md">b3630889a</a></p> 


</aside>

    </div>
  </div>
</div>


<section id="comments">
  <div id="disqus_thread">
    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'cboettig';
    var disqus_identifier = '\/2012\/10\/24\/multiple-uncertainty-value-function-iteration\/';
    var disqus_title = '';
    var disqus_url = '\/2012\/10\/24\/multiple-uncertainty-value-function-iteration\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>
</section>

<footer class="site-footer">
  <hr />
  <div class="container">

  <div class="row">
    <div class="col-md-3 col-xs-4 socialicons" style="font-size:20px" typeof="foaf:Person" about="https://carlboettiger.info/#me">
      <p>
      <script type="text/javascript" src="../../../../js/obfuscate-email-link.js"></script> 

          <a rel="foaf:account" href="https://twitter.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Twitter'); 
             return false;"><span class="showtooltip" title="follow me on twitter (reading, discussing)"><i class="fa fa-twitter"></i></span></a> 

          <a rel="foaf:account" href="https://github.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Github'); 
             return false;"><span class="showtooltip" title="follow me on Github (code, research)"><i class="fa fa-github"></i></span></a>
           <a rel="foaf:weblog" type="application/atom+xml" href="../../../../index.xml"  
        class="showtooltip" title="RSS feeds for my blog-style entries." 
         onclick="recordOutboundLink(this, 'Outbound Links', 'RSS'); 
         return false;"><i class="fa fa-rss"></i></a>
       </p>
    </div>

    
    


    <div class="col-md-4 col-md-offset-1 col-xs-4">
	    <p><a onclick="recordOutboundLink(this, 'Outbound Links', 'ONS_claim'); return false;" href="http://onsclaims.wikispaces.com/"><img src="../../../../img/ons-aci2-icon.svg" alt="ONS" class="showtooltip" title="An Open Notebook Science (ONS) project claim: Entry provides all content (AC) immediately (I) or without significant delay.  See link for details"/></a></p>
    </div>


    <div class="col-md-3 col-md-offset-1 col-xs-4">
      <p>
      <a rel="license" property="http://creativecommons.org/ns#license" href="http://creativecommons.org/publicdomain/zero/1.0/" onclick="recordOutboundLink(this, 'Outbound Links', 'CC0'); return false;"><img src="../../../../img/cc-zero.svg" alt="CC0"/></a> 
      </p>
    </div>
  </div>
</footer>


    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/TweenMax.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/latest/plugins/ScrollToPlugin.min.js"></script>
    <script src="../../../../js/jquery-1.12.3.min.js"></script>
    <script src="../../../../js/bootstrap.min.js"></script>
    <script src="../../../../js/isotope.pkgd.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.1/imagesloaded.pkgd.min.js"></script>
    <script src="../../../../js/hugo-academic.js"></script>
    

    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-18401403-1', 'auto');
        ga('send', 'pageview');

         
        var links = document.querySelectorAll('a');
        Array.prototype.map.call(links, function(item) {
            if (item.host != document.location.host) {
                item.addEventListener('click', function() {
                    var action = item.getAttribute('data-action') || 'follow';
                    ga('send', 'event', 'outbound', action, item.href);
                });
            }
        });
    </script>
    

    
    
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

 

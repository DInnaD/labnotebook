<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Hugo 0.20.2" />
  <meta name="author" content="Carl Boettiger">
  

  
  
  
    
    
    <link rel="stylesheet" href="../../../../css/highlight.min.css">
    
  
  
  <link rel="stylesheet" href="../../../../css/bootstrap.min.css">
  <link rel="stylesheet" href="../../../../css/font-awesome.min.css">
  <link rel="stylesheet" href="../../../../css/academicons.min.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700|Merriweather|Roboto+Mono">
  
  
    <link rel="stylesheet" href="../../../../css/cboettig.css">
  
  
  <link rel="alternate" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">
  <link rel="feed" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">

  <link rel="icon" type="image/png" href="../../../../img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="../../../../img/apple-touch-icon.png">
  <link rel="canonical" href="../../../../1/01/01/likelihood-ratio-paper--power-in-trees/">


  <title>Likelihood Ratio Paper- Power in Trees | Boettiger Group</title>

</head>
<body id="top" data-spy="scroll" data-target="#navbar-main" data-offset="71">


<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../../../">Boettiger Group</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav navbar-right">
        

        

        <li class="nav-item">
          <a href="../../../../index.html">
            
            <span>Home</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../members/">
            
            <span>Members</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../vita/">
            
            <span>Publications</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../teaching/">
            
            <span>Teaching</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../lab-notebook">
            
            <span>Lab Notebook</span>
          </a>
        </li>

        
        
      </ul>

    </div>
  </div>
</nav>


<div class="row">
  <div class="col-md-7 col-md-offset-1">
    <article>
    <h1>Likelihood Ratio Paper- Power in Trees</h1> 
      
    

<p></p>

<h3 id="power-in-trees-tests-results-from-single-ou-simulation-per-alpha-run-yesterday">Power in Trees tests (Results from single OU simulation per alpha, run yesterday)</h3>

<p>2000 replicates gives a cleaner picture of the critical alpha, though
with low alpha values the estimates of p are quite variable. Also more
variable on the smaller trees. Even arbitrarily large alpha aren&rsquo;t
significant on the 5-taxa primate tree. On the small geospiza tree (13
taxa) from the geiger package we find:</p>

<pre><code class="language-de1">0.5735   0.29  0.704 0.6465  0.993  0.838 0.8605 0.9355  0.782  0.845   0.93 
 &quot;0.1&quot;  &quot;0.2&quot;  &quot;0.3&quot;  &quot;0.4&quot;  &quot;0.5&quot;  &quot;0.6&quot;  &quot;0.7&quot;  &quot;0.8&quot;  &quot;0.9&quot;    &quot;1&quot;    &quot;2&quot; 
 0.945 0.9985  0.958 0.7725 0.9995  0.982  0.949  0.992      1   0.99  0.999 
   &quot;3&quot;    &quot;4&quot;    &quot;5&quot;    &quot;6&quot;    &quot;7&quot;    &quot;8&quot;    &quot;9&quot;   &quot;10&quot;   &quot;20&quot;   &quot;30&quot;   &quot;40&quot; 
0.9895 
  &quot;50&quot;
</code></pre>

<p>P values on top row, alpha values in quotes below the p value. Notice 9
fails to be significant at 0.95% confidence level, though might as
easily be somewhere around 6. For the Labrid tree with 114 taxa the
pattern is clearer though not perfect:</p>

<pre><code class="language-de1"> 0.621  0.502 0.9735   0.66 0.5185 0.8075 0.9975 0.9665  0.907  0.997 0.9945 
 &quot;0.1&quot;  &quot;0.2&quot;  &quot;0.3&quot;  &quot;0.4&quot;  &quot;0.5&quot;  &quot;0.6&quot;  &quot;0.7&quot;  &quot;0.8&quot;  &quot;0.9&quot;    &quot;1&quot;    &quot;2&quot; 
     1      1      1      1      1      1      1      1      1      1      1 
   &quot;3&quot;    &quot;4&quot;    &quot;5&quot;    &quot;6&quot;    &quot;7&quot;    &quot;8&quot;    &quot;9&quot;   &quot;10&quot;   &quot;20&quot;   &quot;30&quot;   &quot;40&quot; 
     1 
  &quot;50&quot;
</code></pre>

<p>Significance clearly sets in between alpha of 0.9 and 1.</p>

<p>Summary:</p>

<pre><code class="language-de1">&gt; birds$min_alpha
[1] 10
13 taxa
&gt; primates$min_alpha
[1] 1000
(5 taxa)
&gt; carnivora$min_alpha
[1] 1
260 taxa
&gt; labrids$min_alpha
[1] 1
114 taxa
&gt; carex$min_alpha
[1] 2
53 taxa
&gt;
</code></pre>

<h4 id="reducing-the-noise-in-the-power-estimation">reducing the noise in the power estimation</h4>

<p>I&rsquo;ve just implemented the power test for the smallest alpha that can be
detected at the 95% level using the (whatarewecallingitnow) likelihood
ratio monte carlo approach on a given tree. I try simulating under
successively higher alpha values and then see if the resulting dataset
can be distinguished. In my first implementation, this involves only one
simulation from the OU model at a given alpha, and then the N bootstrap
simulations from the null brownian model per alpha.</p>

<p>Obviously I want more than one simulation from the OU process. It seems
I could (1) simulate under the OU model of a given alpha, (2) fit the BM
model to the resulting data, (3) simulate under that BM model to get the
&ldquo;bootstrap&rdquo; data, for which (4) I refit the BM and OU models and compare
the likelihood ratio of these refit models. That sounds pretty
convoluted when I describe it that way, but I think this is the
&ldquo;natural&rdquo; thing to do? i.e. steps 2-4 are the bootstrap process which I
normally repeat N times for a single dataset, now instead of using a
single dataset I draw a dataset from the distribution&hellip;.</p>

<p></p>

<h2 id="new-approach-multiple-simulations-from-alpha">New approach: multiple simulations from alpha</h2>

<h4 id="plots-show-decreasing-power-with-decreasing-alpha">Plots show decreasing power with decreasing alpha</h4>

<p><img src="http://openwetware.org/images/thumb/e/ec/Power_alpha5.png/180px-Power_alpha5.png" alt="Anoles data at alpha=25. Red curve is the LR distribution when
simulations come from OU with alpha=25, blue line is LR distribution
when simulations come from BM models fit to those OU-generated
data" /></p>

<p><img src="../../../../skins/common/images/magnify-clip.png" alt="image" /></p>

<p>Anoles data at alpha=25. Red curve is the LR distribution when
simulations come from OU with alpha=25, blue line is LR distribution
when simulations come from BM models fit to those OU-generated data</p>

<p><img src="http://openwetware.org/images/thumb/9/9a/Power_alpha1.png/180px-Power_alpha1.png" alt="Anoles data at
alpha=1." /></p>

<p><img src="../../../../skins/common/images/magnify-clip.png" alt="image" /></p>

<p>Anoles data at alpha=1.</p>

<p><img src="http://openwetware.org/images/thumb/7/79/Power_alpha.png/180px-Power_alpha.png" alt="Anoles data at
alpha=0.25." /></p>

<p><img src="../../../../skins/common/images/magnify-clip.png" alt="image" /></p>

<p>Anoles data at alpha=0.25.</p>

<p><br />
 New procedure:</p>

<pre><code class="language-de1">   ## Draw a data sample from the distribution produced by test
    data &lt;- simulate(test, n=nboot)
 
    ## fit the null models to these data -- so we simulate from the appropriate null
    nulls &lt;- lapply(1:nboot, function(i){
            update(null, data[[i]])
    })
    tests &lt;- lapply(1:nboot, function(i){
            update(test, data[[i]])
    })
    t0_dist &lt;- sapply(1:nboot, function(i){
        if(is(tests[[i]], &quot;hansentree&quot;)){ t0 &lt;- -2*(nulls[[i]]@loglik - tests[[i]]@loglik) }
        else { t0 &lt;- -2*(nulls[[i]]@loglik - tests[[i]]$loglik) }
    })
 
 
    ## Data come from a distribution of nulls, 
    X &lt;- sapply(1:nboot, function(i){
        simulate(nulls[[i]])
    })
 
    t &lt;- sapply(1:nboot, function(i){
        refit_null &lt;- update(null, X[[i]])
        refit_test &lt;- update(test, X[[i]])
        if(is(refit_test, &quot;hansentree&quot;)){ out &lt;- -2*(refit_null@loglik - refit_test@loglik) }
        else { out &lt;- -2*(refit_null@loglik - refit_test$loglik) }
        out
    })
 
 plot(density(out$t), col='blue', lwd=3,xlim=range(c(out$t0_dist,out$t)) )
 lines(density(out$t0_dist), col='red', lwd=3)
</code></pre>

<p><img src="http://openwetware.org/images/thumb/4/4b/Null_LR.png/180px-Null_LR.png" alt="Null distributions of the LR all lie on top of eachother regardless of
sigma" /></p>

<p><img src="../../../../skins/common/images/magnify-clip.png" alt="image" /></p>

<p>Null distributions of the LR all lie on top of eachother regardless of
sigma</p>

<p>From these it is possible to estimate the power (see <a href="http://github.com/cboettig/Comparative-Phylogenetics/blob/6f6c8d70d342761e508e949f710aced716ddf472/R/powertest.R" title="http://github.com/cboettig/Comparative-Phylogenetics/blob/6f6c8d70d342761e508e949f710aced716ddf472/R/powertest.R">powertest.R
code</a>)</p>

<p><br />
 Note that the null distribution (the blue curve) doesn&rsquo;t actually
differ and so doesn&rsquo;t need to be re-simulated with different values.</p>

<p></p>

<p><img src="http://openwetware.org/images/thumb/c/c1/Anoles_power.png/180px-Anoles_power.png" alt="anoles
power" /></p>

<p><img src="../../../../skins/common/images/magnify-clip.png" alt="image" /></p>

<p>anoles power</p>

<p></p>

<h2 id="meanwhile">Meanwhile</h2>

<ul>
<li>Finishing the story on model choice in the Anoles dataset.
Resimulating with extra replicates and including all 5 original
models.</li>
<li>Good news is that 2000 bootstraps on all 6 models against each other
is quite fast on the 16-processor <em>zero</em>, an hour or so. Bad news is
the ou2 funny painted model isn&rsquo;t bootstrapping the LR correctly,
though all the other pairs are.</li>
<li>Other sorta bad news is that OU_LP does a handy job at beating all
other models under Monte Carlo Likelihood Ratio test, so the final
conclusion doesn&rsquo;t have the punchiness a contradiction would. At
least the contrived OU2 contradicts this. Should also add the &ldquo;all
different&rdquo; painting to the mix to demonstrate. &ndash;Carl Boettiger
01:24, 27 August 2010 (EDT) Fixed, order of nodes conflicted.</li>
</ul>

<h4 id="slideshow-of-results">Slideshow of results</h4>

<p><a href="http://photobucket.com/redirect/album?showShareLB=1"><img src="http://pic.pbsrc.com/share/icons/embed/btn_geturs.gif" alt="image" /></a><a href="http://s1212.photobucket.com/albums/cc458/cboettig/"><img src="http://pic.pbsrc.com/share/icons/embed/btn_viewall.gif" alt="image" /></a></p>

<h2 id="code-updates">Code updates</h2>

<p>&ndash;Carl Boettiger 03:26, 27 August 2010 (EDT)</p>

<ul>
<li><p>Just implemented the fast version of the power test, which avoids
re-simulating from the Brownian motion null, and handles the
parallelization with more finesse, and as a single function. Set to
run examples overnight.</p></li>

<li><p>Removed the traitmodels support from the power test for the moment,
until the convergence issues are dealt with. The s3/s4 class
differences to access elements make this annoying as method
dependency must be handled explicitly by if statements not
automatically by class generics. (guess could access by index? &ndash;
Nope, S4 classes aren&rsquo;t subsettable)</p></li>
</ul>

<h4 id="updated-power-curves-for-trees">Updated power curves for trees</h4>

<p>Using the faster approach avoiding re-sampling the null distribution for
each alpha, I generate power curves for trees of different sizes and
complexity. The larger, richer trees show more power.</p>

<ul>
<li><a href="http://github.com/cboettig/Comparative-Phylogenetics/blob/916ec3622b5b51578c2fe871584f1846b1bddf1f/R/powertest.R" title="http://github.com/cboettig/Comparative-Phylogenetics/blob/916ec3622b5b51578c2fe871584f1846b1bddf1f/R/powertest.R">Code for
method</a></li>
<li><a href="http://github.com/cboettig/Comparative-Phylogenetics/blob/83e0ecf41603d4f6280f9e497be89c152e661107/demos/power_examples.R" title="http://github.com/cboettig/Comparative-Phylogenetics/blob/83e0ecf41603d4f6280f9e497be89c152e661107/demos/power_examples.R">Code for
example</a></li>
</ul>

<p><img src="http://openwetware.org/images/d/d8/Fast_power_examples.png" alt="Image:Fast\_power\_examples.png" /></p>

<p></p>

    </article>
  </div>
  <div class="col-md-4">
    <div class="sidebar">
      <aside prefix="og:http://ogp.me/ns/article#">
  
  
  
<div class="article-metadata">

  <p>
  <span class="article-date">
    <i class="fa fa-calendar"></i>
    
    <time datetime="0001-01-01 00:00:00 &#43;0000 UTC" itemprop="datePublished">
      Mon, Jan 1, 0001
    </time>
    
  </span>
  </p>
    

  <p>
  
  
  
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="../../../../categories/evolution">evolution</a
    >
    
  </span>
  
  
  </p>
  
  <p>
  
  
  
  <span class="article-tags">
    <i class="fa fa-tags"></i>
    
    <a href="../../../../tags/pmc">pmc</a
    >
    
  </span>
  
  
  </p>

</div>

 
  <br />
  
  <p><a class="btn btn-default" rel="prev" href='../../../../1/01/01/likelihood-ratio-paper/'><i class="fa fa-chevron-left"></i> prev</a>
    <a class="btn btn-default" rel="next" href='../../../../1/01/01/likelihood-calculation/'>next <i class="fa fa-chevron-right"></i></a></p>

  <br />

  <p> <a class="btn btn-default" 
         href="https://github.com/cboettig/cboettig.github.io/commits/master/content/lab-notebook/2010-08-26-Likelihood-Ratio-Paper--Power-in-Trees.md"><i class="fa fa-clock-o"></i> history</a></p>

  <p> <i class="fa fa-barcode"></i> SHA: <a href="https://github.com/cboettig/cboettig.github.io/blob/f54e337d9e377df50e497e7cd0a3ccf058650ab9/content/lab-notebook/2010-08-26-Likelihood-Ratio-Paper--Power-in-Trees.md">f54e337</a></p> 


</aside>

    </div>
  </div>
</div>


<section id="comments">
  <div id="disqus_thread">
    
  </div>
</section>

<footer class="site-footer">
  <hr />
  <div class="container">

  <div class="row">
    <div class="col-md-3 col-xs-4 socialicons" style="font-size:20px" typeof="foaf:Person" about="https://carlboettiger.info/#me">
      <p>
      <script type="text/javascript" src="../../../../js/obfuscate-email-link.js"></script> 

          <a rel="foaf:account" href="https://twitter.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Twitter'); 
             return false;"><span class="showtooltip" title="follow me on twitter (reading, discussing)"><i class="fa fa-twitter"></i></span></a> 

          <a rel="foaf:account" href="https://github.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Github'); 
             return false;"><span class="showtooltip" title="follow me on Github (code, research)"><i class="fa fa-github"></i></span></a>
           <a rel="foaf:weblog" type="application/atom+xml" href="../../../../index.xml"  
        class="showtooltip" title="RSS feeds for my blog-style entries." 
         onclick="recordOutboundLink(this, 'Outbound Links', 'RSS'); 
         return false;"><i class="fa fa-rss"></i></a>
       </p>
    </div>

    
    


    <div class="col-md-4 col-md-offset-1 col-xs-4">
	    <p><a onclick="recordOutboundLink(this, 'Outbound Links', 'ONS_claim'); return false;" href="http://onsclaims.wikispaces.com/"><img src="../../../../img/ons-aci2-icon.svg" alt="ONS" class="showtooltip" title="An Open Notebook Science (ONS) project claim: Entry provides all content (AC) immediately (I) or without significant delay.  See link for details"/></a></p>
    </div>


    <div class="col-md-3 col-md-offset-1 col-xs-4">
      <p>
      <a rel="license" property="http://creativecommons.org/ns#license" href="http://creativecommons.org/publicdomain/zero/1.0/" onclick="recordOutboundLink(this, 'Outbound Links', 'CC0'); return false;"><img src="../../../../img/cc-zero.svg" alt="CC0"/></a> 
      </p>
    </div>
  </div>
</footer>


    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/TweenMax.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/latest/plugins/ScrollToPlugin.min.js"></script>
    <script src="../../../../js/jquery-1.12.3.min.js"></script>
    <script src="../../../../js/bootstrap.min.js"></script>
    <script src="../../../../js/isotope.pkgd.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.1/imagesloaded.pkgd.min.js"></script>
    <script src="../../../../js/hugo-academic.js"></script>
    

    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-18401403-1', 'auto');
        ga('send', 'pageview');

         
        var links = document.querySelectorAll('a');
        Array.prototype.map.call(links, function(item) {
            if (item.host != document.location.host) {
                item.addEventListener('click', function() {
                    var action = item.getAttribute('data-action') || 'follow';
                    ga('send', 'event', 'outbound', action, item.href);
                });
            }
        });
    </script>
    

    
    
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

 

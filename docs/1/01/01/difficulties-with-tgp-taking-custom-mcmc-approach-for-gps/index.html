<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Hugo 0.20.2" />
  <meta name="author" content="Carl Boettiger">
  

  
  
  
    
    
    <link rel="stylesheet" href="../../../../css/highlight.min.css">
    
  
  
  <link rel="stylesheet" href="../../../../css/bootstrap.min.css">
  <link rel="stylesheet" href="../../../../css/font-awesome.min.css">
  <link rel="stylesheet" href="../../../../css/academicons.min.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700|Merriweather|Roboto+Mono">
  
  
    <link rel="stylesheet" href="../../../../css/cboettig.css">
  
  
  <link rel="alternate" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">
  <link rel="feed" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">

  <link rel="icon" type="image/png" href="../../../../img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="../../../../img/apple-touch-icon.png">
  <link rel="canonical" href="../../../../1/01/01/difficulties-with-tgp-taking-custom-mcmc-approach-for-gps/">


  <title>Difficulties with tgp; taking custom mcmc approach for GPs | Boettiger Group</title>

</head>
<body id="top" data-spy="scroll" data-target="#navbar-main" data-offset="71">


<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../../../">Boettiger Group</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav navbar-right">
        

        

        <li class="nav-item">
          <a href="../../../../index.html">
            
            <span>Home</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../members/">
            
            <span>Members</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../vita/">
            
            <span>Publications</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../teaching/">
            
            <span>Teaching</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../lab-notebook">
            
            <span>Lab Notebook</span>
          </a>
        </li>

        
        
      </ul>

    </div>
  </div>
</nav>


<div class="row">
  <div class="col-md-7 col-md-offset-1">
    <article>
    <h1>Difficulties with tgp; taking custom mcmc approach for GPs</h1> 
      
    

<p>Running into some unpredictable and not consistently replicable memory errors in the tgp function calls. Also rather troublesome that return object provides only posterior means for the process mean and covariance matrix.</p>

<h2 id="generic-gp-methods">Generic GP methods</h2>

<ul>
<li>Implemented MCMC sampler.  Excerpt below based on my <a href="https://github.com/cboettig/nonparametric-bayes/blob/e6c9b3048fd0cc50d0ec7eb00ac7cb9b00591618/inst/examples/gaussian-process-basics.md">gaussian-process-basics.md</a> script, as updated to include this case.<br /></li>
</ul>

<p>Define some example priors</p>

<pre><code class="language-r">lpriors &lt;- function(pars){
   d.p &lt;- c(5, 5)
  s2.p &lt;- c(5, 5)  
   
  prior &lt;- unname(
    dgamma(exp(pars[1]), d.p[1], scale = d.p[2]) *
    dgamma(exp(pars[2]), s2.p[1], s2.p[2]) 
  )
  
  log(prior)
}
</code></pre>

<p>Define the posterior function for our metropolis sampler</p>

<pre><code class="language-r">posterior &lt;- function(pars, x, y){
  
  l &lt;- exp(pars[1])
  sigma.n &lt;- exp(pars[2])
  
  cov &lt;- function(X, Y) outer(X, Y, SE, l)
  I &lt;- diag(1, length(x))
  K &lt;- cov(x, x) 
  
  loglik &lt;- - 0.5 * t(y) %*% solve(K + sigma.n^2 * I) %*% y -
    log(det(K + sigma.n^2*I)) -
    length(y) * log(2 * pi) / 2

  loglik + lpriors(pars)
}
  
</code></pre>

<p>I do not think we have good conjugate priors we can use in this situation to accomplish Gibbs sampling.  Instead we simply MCMC by the Metropolis-Hastings alogrithm,</p>

<pre><code class="language-r">require(mcmc)
n &lt;- 1e4
out &lt;- metrop(posterior, log(pars), n, x = obs$x, y = obs$y)
out$accept
</code></pre>

<pre><code>[1] 0.1509
</code></pre>

<p>Very good, we want an acceptance rate around 20%, if the literature can be trusted on this account.  We then plot transformed and untransformed traces.</p>

<pre><code class="language-r">postdist &lt;- cbind(index=1:n, as.data.frame(exp(out$batch)))
names(postdist) &lt;- c(&quot;index&quot;, names(pars))
df &lt;- melt(postdist, id=&quot;index&quot;)
# TRACES
ggplot(df) + geom_line(aes(index, value)) + facet_wrap(~ variable, scale=&quot;free&quot;, ncol=1)
</code></pre>

<p><img src="http://farm9.staticflickr.com/8395/8699032953_76e91621c7_o.png" alt="" /></p>

<pre><code class="language-r">
ggplot(df) + geom_line(aes(index, log(value))) + facet_wrap(~ variable, scale=&quot;free&quot;, ncol=1)
</code></pre>

<p><img src="http://farm9.staticflickr.com/8265/8699033067_631d27e6f7_o.png" alt="" /></p>

<p>Generate a plot to compare priors and posteriors</p>

<pre><code class="language-r">d.p &lt;- c(5, 5)
s2.p &lt;- c(5, 5)  
   
s2_prior &lt;- function(x) dgamma(x, s2.p[1], s2.p[2])
d_prior &lt;- function(x) dgamma(x, d.p[1], scale = d.p[2])
prior_fns &lt;- list(l = d_prior, sigma.n = s2_prior)


require(plyr)
prior_curves &lt;- ddply(df, &quot;variable&quot;, function(dd){
    grid &lt;- seq(min(dd$value), max(dd$value), length = 100)
    data.frame(value = grid, density = prior_fns[[dd$variable[1]]](grid))
})

# Posteriors (easier to read than histograms)
ggplot(df, aes(value)) + 
  stat_density(geom=&quot;path&quot;, position=&quot;identity&quot;, alpha=0.7) +
  geom_line(data=prior_curves, aes(x=value, y=density), col=&quot;red&quot;) + 
  facet_wrap(~ variable, scale=&quot;free&quot;, ncol=2)
</code></pre>

<p><img src="http://farm9.staticflickr.com/8405/8700155554_67aa26e564_o.png" alt="Note that posteriors closely match our priors, as we have only 4 data points in this toy example and our priors are reasonably informative." /></p>

<h2 id="steve-chat">Steve chat</h2>

<ol>
<li>integrate over posteriors in GP case</li>
<li>Ignore measurement uncertainty for the moment</li>
<li>General status updates, etc.<br /></li>
</ol>

<h2 id="marc-meeting">Marc meeting</h2>

<ol>
<li>Ricker case, but with constraint (e.g. maintain above n%)<br /></li>
<li>Consider Ricker model with external management constraint $ \alpha (Y / Y_opt) + (1 - \alpha) Pr( \textrm{satisfies constraint} )$</li>
<li>Consider time horizon of learning vs implementing; see diagram</li>
</ol>

<p><img src="https://lh3.googleusercontent.com/-56MSu3YuJsI/UYFrPQmvR3I/AAAAAAAADYg/_fSPs0czpCA/w548-h731/IMG_20130501_122021.jpg" alt="" /></p>

<h2 id="simone-talk">Simone talk</h2>

<ul>
<li><p>General interests: adaptive potential of small pops, demography of small pops, extinction processes in communities, evol life histories &amp; enviroment, ML for species distribution models.</p></li>

<li><p>Marble trout system under the influence of regular catastrophic floods</p></li>
</ul>

<h3 id="misc">Misc</h3>

<ul>
<li>6 hours on trains, 2 hours on buses, 1.25 hours on bicycle, 6 hours in lab.<br /></li>
<li>Interesting reading in <a href="http://www.wired.com/wiredenterprise/2012/04/openstack/">The Secret History of OpenStack, the Free Cloud Software That&rsquo;s Changing Everything</a>. Sounds just like the unlikely collaboration we need to emerge for a more robust and sustainable underlying scientific infrastructure.<br /></li>
</ul>

    </article>
  </div>
  <div class="col-md-4">
    <div class="sidebar">
      <aside prefix="og:http://ogp.me/ns/article#">
  
  
  
<div class="article-metadata">

  <p>
  <span class="article-date">
    <i class="fa fa-calendar"></i>
    
    <time datetime="0001-01-01 00:00:00 &#43;0000 UTC" itemprop="datePublished">
      Mon, Jan 1, 0001
    </time>
    
  </span>
  </p>
    

  <p>
  
  </p>
  
  <p>
  
  
  
  <span class="article-tags">
    <i class="fa fa-tags"></i>
    
    <a href="../../../../tags/nonparametric-bayes">nonparametric-bayes</a
    >
    
  </span>
  
  
  </p>

</div>

 
  <br />
  
  <p><a class="btn btn-default" rel="prev" href='../../../../1/01/01/deviations-from-s--d/'><i class="fa fa-chevron-left"></i> prev</a>
    <a class="btn btn-default" rel="next" href='../../../../1/01/01/do-we-need-a-culture-of-data-science-in-academia/'>next <i class="fa fa-chevron-right"></i></a></p>

  <br />

  <p> <a class="btn btn-default" 
         href="https://github.com/cboettig/cboettig.github.io/commits/master/content/lab-notebook/2013-04-30-tgp-difficulties-and-custom-mcmc-for-gp.md"><i class="fa fa-clock-o"></i> history</a></p>

  <p> <i class="fa fa-barcode"></i> SHA: <a href="https://github.com/cboettig/cboettig.github.io/blob/cd98680d81d38b2d90af25cb09955cd205505b2c/content/lab-notebook/2013-04-30-tgp-difficulties-and-custom-mcmc-for-gp.md">cd98680</a></p> 


</aside>

    </div>
  </div>
</div>


<section id="comments">
  <div id="disqus_thread">
    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'cboettig';
    var disqus_identifier = '\/1\/01\/01\/difficulties-with-tgp-taking-custom-mcmc-approach-for-gps\/';
    var disqus_title = 'Difficulties with tgp; taking custom mcmc approach for GPs';
    var disqus_url = '\/1\/01\/01\/difficulties-with-tgp-taking-custom-mcmc-approach-for-gps\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>
</section>

<footer class="site-footer">
  <hr />
  <div class="container">

  <div class="row">
    <div class="col-md-3 col-xs-4 socialicons" style="font-size:20px" typeof="foaf:Person" about="https://carlboettiger.info/#me">
      <p>
      <script type="text/javascript" src="../../../../js/obfuscate-email-link.js"></script> 

          <a rel="foaf:account" href="https://twitter.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Twitter'); 
             return false;"><span class="showtooltip" title="follow me on twitter (reading, discussing)"><i class="fa fa-twitter"></i></span></a> 

          <a rel="foaf:account" href="https://github.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Github'); 
             return false;"><span class="showtooltip" title="follow me on Github (code, research)"><i class="fa fa-github"></i></span></a>
           <a rel="foaf:weblog" type="application/atom+xml" href="../../../../index.xml"  
        class="showtooltip" title="RSS feeds for my blog-style entries." 
         onclick="recordOutboundLink(this, 'Outbound Links', 'RSS'); 
         return false;"><i class="fa fa-rss"></i></a>
       </p>
    </div>

    
    


    <div class="col-md-4 col-md-offset-1 col-xs-4">
	    <p><a onclick="recordOutboundLink(this, 'Outbound Links', 'ONS_claim'); return false;" href="http://onsclaims.wikispaces.com/"><img src="../../../../img/ons-aci2-icon.svg" alt="ONS" class="showtooltip" title="An Open Notebook Science (ONS) project claim: Entry provides all content (AC) immediately (I) or without significant delay.  See link for details"/></a></p>
    </div>


    <div class="col-md-3 col-md-offset-1 col-xs-4">
      <p>
      <a rel="license" property="http://creativecommons.org/ns#license" href="http://creativecommons.org/publicdomain/zero/1.0/" onclick="recordOutboundLink(this, 'Outbound Links', 'CC0'); return false;"><img src="../../../../img/cc-zero.svg" alt="CC0"/></a> 
      </p>
    </div>
  </div>
</footer>


    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/TweenMax.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/latest/plugins/ScrollToPlugin.min.js"></script>
    <script src="../../../../js/jquery-1.12.3.min.js"></script>
    <script src="../../../../js/bootstrap.min.js"></script>
    <script src="../../../../js/isotope.pkgd.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.1/imagesloaded.pkgd.min.js"></script>
    <script src="../../../../js/hugo-academic.js"></script>
    

    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-18401403-1', 'auto');
        ga('send', 'pageview');

         
        var links = document.querySelectorAll('a');
        Array.prototype.map.call(links, function(item) {
            if (item.host != document.location.host) {
                item.addEventListener('click', function() {
                    var action = item.getAttribute('data-action') || 'follow';
                    ga('send', 'event', 'outbound', action, item.href);
                });
            }
        });
    </script>
    

    
    
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

 

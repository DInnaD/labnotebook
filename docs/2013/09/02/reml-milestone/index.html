<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Hugo 0.20.2" />
  <meta name="author" content="Carl Boettiger">
  

  
  
  
    
    
    <link rel="stylesheet" href="../../../../css/highlight.min.css">
    
  
  
  <link rel="stylesheet" href="../../../../css/bootstrap.min.css">
  <link rel="stylesheet" href="../../../../css/font-awesome.min.css">
  <link rel="stylesheet" href="../../../../css/academicons.min.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700|Merriweather|Roboto+Mono">
  
  
    <link rel="stylesheet" href="../../../../css/cboettig.css">
  
  
  <link rel="alternate" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">
  <link rel="feed" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">

  <link rel="icon" type="image/png" href="../../../../img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="../../../../img/apple-touch-icon.png">
  <link rel="canonical" href="../../../../2013/09/02/reml-milestone/">


  <title> | Boettiger Group</title>

</head>
<body id="top" data-spy="scroll" data-target="#navbar-main" data-offset="71">


<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../../../">Boettiger Group</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav navbar-right">
        

        

        <li class="nav-item">
          <a href="../../../../index.html">
            
            <span>Home</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../members/">
            
            <span>Members</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../vita/">
            
            <span>Publications</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../teaching/">
            
            <span>Teaching</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../lab-notebook">
            
            <span>Lab Notebook</span>
          </a>
        </li>

        
        
      </ul>

    </div>
  </div>
</nav>


<div class="row">
  <div class="col-md-7 col-md-offset-1">
    <article>
    
      
    

<p>Reached a <a href="https://github.com/ropensci/reml/issues/milestones?state=closed&amp;with_issues=yes">milestone</a> in <a href="https://github.com/ropensci/reml">reml</a> development today with basic implementation of reading, writing, and publishing valid EML files and a working test suite.</p>

<h3 id="an-s4-based-structure">An S4-based structure</h3>

<p>This involved a complete re-write of the pre-ESA code and is now completely S4-class based, allowing a more flexible structure that is easier and faster to extend.  For instance, rather than having to explicitly think about the commands to parse and serialize a new metadata element that needs to be added from the schema, we just define the class for the object.  Then we can leverage automated methods that can read into this class from XML and write out of it.</p>

<p>For instance, we recently added the class <code>alternativeTimeScale</code> following it&rsquo;s <a href="knb.ecoinformatics.org/software/eml/eml-2.1.1/eml-coverage.html#alternativeTimeScale">definition in the Schema documentation</a>:</p>

<pre><code class="language-r">setClass(&quot;alternativeTimeScale&quot;,
         representation(timeScaleName = &quot;character&quot;,
                        timeScaleAgeEstimate = &quot;character&quot;,
                        timeScaleAgeUncertainty = &quot;character&quot;,
                        timeScaleAgeExplanation = &quot;character&quot;,
                        timeScaleCitation = &quot;character&quot;) 
                        # FIXME should be citation type
        )
setAs(&quot;XMLInternalElementNode&quot;, &quot;alternativeTimeScale&quot;,   function(from) emlToS4(from))
setAs(&quot;alternativeTimeScale&quot;, &quot;XMLInternalElementNode&quot;,   function(from) S4Toeml(from))
</code></pre>

<p>Rather than bother with the XML parsing and serializing, we simply point R to use our predefined S4 coercion methods, specified after the class definition.</p>

<p>Note this need a little more work as the FIXME note indicates,
since we have not yet written the <code>citation</code> class. Luckily, using the S4 approach this will be easy to update once that class is defined.  In this manner, we can easily add elements that we need.</p>

<p>Classes are defined in groups in files named after the class.  Constructor functions are defined in files named after the functions themselves, which prefix <code>eml_</code> to the class name.  This adds some clarity (e.g. calling a function <code>eml_dataset</code> vs <code>dataset</code>) can also reduce namespace collisions.</p>

<p><strong>Note</strong> that the S4 code is intended only to be developer-facing.  Users interact with documented constructor functions, which have more end-user documentation (though still in development).</p>

<h2 id="examples-of-reading-writing-and-publishing-eml">Examples of reading, writing, and publishing EML</h2>

<pre><code class="language-r">library(&quot;devtools&quot;)
install_github(&quot;reml&quot;, &quot;ropensci&quot;)
</code></pre>

<p>Load the package:</p>

<pre><code class="language-r">library(&quot;reml&quot;)
</code></pre>

<h3 id="writing-r-data-into-eml">Writing R data into EML</h3>

<p>Consider some dataset as an R <code>data.frame</code>.</p>

<pre><code class="language-r">dat = data.frame(river = c(&quot;SAC&quot;, &quot;SAC&quot;, &quot;AM&quot;),
                 spp   = c(&quot;king&quot;, &quot;king&quot;, &quot;ccho&quot;),
                 stg   = c(&quot;smolt&quot;, &quot;parr&quot;, &quot;smolt&quot;),
                 ct    =  c(293L, 410L, 210L))
</code></pre>

<p>Provide a list giving the  <strong>column header</strong> used in the data.frame, followed by a plain text definitions for the column, followed by a character vector giving the definition for the units:</p>

<p><strong>column descriptions</strong>: These are usually just plain text definitions, though a URI to a semantic definition can be particularly powerful. See &ldquo;Advanced Use&rdquo; for details on adding richer information, such as the method used to collect the data or set the geographic, taxonomic, or temporal coverage of an individual column.</p>

<p><strong>column units</strong>:   For factors, this is a definition of the levels involved.  For numeric data, specify the units from <a href="http://knb.ecoinformatics.org/software/eml/eml-2.1.1/eml-unitTypeDefinitions.html#StandardUnitDictionary">this list</a>.  For dates, specify the format, (e.g. YYYY or MM-DD-YY). For character strings, a definition of the kind of string can be given, (e.g. species scientific name), otherwise the column description will be used.</p>

<pre><code class="language-r">metadata &lt;- 
  list(&quot;river&quot; = list(&quot;river&quot;,
                      &quot;River site used for collection&quot;,
                      c(SAC = &quot;The Sacramento River&quot;, 
                        AM = &quot;The American River&quot;)),
       &quot;spp&quot; = list(&quot;spp&quot;,
                    &quot;Species common name&quot;, 
                    c(king = &quot;King Salmon&quot;, 
                      ccho = &quot;Coho Salmon&quot;)),
       &quot;stg&quot; = list(&quot;stg&quot;,
                    &quot;Life Stage&quot;, 
                    c(parr = &quot;third life stage&quot;, 
                      smolt = &quot;fourth life stage&quot;)),
       &quot;ct&quot;  = list(&quot;ct&quot;,
                    &quot;count&quot;, 
                    &quot;number&quot;))
</code></pre>

<p><em>for convenience, this metadata list can instead be constructed with the help of the reml wizard</em>.  Just use <code>metadata &lt;- metadata_wizard(dat)</code> to begin. While this may be helpful starting out, regular users will find it faster to define the columns and units directly in the format above.</p>

<pre><code class="language-r">eml_write(dat, metadata, title = &quot;reml example&quot;,  
          description = &quot;An example, intended for
                              illustrative purposes only.&quot;,
          creator = &quot;Carl Boettiger &lt;cboettig@gmail.com&gt;&quot;,
          file = &quot;reml_example.xml&quot;)
</code></pre>

<pre><code>[1] &quot;reml_example.xml&quot;
</code></pre>

<p>See the <a href="https://github.com/ropensci/reml/tree/master/inst/doc/reml_example.xml">EML generated</a> by this example.  Note that if the <code>metadata</code> argument providing the definitions for the <code>data.frame</code> is not specified, <code>reml</code> will launch the wizard to prompt the user.</p>

<h5 id="configuration">Configuration</h5>

<p>Configure general metadata you may want to frequently reuse, avoiding having to specify things like the name of the creator or contact.</p>

<pre><code class="language-r">eml_config(creator = list(&quot;Carl Boettiger &lt;cboettig@ropensci.org&gt;&quot;, &quot;Karthik Ram&quot;), contact = &quot;Carl Boettiger &lt;cboettig@ropensci.org&gt;&quot;)
</code></pre>

<ul>
<li>See <a href="https://github.com/ropensci/reml/issues?labels=write+eml&amp;page=1&amp;state=open">Open issues in writing EML</a></li>
</ul>

<h3 id="publish-eml">Publish EML</h3>

<p>Once we have generated a basic EML file, we can publish it to a variety
of academic repositories where it will be indexed, permenently archived,
more easily citable, and publicly discoverable.</p>

<p>In this example, we will publish the above
EML to <a href="http://figshare.com">figshare</a> using the
<a href="https://github.com/ropensci/rfigshare">rfigshare</a> package. Like most
academic repostories, figshare requires some basic metadata for any entry.
Much of this we can automatically extract from our existing EML file.
Additional metadata unique to figshare (e.g. matching it&rsquo;s allowed &ldquo;categories&rdquo;
can also be provided.</p>

<p><em>Note: this example assumes <code>rfigshare</code> is installed, even though it is not
required to use reml and run the examples in the other sections</em></p>

<pre><code class="language-r">id = eml_publish(&quot;reml_example.xml&quot;, description=&quot;Example EML file from reml&quot;, categories = &quot;Ecology&quot;, tags = &quot;EML&quot;, destination=&quot;figshare&quot;)
</code></pre>

<p>This creates a draft file visible only to the user configured in <code>rfigshare</code>.  The document can be made (permanently) public using either the figshare web interface, the <code>rfigshare</code> package (using <code>fs_make_public(id)</code>) or just by adding the argument <code>visibility = TRUE</code> to the above <code>eml_publish</code> command.</p>

<h3 id="reading-eml">Reading EML</h3>

<pre><code class="language-r">obj &lt;- eml_read(&quot;reml_example.xml&quot;)
</code></pre>

<p>We can use various accessor functions to return the data and metadata elements in native R formats.</p>

<pre><code class="language-r">dataTable(obj)
</code></pre>

<pre><code>  river  spp   stg  ct
1   SAC king smolt 293
2   SAC king  parr 410
3    AM ccho smolt 210
</code></pre>

<pre><code class="language-r">metadata &lt;- attributeList(obj)
</code></pre>

<pre><code class="language-r">contact(obj)
</code></pre>

<pre><code>[1] &quot;Carl Boettiger &lt;cboettig@gmail.com&gt;&quot;
</code></pre>

<p>Note that the contact has been coerced into R&rsquo;s built-in &lsquo;person&rsquo; object:</p>

<pre><code class="language-r">class(contact(obj))
</code></pre>

<pre><code>[1] &quot;person&quot;
</code></pre>

<pre><code class="language-r">citationInfo(obj)
</code></pre>

<pre><code>Boettiger, Carl, 2013. reml example.
</code></pre>

<p>Vignette + read and extract examples</p>

<h2 id="notes">Notes</h2>

<ul>
<li><p>Resolved the strange segfault errors that arise unpredictably in tests by avoiding use of <code>XMLInternalDocument</code> class.  (Perhaps it is referencing the nodes after writing this and finding they have no address that causes this error?)  Now segfault free.</p></li>

<li><p>Still need to fix external validator test (currently not run by <code>testthat::test_dir</code> by avoiding the <code>test_</code> prefix on the filename&hellip;) <strong>EDIT</strong> 2013-09-05 Duncan has [fixed]() this, looking into having the form give more structured output.</p></li>

<li><p><strong>Edit</strong> 2013-09-04 some attribute definitions were not being written out correctly and have now been fixed.  Still writing the [test cases]().</p></li>
</ul>

<h2 id="where-next">Where next?</h2>

<p>Lots more can be done on the package, as documented in our extensive <a href="https://github.com/ropensci/reml/issues">issues</a> list and the discussions there-in.</p>

<p>Further development will be driven around identifying and illustrating some particularly motivating use-cases beyond the basic creation and reading in of EML files, adding what additional functionality and debugging is required along the way.</p>

    </article>
  </div>
  <div class="col-md-4">
    <div class="sidebar">
      <aside prefix="og:http://ogp.me/ns/article#">
  
  
  
<div class="article-metadata">

  <p>
  <span class="article-date">
    <i class="fa fa-calendar"></i>
    
    <time datetime="2013-09-02 00:00:00 &#43;0000 UTC" itemprop="datePublished">
      Mon, Sep 2, 2013
    </time>
    
  </span>
  </p>
    

  <p>
  
  
  
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="../../../../categories/ecology">ecology</a
    >
    
  </span>
  
  
  </p>
  
  <p>
  
  
  
  <span class="article-tags">
    <i class="fa fa-tags"></i>
    
    <a href="../../../../tags/ropensci">ropensci</a
    >
    
  </span>
  
  
  </p>

</div>

 
  <br />
  
  <p><a class="btn btn-default" rel="prev" href='../../../../2013/09/05/whitehouse-open-data-memorandum/'><i class="fa fa-chevron-left"></i> prev</a>
    <a class="btn btn-default" rel="next" href='../../../../2013/08/29/notes/'>next <i class="fa fa-chevron-right"></i></a></p>

  <br />

  <p> <a class="btn btn-default" 
         href="https://github.com/cboettig/cboettig.github.io/commits/master/content/lab-notebook/2013-09-02-reml-milestone.md"><i class="fa fa-clock-o"></i> history</a></p>

  <p> <i class="fa fa-barcode"></i> SHA: <a href="https://github.com/cboettig/cboettig.github.io/blob/9d9072923c46d635718a4624d6afff6b1ec2439f/content/lab-notebook/2013-09-02-reml-milestone.md">9d9072923</a></p> 


</aside>

    </div>
  </div>
</div>


<section id="comments">
  <div id="disqus_thread">
    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'cboettig';
    var disqus_identifier = '\/2013\/09\/02\/reml-milestone\/';
    var disqus_title = '';
    var disqus_url = '\/2013\/09\/02\/reml-milestone\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>
</section>

<footer class="site-footer">
  <hr />
  <div class="container">

  <div class="row">
    <div class="col-md-3 col-xs-4 socialicons" style="font-size:20px" typeof="foaf:Person" about="https://carlboettiger.info/#me">
      <p>
      <script type="text/javascript" src="../../../../js/obfuscate-email-link.js"></script> 

          <a rel="foaf:account" href="https://twitter.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Twitter'); 
             return false;"><span class="showtooltip" title="follow me on twitter (reading, discussing)"><i class="fa fa-twitter"></i></span></a> 

          <a rel="foaf:account" href="https://github.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Github'); 
             return false;"><span class="showtooltip" title="follow me on Github (code, research)"><i class="fa fa-github"></i></span></a>
           <a rel="foaf:weblog" type="application/atom+xml" href="../../../../index.xml"  
        class="showtooltip" title="RSS feeds for my blog-style entries." 
         onclick="recordOutboundLink(this, 'Outbound Links', 'RSS'); 
         return false;"><i class="fa fa-rss"></i></a>
       </p>
    </div>

    
    


    <div class="col-md-4 col-md-offset-1 col-xs-4">
	    <p><a onclick="recordOutboundLink(this, 'Outbound Links', 'ONS_claim'); return false;" href="http://onsclaims.wikispaces.com/"><img src="../../../../img/ons-aci2-icon.svg" alt="ONS" class="showtooltip" title="An Open Notebook Science (ONS) project claim: Entry provides all content (AC) immediately (I) or without significant delay.  See link for details"/></a></p>
    </div>


    <div class="col-md-3 col-md-offset-1 col-xs-4">
      <p>
      <a rel="license" property="http://creativecommons.org/ns#license" href="http://creativecommons.org/publicdomain/zero/1.0/" onclick="recordOutboundLink(this, 'Outbound Links', 'CC0'); return false;"><img src="../../../../img/cc-zero.svg" alt="CC0"/></a> 
      </p>
    </div>
  </div>
</footer>


    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/TweenMax.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/latest/plugins/ScrollToPlugin.min.js"></script>
    <script src="../../../../js/jquery-1.12.3.min.js"></script>
    <script src="../../../../js/bootstrap.min.js"></script>
    <script src="../../../../js/isotope.pkgd.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.1/imagesloaded.pkgd.min.js"></script>
    <script src="../../../../js/hugo-academic.js"></script>
    

    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-18401403-1', 'auto');
        ga('send', 'pageview');

         
        var links = document.querySelectorAll('a');
        Array.prototype.map.call(links, function(item) {
            if (item.host != document.location.host) {
                item.addEventListener('click', function() {
                    var action = item.getAttribute('data-action') || 'follow';
                    ga('send', 'event', 'outbound', action, item.href);
                });
            }
        });
    </script>
    

    
    
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

 

<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Hugo 0.21" />
  <meta name="author" content="Carl Boettiger">
  

  
  
  
    
    
    <link rel="stylesheet" href="../../../../css/highlight.min.css">
    
  
  
  <link rel="stylesheet" href="../../../../css/bootstrap.min.css">
  <link rel="stylesheet" href="../../../../css/font-awesome.min.css">
  <link rel="stylesheet" href="../../../../css/academicons.min.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700|Merriweather|Roboto+Mono">
  
  
    <link rel="stylesheet" href="../../../../css/cboettig.css">
  
  
  <link rel="alternate" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">
  <link rel="feed" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">

  <link rel="icon" type="image/png" href="../../../../img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="../../../../img/apple-touch-icon.png">
  <link rel="canonical" href="../../../../2014/08/14/docker-notes/">


  <title> | Boettiger Group</title>

</head>
<body id="top" data-spy="scroll" data-target="#navbar-main" data-offset="71">


<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../../../">Boettiger Group</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav navbar-right">
        

        

        <li class="nav-item">
          <a href="../../../../index.html">
            
            <span>Home</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../members/">
            
            <span>Members</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../vita/">
            
            <span>Publications</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../teaching/">
            
            <span>Teaching</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../lab-notebook">
            
            <span>Lab Notebook</span>
          </a>
        </li>

        
        
      </ul>

    </div>
  </div>
</nav>


<div class = "container">


<div class="row">
  <div class="col-md-7 col-md-offset-1">
    <article>
    
      
    

<p>Ticking through a few more of the challenges I raised in my <a href="http://www.carlboettiger.info/2014/08/07/too-much-fun-with-docker.html">first post on
docker</a>;
here I explore some of the issues about facilitating interaction with a
docker container so that a user&rsquo;s experience is more similar to working
in their own environment and less like working on a remote terminal
over ssh. While technically minor, these issues are probably the first
stumbling blocks in making this a valid platform for new users.</p>

<h2 id="sharing-a-local-directory">Sharing a local directory</h2>

<p>Launch a bash shell on the container that shares the current working
directory of the host machine (from <code>pwd</code>) with the <code>/host</code> directory
on the container (thanks to Dirk for this solution):</p>

<pre><code class="language-bash">docker run -it -v $(pwd):/host cboettig/ropensci-docker /bin/bash
</code></pre>

<p>This allows a user to move files on and off the container, use a familiar
editor and even handle things like git commits / pulls / pushes in
their working directory as before.  Then the code can be executed in the
containerized environment which handles all the dependencies.  From the
terminal docker opens, we just <code>cd /host</code> where we find our working
directory files, and can launch R and run the scripts. A rather clean
way of maintaining the local development experience but containerizing
execution.</p>

<p>In particular, this frees us from having to pass our git credentials etc
to the container, though is not so useful if we&rsquo;re wanting to interact
with the container via the RStudio server instead of R running in the
terminal. (More on getting around this below).</p>

<p>Unfortunately, Mac and Windows users have to run Docker inside an
already-virualized environment such as provided by <code>boot2docker</code>
or <code>vagrant</code>.  This means that it is only the directories on the
virtualized environment, not those on the native OS, can be shared in
this way.  While one could presumably keep a directory synced between
this virtual environment and the native OS, (standard in in <code>vagrant</code>),
this is a problem for the easier-to-use <code>boot2docker</code> at this time:
(<a href="https://github.com/docker/docker/issues/7249">docker/issues/7249</a>).</p>

<h2 id="a-docker-desktop">A Docker Desktop</h2>

<p>Dirk brought this
<a href="http://blog.docker.com/2013/07/docker-desktop-your-desktop-over-ssh-running-inside-of-a-docker-container">docker-desktop</a>
to my attention; which uses Xpra (in place of X11 forwarding) to provide a
window with fluxbox running on Ubuntu along with common applications like
libreoffce, firefox, and rox file manager.  Pretty clever, and worked
just fine for me, but needs Xpra on the client machine and requires
some extra steps (run the container, query for passwords and ports,
run ssh to connect, then run Xpra to launch the window). The result is
reasonably responsive but still slower than virtualbox, and probably
too slow for real work.</p>

<h2 id="base-images">Base images?</h2>

<p>The basic Ubuntu:14.04 seems like a good lightweight base image (at
192 MB), but other images try to give more useful building blocks, like
<a href="https://github.com/phusion/baseimage-docker#contents">phusion/baseimage</a>
(423 MB). Their <code>docker-bash</code> script and other utilities provide some
handy features for managing / debugging containers.</p>

<h2 id="other-ways-to-share-files">Other ways to share files?</h2>

<p>Took a quick look at this <a href="https://github.com/gfjardim/docker-dropbox/blob/master/Dockerfile">Dockerfile for running
dropbox</a>,
which works rather well (at least on a linux machine, since it requires
local directory sharing). Could probably be done without explicit linking
to local directories to faciliate moving files on and off the container.
Of course one can always scp/rsync files on and off containers if ssh
is set up, but that is unlikely to be a popular solution for students.</p>

<p>While we have rstudio server running nicely in a Docker container for
local or cloud use, it&rsquo;s still an issue getting Github ssh keys set up
to be able to push changes to a repo. We can get around this by linking
to our keys directory with the same <code>-v</code> option shown above.  We still
need a few more steps: setting the Git username and email, and running
<code>ssh-add</code> for the key.  Presumably we could do this with environmental
variables and some adjustment to the Dockerfile:</p>

<pre><code class="language-bash">docker run -it -v /path/to/keys:/home/rstudio/.ssh/ -e &quot;USERNAME=Carl Boettiger&quot; -e &quot;EMAIL=cboettig@example.org&quot; cboettig/ropensci-docker
</code></pre>

<p>which would prevent storing these secure values on the image itself.</p>

    </article>
  </div>
  <div class="col-md-4">
    <div class="sidebar">
      <aside prefix="og:http://ogp.me/ns/article#">
  
  
  
<div class="article-metadata">

  <p>
  <span class="article-date">
    <i class="fa fa-calendar"></i>
    
    <time datetime="2014-08-14 00:00:00 &#43;0000 UTC" itemprop="datePublished">
      Thu, Aug 14, 2014
    </time>
    
  </span>
  </p>
    

  <p>
  
  
  
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="../../../../categories/open-science">open-science</a
    >
    
  </span>
  
  
  </p>
  
  <p>
  
  
  
  <span class="article-tags">
    <i class="fa fa-tags"></i>
    
    <a href="../../../../tags/blog">blog</a
    >, 
    
    <a href="../../../../tags/docker">docker</a
    >
    
  </span>
  
  
  </p>

</div>

 
  <br />
  
  <p><a class="btn btn-default" rel="prev" href='../../../../2014/08/25/reproducible-research-environments-with-docker/'><i class="fa fa-chevron-left"></i> prev</a>
    <a class="btn btn-default" rel="next" href='../../../../2014/08/14/pdg-controlfest-notes/'>next <i class="fa fa-chevron-right"></i></a></p>

  <br />

  <p> <a class="btn btn-default" 
         href="https://github.com/cboettig/cboettig.github.io/commits/master/content/lab-notebook/2014-08-14-docker-notes.md"><i class="fa fa-clock-o"></i> history</a></p>

  <p> <i class="fa fa-barcode"></i> SHA: <a href="https://github.com/cboettig/cboettig.github.io/blob/9d9072923c46d635718a4624d6afff6b1ec2439f/content/lab-notebook/2014-08-14-docker-notes.md">9d90729</a></p> 


</aside>

    </div>
  </div>
</div>


<section id="comments">
  <div id="disqus_thread">
    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'cboettig';
    var disqus_identifier = '\/2014\/08\/14\/docker-notes\/';
    var disqus_title = '';
    var disqus_url = '\/2014\/08\/14\/docker-notes\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>
</section>


</div>

<footer class="site-footer">
  <hr />
  <div class="container">

  <div class="row">
    <div class="col-md-3 col-xs-4 socialicons" style="font-size:20px" typeof="foaf:Person" about="https://carlboettiger.info/#me">
      <p>
      <script type="text/javascript" src="../../../../js/obfuscate-email-link.js"></script> 

          <a rel="foaf:account" href="https://twitter.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Twitter'); 
             return false;"><span class="showtooltip" title="follow me on twitter (reading, discussing)"><i class="fa fa-twitter"></i></span></a> 

          <a rel="foaf:account" href="https://github.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Github'); 
             return false;"><span class="showtooltip" title="follow me on Github (code, research)"><i class="fa fa-github"></i></span></a>
           <a rel="foaf:weblog" type="application/atom+xml" href="../../../../index.xml"  
        class="showtooltip" title="RSS feeds for my blog-style entries." 
         onclick="recordOutboundLink(this, 'Outbound Links', 'RSS'); 
         return false;"><i class="fa fa-rss"></i></a>
       </p>
    </div>

    
    


    <div class="col-md-4 col-md-offset-1 col-xs-4">
	    <p><a onclick="recordOutboundLink(this, 'Outbound Links', 'ONS_claim'); return false;" href="http://onsclaims.wikispaces.com/"><img src="../../../../img/ons-aci2-icon.svg" alt="ONS" class="showtooltip" title="An Open Notebook Science (ONS) project claim: Entry provides all content (AC) immediately (I) or without significant delay.  See link for details"/></a></p>
    </div>


    <div class="col-md-3 col-md-offset-1 col-xs-4">
      <p>
      <a rel="license" property="http://creativecommons.org/ns#license" href="http://creativecommons.org/publicdomain/zero/1.0/" onclick="recordOutboundLink(this, 'Outbound Links', 'CC0'); return false;"><img src="../../../../img/cc-zero.svg" alt="CC0"/></a> 
      </p>
    </div>
  </div>
</footer>


    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/TweenMax.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/latest/plugins/ScrollToPlugin.min.js"></script>
    <script src="../../../../js/jquery-1.12.3.min.js"></script>
    <script src="../../../../js/bootstrap.min.js"></script>
    <script src="../../../../js/isotope.pkgd.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.1/imagesloaded.pkgd.min.js"></script>
    <script src="../../../../js/hugo-academic.js"></script>
    

    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-18401403-1', 'auto');
        ga('send', 'pageview');

         
        var links = document.querySelectorAll('a');
        Array.prototype.map.call(links, function(item) {
            if (item.host != document.location.host) {
                item.addEventListener('click', function() {
                    var action = item.getAttribute('data-action') || 'follow';
                    ga('send', 'event', 'outbound', action, item.href);
                });
            }
        });
    </script>
    

    
    
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
    </script>
    <script async src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML"></script>
    

  </body>
</html>

   
<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Hugo 0.20.2" />
  <meta name="author" content="Carl Boettiger">
  

  
  
  
    
    
    <link rel="stylesheet" href="../../../../css/highlight.min.css">
    
  
  
  <link rel="stylesheet" href="../../../../css/bootstrap.min.css">
  <link rel="stylesheet" href="../../../../css/font-awesome.min.css">
  <link rel="stylesheet" href="../../../../css/academicons.min.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700|Merriweather|Roboto+Mono">
  
  
    <link rel="stylesheet" href="../../../../css/cboettig.css">
  
  
  <link rel="alternate" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">
  <link rel="feed" href="../../../../index.xml" type="application/rss+xml" title="Boettiger Group">

  <link rel="icon" type="image/png" href="../../../../img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="../../../../img/apple-touch-icon.png">
  <link rel="canonical" href="../../../../2014/09/09/server-backups/">


  <title> | Boettiger Group</title>

</head>
<body id="top" data-spy="scroll" data-target="#navbar-main" data-offset="71">


<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../../../">Boettiger Group</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav navbar-right">
        

        

        <li class="nav-item">
          <a href="../../../../index.html">
            
            <span>Home</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../members/">
            
            <span>Members</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../vita/">
            
            <span>Publications</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../teaching/">
            
            <span>Teaching</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../../../lab-notebook">
            
            <span>Lab Notebook</span>
          </a>
        </li>

        
        
      </ul>

    </div>
  </div>
</nav>


<div class="row">
  <div class="col-md-7 col-md-offset-1">
    <article>
    
      
    

<h2 id="digital-ocean-snapshots">Digital Ocean Snapshots</h2>

<p>At $0.02 per gig per month, this looks like this is the cheapest way to
make complete backups.</p>

<p>The process is rather manual: we have to <code>sudo poweroff</code> the droplet
and then trigger the snapshot (the container will come back online
after that, though we have to restart the services / active docker
containers). We also have to delete old snapshots manually.  Some of
this can be automated from the API. DigitalOcean uses redundant storage
for these (paying $0.01/month/gigabyte to Amazon Glacier), but at the
moment we can&rsquo;t export these images. Snapshots are also handy to deploy
to a larger (but not smaller) droplet.</p>

<h3 id="digital-ocean-backups">Digital Ocean Backups</h3>

<p>These backups are an automated, always-online alternative to snapshots
but must me initialized when the droplet is created and cost more (20%
of server cost).</p>

<h2 id="manually-configuring-backups">Manually configuring backups</h2>

<p>To have the flexibility to restore individual pieces, to move between
machines, etc we need a different approach.</p>

<h3 id="container-backups">Container backups</h3>

<p>Docker containers, including running containers, should be effectively
backed up by either of these approaches to the state we would be in
after a power cycle (e.g. we may need to start stopped containers,
but not rebuild them from scratch).</p>

<p>Nevertheless we may want to back up containers themselves. For many
containers this is trivial (e.g. our ssh container): we can just commit
the running container to an image and save that as a tar archive (or
equivalently, just export the container to a tarball).</p>

<p>If the containers have a <code>VOLUME</code> command in their dockerfile or
in their execution however, this is insufficient.  Containers using
volumes (such as <code>sameersbn/gitlab</code> and <code>mattgruter/drone</code>) need <a href="http://serverfault.com/questions/576490/docker-volume-backup-and-restore">four
things</a>
to be backed up:</p>

<ul>
<li>Dockerfile (or container image, from <code>save</code> or <code>commit</code>)</li>
<li>volume</li>
<li>volume path in container</li>
<li>name of the container the volume belongs to</li>
</ul>

<p>A <a href="https://github.com/discordianfish/docker-backup">utility</a> makes this easier.</p>

<h3 id="sparkleshare">Sparkleshare</h3>

<p>Sparkleshare is a git-backed dropbox alterantive.  With binaries for most
major platforms (Windows, Mac, Ubuntu/Linux) it&rsquo;s pretty easy to set up
and acts in much the same way, with automated synch and notifications.
The backend just needs a server running git &ndash; Gitlab is a great way
to set this up to permit relatively easy sharing / user management.
(Ignore the information about setting up separately on a server,
Gitlab is much easier.  Also ignore advice about building from source
on Ubuntu, installing the binary is far more straight forward: <code>apt-get
install sparkleshare</code>.  Certainly it is not as feature rich as dropbox
(e.g. email links to add users, web links to share individual files),
but easy sharing over the server at no extra cost.  The Sparkleshare
directory is also a fully functional git repo.</p>

<h3 id="encrypted-backup-of-filesystem-with-duplicity">Encrypted backup of filesystem with duplicity</h3>

<p>See <a href="https://www.digitalocean.com/community/tutorials/how-to-use-duplicity-with-gpg-to-securely-automate-backups-on-ubuntu">Duplicity setup</a></p>

<p>Good for backing up to another host for which we have ssh access, or to
an Amazon S3 bucket, etc.  (Unclear if this works with Glacier due to
upload-only et-up).</p>

<h3 id="some-other-rates-for-data-storage">Some other rates for data storage:</h3>

<ul>
<li>Compare to S3 ($0.03 /gig/month)</li>
<li>EBS ($0.12 /gig/month) (really
for computing I/O, not storage).</li>
<li>Remarkably, Google Drive and
Dropbox now offer 1 TB at $10 / mo.  Clearly a lot can be saved by
&lsquo;overselling&rsquo; (most users will not use their capacity) and by shared
files (counting against the space for all users but requiring no more
storage capacity). Nonetheless, impressive, on par with Glacier (without
the bandwidth charges or delay).</li>
<li>For comparison, (non-redundant, non-enterprise, disk-based) storage is roughly $100/TB, or on order of that annual cost.</li>
</ul>

    </article>
  </div>
  <div class="col-md-4">
    <div class="sidebar">
      <aside prefix="og:http://ogp.me/ns/article#">
  
  
  
<div class="article-metadata">

  <p>
  <span class="article-date">
    <i class="fa fa-calendar"></i>
    
    <time datetime="2014-09-09 00:00:00 &#43;0000 UTC" itemprop="datePublished">
      Tue, Sep 9, 2014
    </time>
    
  </span>
  </p>
    

  <p>
  
  
  
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="../../../../categories/computing">computing</a
    >
    
  </span>
  
  
  </p>
  
  <p>
  
  
  
  <span class="article-tags">
    <i class="fa fa-tags"></i>
    
    <a href="../../../../tags/digitalocean">digitalocean</a
    >, 
    
    <a href="../../../../tags/docker">docker</a
    >
    
  </span>
  
  
  </p>

</div>

 
  <br />
  
  <p><a class="btn btn-default" rel="prev" href='../../../../2014/09/22/containerizing-my-development-environment/'><i class="fa fa-chevron-left"></i> prev</a>
    <a class="btn btn-default" rel="next" href='../../../../2014/09/08/server-security-basics/'>next <i class="fa fa-chevron-right"></i></a></p>

  <br />

  <p> <a class="btn btn-default" 
         href="https://github.com/cboettig/cboettig.github.io/commits/master/content/lab-notebook/2014-09-09-server-backups.md"><i class="fa fa-clock-o"></i> history</a></p>

  <p> <i class="fa fa-barcode"></i> SHA: <a href="https://github.com/cboettig/cboettig.github.io/blob/9d9072923c46d635718a4624d6afff6b1ec2439f/content/lab-notebook/2014-09-09-server-backups.md">9d9072923</a></p> 


</aside>

    </div>
  </div>
</div>


<section id="comments">
  <div id="disqus_thread">
    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'cboettig';
    var disqus_identifier = '\/2014\/09\/09\/server-backups\/';
    var disqus_title = '';
    var disqus_url = '\/2014\/09\/09\/server-backups\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>
</section>

<footer class="site-footer">
  <hr />
  <div class="container">

  <div class="row">
    <div class="col-md-3 col-xs-4 socialicons" style="font-size:20px" typeof="foaf:Person" about="https://carlboettiger.info/#me">
      <p>
      <script type="text/javascript" src="../../../../js/obfuscate-email-link.js"></script> 

          <a rel="foaf:account" href="https://twitter.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Twitter'); 
             return false;"><span class="showtooltip" title="follow me on twitter (reading, discussing)"><i class="fa fa-twitter"></i></span></a> 

          <a rel="foaf:account" href="https://github.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Github'); 
             return false;"><span class="showtooltip" title="follow me on Github (code, research)"><i class="fa fa-github"></i></span></a>
           <a rel="foaf:weblog" type="application/atom+xml" href="../../../../index.xml"  
        class="showtooltip" title="RSS feeds for my blog-style entries." 
         onclick="recordOutboundLink(this, 'Outbound Links', 'RSS'); 
         return false;"><i class="fa fa-rss"></i></a>
       </p>
    </div>

    
    


    <div class="col-md-4 col-md-offset-1 col-xs-4">
	    <p><a onclick="recordOutboundLink(this, 'Outbound Links', 'ONS_claim'); return false;" href="http://onsclaims.wikispaces.com/"><img src="../../../../img/ons-aci2-icon.svg" alt="ONS" class="showtooltip" title="An Open Notebook Science (ONS) project claim: Entry provides all content (AC) immediately (I) or without significant delay.  See link for details"/></a></p>
    </div>


    <div class="col-md-3 col-md-offset-1 col-xs-4">
      <p>
      <a rel="license" property="http://creativecommons.org/ns#license" href="http://creativecommons.org/publicdomain/zero/1.0/" onclick="recordOutboundLink(this, 'Outbound Links', 'CC0'); return false;"><img src="../../../../img/cc-zero.svg" alt="CC0"/></a> 
      </p>
    </div>
  </div>
</footer>


    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/TweenMax.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/latest/plugins/ScrollToPlugin.min.js"></script>
    <script src="../../../../js/jquery-1.12.3.min.js"></script>
    <script src="../../../../js/bootstrap.min.js"></script>
    <script src="../../../../js/isotope.pkgd.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.1/imagesloaded.pkgd.min.js"></script>
    <script src="../../../../js/hugo-academic.js"></script>
    

    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-18401403-1', 'auto');
        ga('send', 'pageview');

         
        var links = document.querySelectorAll('a');
        Array.prototype.map.call(links, function(item) {
            if (item.host != document.location.host) {
                item.addEventListener('click', function() {
                    var action = item.getAttribute('data-action') || 'follow';
                    ga('send', 'event', 'outbound', action, item.href);
                });
            }
        });
    </script>
    

    
    
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

 

<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head prefix="dc: http://purl.org/dc/terms/ og: http://ogp.me/ns#"> <!-- namespaces used in metadata.html -->
  <meta http-equiv='Content-Type' content='text/html; charset=utf-8'/>
  <title>Lab Notebook</title>
  <meta name="author" content="Carl Boettiger" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- HTML5 metadata -->
<meta name="keywords" content="" />
<meta name="description" content="" />
<!-- RDFa Metadata (in DublinCore) -->
<meta property="dc:title" content="Lab Notebook" />
<meta property="dc:creator" content="Carl Boettiger" />
<meta property="dc:date" content="" />
<meta property="dc:format" content="text/html" />
<meta property="dc:language" content="en" />
<meta property="dc:identifier" content="/lab-notebook.html" />
<meta property="dc:rights" content="CC0" />
<meta property="dc:source" content="Lab Notebook" />
<meta property="dc:subject" content="Ecology" /> 
<meta property="dc:type" content="website" /> 
<!-- RDFa Metadata (in OpenGraph) -->
<meta property="og:title" content="Lab Notebook" />
<meta property="og:author" content="http://www.carlboettiger.info/index.html#me" />  <!-- Should be Liquid? URI? -->
<meta property="http://ogp.me/ns/profile#first_name" content="Carl"/>
<meta property="http://ogp.me/ns/profile#last_name" content="Boettiger"/>
<meta property="http://ogp.me/ns/article#published_time" content="" />
<meta property="og:site_name" content="Lab Notebook" /> <!-- Same as dc:source? -->
<meta property="og:url" content="http://www.carlboettiger.info/lab-notebook.html" />
<meta property="og:type" content="website" /> 
<!-- Google Scholar Metadata -->
<!--
<meta name="citation_author" content="Carl Boettiger"/>
<meta name="citation_date" content=""/>
<meta name="citation_title" content="Lab Notebook"/>
<meta name="citation_journal_title" content="Lab Notebook"/>
-->
<!--NOTE: see also the COinS Metadata in span element in footer -->




  <link href="/assets/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  <!-- Help the browser identify the RSS feed automatically -->
  <link rel="alternate" type="application/rss+xml" title="Carl Boettiger's Lab Notebook" href="/blog.xml" />
</head>


  <body prefix="dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/"> 
    <!-- Navbar  ================================================== -->

<nav class="navbar navbar-default" role="navigation">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/README.html"><i class="icon-info-sign"></i></a>
    </div>

 <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

          <li  >
          <a href="/index.html">Home</a></li>
          <li  >
          <a href="/vita.html">Vita</a></li>
          <li  >
          <a href="/research.html">Research</a></li>
          <li  >
          <a href="/teaching.html">Teaching</a></li>
          <li  >
          <a href="/community.html">Community</a></li>
          <li  class="active" >
          <a href="/lab-notebook.html">Lab Notebook</a></li>

        </ul>

      <!-- Search site using Google's index -->
        <form class="navbar-form navbar-right" role="search" method="get" action="http://google.com/search">
          <div class="form-group">
            <input type="hidden" name="q" value="site:carlboettiger.info" />
            <input type="text" class="form-control search-query" name="q" placeholder="Search"/>
          </div>
          <button class="btn btn-mini" type="submit"><i class="icon-search"></i></button> 
       </form>

    </div><!--/.nav-collapse -->
  </div> <!-- /container -->
</nav>



    <div class="container"> <!-- Responsive grid layout, doesn't jump to full-width --> 
      <header>
        <h1 class="entry-title">Lab Notebook</h1>
        <h2>(<a href="http://www.carlboettiger.info/2012/09/28/Welcome-to-my-lab-notebook.html">Introduction</a>)</h2>
      </header>

      <div class="row feed">
  <div class="col-md-3 col-md-offset-1">
    <h4>  <a property="account" href="https://github.com/cboettig" onclick="recordOutboundLink(this, 'Outbound Links', 'Github'); return false;"><i class="icon-github" alt="github"></i> Coding </a></h4> 
    <div class="excerpt">
      <div class="scroll">
        <ul><li>cboettig pushed to master at cboettig/labnotebook: <em>fix link</em> <a href="https://github.com/cboettig/labnotebook/compare/736c478947...d00c9a1728">07:50 2014/10/06</a></li><li>cboettig pushed to gh-pages at cboettig/labnotebook: <em>Updating to cboettig/labnotebook@736c478.</em> <a href="https://github.com/cboettig/labnotebook/compare/64cd8942b9...881a3cdbf0">07:48 2014/10/06</a></li><li>cboettig pushed to master at cboettig/labnotebook: <em>fix notes</em> <a href="https://github.com/cboettig/labnotebook/compare/1d854790a0...736c478947">07:37 2014/10/06</a></li><li>cboettig pushed to master at cboettig/knitcitations: <em>update vignette+README, closes #67</em> <a href="https://github.com/cboettig/knitcitations/compare/f5677138d2...c7c5909357">06:05 2014/10/06</a></li><li>cboettig closed issue cboettig/knitcitations#67: <em>pandoc_args in tutorial</em> <a href="https://github.com/cboettig/knitcitations/issues/67">06:05 2014/10/06</a></li></ul>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <h4> <a property="account" href="https://twitter.com/cboettig" onclick="recordOutboundLink(this, 'Outbound Links', 'Twitter'); return false;"><i class="icon-twitter"></i> Discussing </a></h4> 
     <div class="excerpt">
      <div class="scroll">
       <ul><li><p>.@profjsb When you referred to \Gamma-shaped people I heard \gamma-shaped people &amp; thought: sure the 2 domains of the \Pi should cross...</p>
 <a href="http://twitter.com/cboettig/statuses/519211977000755200">07:45 2014/10/06</a> </li><li><p>RT @eddelbuettel: Thanks @edwindjonge, it&#39;s joint work with @cboettig MT Great! Docker images with rstudio server installed:<a href="https://t.co/9L%E2%80%A6">https://t.co/9L…</a></p>
 <a href="http://twitter.com/cboettig/statuses/519179147487100928">05:35 2014/10/06</a> </li><li><p>RT @MooreFound: Proud to announce we have new investigators in data-driven discovery! Check it out: @moorescientific <a href="http://t.co/sWzpLIHxq6">http://t.co/sWzpLIHxq6</a></p>
 <a href="http://twitter.com/cboettig/statuses/518193787966074880">12:20 2014/10/04</a> </li><li><p>Congrats to Howard C Berg &amp; George Oster on Sackler Prize in Biophysics <a href="http://t.co/B2zL8AfpNn">http://t.co/B2zL8AfpNn</a> , (pubs of both were an early insp for me)</p>
 <a href="http://twitter.com/cboettig/statuses/518085692014870528">05:10 2014/10/03</a> </li><li><p>RT @mfenner: Data citations should go into the references list just as citations of articles and books <a href="http://t.co/2s465qCmUQ">http://t.co/2s465qCmUQ</a></p>
 <a href="http://twitter.com/cboettig/statuses/517715523501428736">04:39 2014/10/02</a> </li></ul>
      </div>
    </div> 
  </div> 
  <div class="col-md-3">
    <h4> <a href="http://www.mendeley.com/groups/634301/theoretical-ecology/papers/" onClick="recordOutboundLink(this, 'Outbound Links', 'Mendeley'); return false;"><i class="icon-book"></i> Reading </a></h4> 
    <div class="excerpt">
      <div class="scroll">
<ul><li>Collapse of an ecological network in Ancient Egypt: Pages: 1-6. Justin D Yeakel, Mathias M Pires, Lars Rudolf, Nathaniel J Dominy, Paul L Koch et al. <a href="http://www.mendeley.com/c/7145752934/g/634301/yeakel-2014-collapse-of-an-ecological-network-in-ancient-egypt/">07:35 2014/09/11</a></li><li>Regime shifts in models of dryland vegetation Regime shifts in models of dryland vegetation: Yuval R Zelnik, Shai Kinast, Hezi Yizhaq, Golan Bel, Ehud Meron, Phil Trans R Soc A et al.Published using Mendeley: The research paper manager <a href="http://www.mendeley.com/c/7145752914/g/634301/zelnik-2013-regime-shifts-in-models-of-dryland-vegetation-regime-shifts-in-models-of-dryland-vegetation/">07:35 2014/09/11</a></li><li>Temporal ecology in the Anthropocene: Ecology Letters (2014). Pages: n/a-n/a. E. M. Wolkovich, B. I. Cook, K. K. McLauchlan, T. J. Davies et al. <a href="http://www.mendeley.com/c/7145752874/g/634301/wolkovich-2014-temporal-ecology-in-the-anthropocene/">07:35 2014/09/11</a></li><li>Uncertainty , learning , and the optimal management of wildlife: Environmental and Ecological Statistics (2001). Volume: 8, Issue: 3. Pages: 269-288. Byron K. Williams et al. <a href="/catalog/uncertainty-learning-optimal-management-wildlife/">08:57 2014/08/06</a></li></ul>
      </div>
    </div>
  </div> 
</div>

<hr>
<div class="row postpreview">
  <div class="col-md-11 col-md-offset-1">
    <div class="row">
      <h4> <a href="http://www.carlboettiger.info/atom.xml"
              onClick="recordOutboundLink(this,
              'Outbound Links', 'RSS'); return false;"
              style="color: inherit;"
              ><i class="icon-rss" ></i> Entries</a></h4>
      
        <div class="col-md-3">
          <header><h4><a href="/2014/10/02/notes.html">Notes</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 02 Oct 2014</p>

<article>
<div class="excerpt">
<h2 id="docker">docker</h2>
<p>2014-09-29:</p>
<ul>
<li>Discussion with Dirk on repositories, library paths, versions.</li>
<li>library paths: apt-get users the <code>usr/lib</code> path, while user-run install commands (e.g. <code>install.packages</code>) uses <code>usr/local/lib/</code>, path. Dirk recommends that <code>/usr/local/lib/R/site-library</code> is configured to be user-writable for package installation, rather than installing into home.</li>
<li>building directly from CRAN</li>
<li>building dependencies: <code>apt-get build-dep</code>, needs the corresponding <code>deb-src</code> lines.</li>
<li>issues and tweaks to littler see <a href="https://github.com/eddelbuettel/littler/pull/2">PR #2</a></li>
</ul>
<p>2014-10-01:</p>
<ul>
<li>Discussion on <a href="https://github.com/ropensci/docker/issues/5">minimal images</a></li>
<li>Discussion on <a href="https://github.com/sckott/analogsea/issues/47">analogsea + docker</a></li>
<li><p>Blog <a href="http://www.magesblog.com/2014/09/running-rstudio-via-docker-in-cloud.html">coverage</a> of Dirk’s talk on our Docker work.</p></li>
<li><p><a href="https://github.com/boot2docker/boot2docker-cli">boot2docker-cli</a> includes linux flavors, so I might get a look at what the docker experience feels like for those poor souls who can only live it through full virutalization. No go on the install methods listed, but the binary seems to work. Unfortunately my laptop cannot run 64 bit virtualbox…</p></li>
</ul>
<p>2014-10-02:</p>
<ul>
<li><a href="https://docs.docker.com/articles/dockerfile_best-practices/">Official Dockerfile Best Practices</a></li>
<li>See <code>rocker</code> commit log and issues log.</li>
</ul>
<p>2014-09-29:</p>
<ul>
<li>Carsten’s suggestion re docker registeries, is this something that scientific repositories might one day support? (Excerpt from my reply post):</li>
</ul>
<blockquote>
<p>While I see your point that the Docker Hub might not be ideal for all cases, I think the most important attribute of a repository should be longevity. Certainly Docker Hub won’t be around forever, but at this stage with 60 million in it’s latest VC round it’s likely to be more long-lasting than anything that a small organization like rOpenSci would host. It would be great to see existing scientific repositories show an interest in archiving images in this way though, since organizations like DataONE and Dryad already have recognition in the scientific community and better discoverability / search / metadata features. Building of the docker registry technology would of course make a lot more sense than just archiving static binary docker images, which lack both the space saving features and the ease of download / integration that examples like the docker registry have.</p>
</blockquote>
<blockquote>
<p>I think it would be interesting to bring that discussion to some of the scientific data repositories and see what they say. Of course there’s the chicken &amp; egg problem in that most researchers have never heard of docker. Would be curious what others think of this.</p>
</blockquote>
<h2 id="reading">Reading</h2>
<ul>
<li>on <a href="http://theincidentaleconomist.com/wordpress/how-do-you-do-it-all/">productivity</a>; surprisingly resonates with me.</li>
<li>SWC discussion on teaching material in semester courses. In particular see <a href="http://www.programmingforbiologists.org">Ethan White’s course</a></li>
<li>SWC and MozillaScience mention starting a repo for <a href="https://github.com/mozillascience/codeReview">code review best practices</a></li>
<li>Katz slides: <a href="http://www.slideshare.net/danielskatz/valuing-software-and-other-research-outputs">valuing software and other research outputs</a> <!-- Query to Dan Katz --></li>
</ul>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2014/10/02/notes.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="col-md-3">
          <header><h4><a href="/2014/09/24/notes.html">Notes</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 24 Sep 2014</p>

<article>
<div class="excerpt">
<h2 id="rocker-docker">rocker / docker</h2>
<ul>
<li>Talking over strategy with Dirk, see summary in <a href="https://github.com/eddelbuettel/rocker/issues/1">#1</a> and follow-up issues, <a href="https://github.com/eddelbuettel/rocker/issues/3">#3</a>, <a href="https://github.com/eddelbuettel/rocker/issues/4">#4</a>, <a href="https://github.com/eddelbuettel/rocker/issues/5">#5</a>.</li>
</ul>
<h2 id="rdataone-eml">rdataone &amp; EML</h2>
<p>Trying to fix travis issues. Much craziness.</p>
<p><code>travis.sh</code> doesn’t provide notes on setup for repos where the R package is in a subdirectory. Looks like <code>cd</code> commands are persistent though throughout a travis file. okay.</p>
<ul>
<li><p><code>dataone</code> is imported by EML but suggested by <code>dataone</code>. Since <code>install_github</code> likes to install the suggests list, this creates problems:</p></li>
<li><p><code>travis.sh install_github</code> has no way to indicate that I don’t want to install suggests list.</p></li>
<li><p><code>install_github(&quot;DataONEorg/dataone/dataone&quot;, dependencies=NA)</code> should get around this by not installing the suggested EML package when trying to install <code>dataon</code>. For reasons inexplicable to me, that doesn’t seem to work(!), at least on travis. I’ve had to remove the package from the suggests list.</p></li>
</ul>
<p>The build environment often seems a lot more fragile than the package itself. EML travis builds were rather badly broken with both <code>dataone</code> and <code>rrdf</code> disappearing from CRAN. If we were installing them from the ubuntu binaries, of course this wouldn’t be quite as common a problem. Or even better, if our build environment came as a custom docker image. Fixing this is not completely trivial: we now have to install these packages from github, which in the case of rrdf means installing the latex build environment simply to build the rrdf vignette that we don’t need.</p>
<p>While these issues can no doubt frustrate users as well, I’m not convinced that CI should really be testing build environment problems when I want it to be testing changes I’m making to my package. In the big picture, we need more stable build environments, and of course I’m asking for trouble by depending on lots of packages, particularly new, complex and otherwise fragile packages, so this testing is valuable. But on the other hand, this mostly just gets in the way. Ideally I should be able to point to a stable build environment and just ignore changes to the later packages until I want to deal with them. That’s what most users do with their own systems – not upgrading their personal libraries, distributions, etc, until they are ready to deal with anything that breaks. Being forced onto the bleeding edge all the time forces me to waste considerable time or accept a broken CI state that need not actually be broken.</p>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2014/09/24/notes.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="col-md-3">
          <header><h4><a href="/2014/09/22/containerizing-my-development-environment.html">Containerizing My Development Environment</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 22 Sep 2014</p>

<article>
<div class="excerpt">
<p>A key challenge for reproducible research is developing solutions that integrate easily into a researcher’s existing workflow. Having to move all of one’s development onto remote machines, into a particular piece of workflow software or IDE, or even just constrained to a window running a local virtual machine in an unfamiliar or primitive environment isn’t particularly appealing. In my experience this doesn’t reflect the workflow of even those folks already concerned about reproducibility, and is, I suspect, a major barrier in adoption of such tools.</p>
<p>One reason I find docker particularly attractive for reproducible research it the idea of containerizing my development environment into something I can transport or recreate identically anywhere, particularly on another Linux machine. This also provides a convenient backup system for my development environment, no need to remember each different program or how I installed or configured it when moving to a new machine.</p>
<h2 id="using-aliases">Using aliases</h2>
<p>For me, a convenient way to do this involves creating a simple alias for running a container. This allows me to distinguish between running any software and the container, while managing my files and data through my native operating system tools. I’ve set the following alias in my <code>bashrc</code>.</p>
<pre><code>alias c=&#39;docker run --rm -it -v $(pwd):/home/$USER/`basename $PWD` -w /home/$USER/`basename $PWD` -e HOME=$HOME -e USER=$USER --user=$USER strata&#39;</code></pre>
<p>I can then just do <code>c R</code> (think <code>c</code> for container) to get R running in a container, <code>c bash</code> to drop into a bash shell on the container, <code>c pandoc --version</code> echoes the version of pandoc available on our container (or otherwise execute the container version of pandoc), and so forth.</p>
<h3 id="explanation-a-non-root-container">explanation: a non-root container</h3>
<p>The trick here is primarily to handle permissions appropriately. Docker is run as a root user by default, which results in any files created or modified become owned by root instead of the user, which is clearly not desirable. Getting around this requires quite a bit of trickery. The break down of each of these arguments is as follows:</p>
<ul>
<li><code>--rm</code> remove this container when we quit, we don’t need to let it persist as a stopped container we could later return to.</li>
<li><code>-it</code> Interactive terminal</li>
<li><code>-v</code> binds a host volume to the container. Files on the host working directory (<code>pwd</code>) will be available on the container, and changes made on the container are immediately written to the host directory:</li>
</ul>
<pre><code>-v $(pwd):/home/$USER/`basename $PWD`</code></pre>
<p>The path after the colon specifies where this directory should live on the container: we specify in a directory that has the same name as the current working directory <code>basename $PWD</code>, located in the home directory of the user (e.g. where the user has write permissions).</p>
<ul>
<li><code>-w</code> specifies the working directory we should drop into when our session on the container starts. We set this to match the path where we have just mounted our current working directory:</li>
</ul>
<pre><code>-w /home/$USER/`basename $PWD`</code></pre>
<ul>
<li><p><code>-e HOME=$HOME</code> sets the value of the environmental variable <code>HOME</code> to whatever it is on the host machine (e.g. <code>/home/username</code>), so that when R tries to access <code>~/</code>, it gets the user’s directory and not the root directory.</p></li>
<li><p><code>-e USER=$USER</code> though this seems redundant, we set the user environmental variable by default in the cboettig/rstudio image, so this overrides that environmental variable with the current user.</p></li>
<li><p><code>--user=$USER</code> Specifies the user we log in as. This is rather important, otherwise the we find that we are the root (or whatever user has been set in the Dockerfile). That would cause any files we generate from the container to be owned by the root user, not our local user. Note that this only works if the specific user has already been created (e.g. by <code>adduser</code>) on the container, otherwise this will fail.</p></li>
<li><p><code>strata</code> the name of the container (could be <code>cboettig/ropensci</code>, but my <code>strata</code> image provides a few additional customizations, created by <a href="">it’s own Dockerfile</a>. That Dockerfile (and its FROM dependencies) specify all the software available on this container. Importantly, it also already creates my username in it’s Dockerfile. Otherwise, the argument given above should use <code>--user=rstudio</code>, since the <code>rstudio</code> user is already created by the base image <code>cboettig/rstudio</code>, and thus available in <code>cboettig/ropensci</code> and <code>strata</code>. Note that this user can be created interactively by passing the environmental variable <code>-e USER=$USER</code> when running in deamon mode, since the user is then created by the start-up script. However, when we provide a custom command (like <code>/usr/bin/R</code> in this example, the <code>CMD</code> from the Dockerfile is overriden and the user isn’t created.</p></li>
</ul>
<p>A stricter alias I considered first enforces running R as a container rather than a local operation:</p>
<pre><code>alias R=&#39;docker run --rm -it -v $(pwd):/home/$USER/`basename $PWD` -w /home/$USER/`basename $PWD` -e HOME=$HOME --user=$USER strata /usr/bin/R&#39;</code></pre>
<h2 id="why-not-separate-containers-per-application">Why not separate containers per application?</h2>
<p>A more natural / more docker-esque approach might simply be to have separate containers for each application (R, pandoc, etc). This idealism belies the fact that I already need many of these tools installed on the same container, as they regularly interact in a deep way (e.g. R packages like <code>rmarkdown</code> already depend on pandoc), so these should really be thought of as a single development environment.</p>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2014/09/22/containerizing-my-development-environment.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
    </div>

    <div class="row">
      
        <div class="col-md-3">
          <header><h4><a href="/2014/09/09/server-backups.html">Server Backups</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 09 Sep 2014</p>

<article>
<div class="excerpt">
<h2 id="digital-ocean-snapshots">Digital Ocean Snapshots</h2>
<p>At $0.02 per gig per month, this looks like this is the cheapest way to make complete backups.</p>
<p>The process is rather manual: we have to <code>sudo poweroff</code> the droplet and then trigger the snapshot (the container will come back online after that, though we have to restart the services / active docker containers). We also have to delete old snapshots manually. Some of this can be automated from the API. DigitalOcean uses redundant storage for these (paying $0.01/month/gigabyte to Amazon Glacier), but at the moment we can’t export these images. Snapshots are also handy to deploy to a larger (but not smaller) droplet.</p>
<h3 id="digital-ocean-backups">Digital Ocean Backups</h3>
<p>These backups are an automated, always-online alternative to snapshots but must me initialized when the droplet is created and cost more (20% of server cost).</p>
<h2 id="manually-configuring-backups">Manually configuring backups</h2>
<p>To have the flexibility to restore individual pieces, to move between machines, etc we need a different approach.</p>
<h3 id="container-backups">Container backups</h3>
<p>Docker containers, including running containers, should be effectively backed up by either of these approaches to the state we would be in after a power cycle (e.g. we may need to start stopped containers, but not rebuild them from scratch).</p>
<p>Nevertheless we may want to back up containers themselves. For many containers this is trivial (e.g. our ssh container): we can just commit the running container to an image and save that as a tar archive (or equivalently, just export the container to a tarball).</p>
<p>If the containers have a <code>VOLUME</code> command in their dockerfile or in their execution however, this is insufficient. Containers using volumes (such as <code>sameersbn/gitlab</code> and <code>mattgruter/drone</code>) need <a href="http://serverfault.com/questions/576490/docker-volume-backup-and-restore">four things</a> to be backed up:</p>
<ul>
<li>Dockerfile (or container image, from <code>save</code> or <code>commit</code>)</li>
<li>volume</li>
<li>volume path in container</li>
<li>name of the container the volume belongs to</li>
</ul>
<p>A <a href="https://github.com/discordianfish/docker-backup">utility</a> makes this easier.</p>
<h3 id="sparkleshare">Sparkleshare</h3>
<p>Sparkleshare is a git-backed dropbox alterantive. With binaries for most major platforms (Windows, Mac, Ubuntu/Linux) it’s pretty easy to set up and acts in much the same way, with automated synch and notifications. The backend just needs a server running git – Gitlab is a great way to set this up to permit relatively easy sharing / user management. (Ignore the information about setting up separately on a server, Gitlab is much easier. Also ignore advice about building from source on Ubuntu, installing the binary is far more straight forward: <code>apt-get install sparkleshare</code>. Certainly it is not as feature rich as dropbox (e.g. email links to add users, web links to share individual files), but easy sharing over the server at no extra cost. The Sparkleshare directory is also a fully functional git repo.</p>
<h3 id="encrypted-backup-of-filesystem-with-duplicity">Encrypted backup of filesystem with duplicity</h3>
<p>See <a href="https://www.digitalocean.com/community/tutorials/how-to-use-duplicity-with-gpg-to-securely-automate-backups-on-ubuntu">Duplicity setup</a></p>
<p>Good for backing up to another host for which we have ssh access, or to an Amazon S3 bucket, etc. (Unclear if this works with Glacier due to upload-only et-up).</p>
<h3 id="some-other-rates-for-data-storage">Some other rates for data storage:</h3>
<ul>
<li>Compare to S3 ($0.03 /gig/month)</li>
<li>EBS ($0.12 /gig/month) (really for computing I/O, not storage).</li>
<li>Remarkably, Google Drive and Dropbox now offer 1 TB at $10 / mo. Clearly a lot can be saved by ‘overselling’ (most users will not use their capacity) and by shared files (counting against the space for all users but requiring no more storage capacity). Nonetheless, impressive, on par with Glacier (without the bandwidth charges or delay).</li>
<li>For comparison, (non-redundant, non-enterprise, disk-based) storage is roughly $100/TB, or on order of that annual cost.</li>
</ul>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2014/09/09/server-backups.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="col-md-3">
          <header><h4><a href="/2014/09/08/server-security-basics.html">Server Security Basics</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 08 Sep 2014</p>

<article>
<div class="excerpt">
<h2 id="security-configuration">Security configuration</h2>
<p>We set up SSH key-only login on non-standard port, with root login forbidden. We then set up <code>ufw</code> firewall, <code>fail2ban</code>, and <code>tripwire</code>.</p>
<ol type="1">
<li>Configure an <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-ssh-keys--2">SSH key login</a>. Next, <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-12-04">Create a user, add to sudoers, and then disable root login.</a>. Edits <code>/etc/ssh/sshd_config</code>:</li>
</ol>
<ul>
<li>Disabling root logins. (We’ll need to add ourselves to sudo first: (<code>adduser</code>, edit <code>/etc/sudoers</code>)</li>
<li>Change ssh port from default to something else.</li>
<li>Whitelist user login ids</li>
</ul>
<p>Additionally, let’s be sure to disable password authentication: Add <code>PasswordAuthentication no</code> to <code>/etc/ssh/sshd_config</code>. (editing PermitRootLogin only doesn’t do this).</p>
<p>Locally add an entry in <code>~/.ssh/config</code> to alias the host and port to avoid having to remember these numbers for login. Run <code>ssh-copy-id &lt;droplet-ip&gt;</code> to enable key-based login for the user.</p>
<ol start="2" type="1">
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-setup-a-firewall-with-ufw-on-an-ubuntu-and-debian-cloud-server">Install and configure</a> <code>ufw</code> firewall. As we’re not using the default <code>ssh</code> port, we need to explicitly tell <code>ufw</code> which ssh port to allow.</li>
</ol>
<pre><code>sudo ufw allow &lt;PORT&gt;/tcp</code></pre>
<p>(The <code>/tcp</code> part is optional, saying only allow <code>tcp</code> protocol over that port, not other protocols.)</p>
<p>We must also tell ufw to <a href="http://docs.docker.com/installation/ubuntulinux/#docker-and-ufw">allow Docker</a>: In <code>/etc/default/ufw</code> change <code>DEFAULT_FORWARD_POLICY</code> to ACCEPT, then:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> ufw reload
<span class="kw">sudo</span> ufw allow 2375/tcp</code></pre>
<p>and similarly allow any ports we export for our various services (Gitlab, Drone, etc).</p>
<ol start="3" type="1">
<li><p><a href="https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-fail2ban-on-ubuntu-12-04">Install and configure</a> <code>fail2ban</code>. Prevents brute force password attacks. Be sure to assign the config to match chosen ssh port.</p></li>
<li><p><a href="https://www.digitalocean.com/community/tutorials/how-to-use-tripwire-to-detect-server-intrusions-on-an-ubuntu-vps">Install and configure</a> <code>tripwire</code> (intrusion detection).</p></li>
<li><p>Update software:</p></li>
</ol>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> apt-get -q update <span class="kw">&amp;&amp;</span> <span class="kw">sudo</span> apt-get -qy dist-upgrade</code></pre>
<p>and then also update tripwire log:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> tripwire --check --interactive</code></pre>
<p>Note: Clearly all these steps need to be running on the server itself, not merely in a container image deployed on server so that they are securing access to the actual host.</p>
<h2 id="additional-configuration">Additional configuration</h2>
<p>While we’re doing things, add user to the docker group for convenience: <code>sudo addgroup cboettig docker</code></p>
<p><a href="https://www.digitalocean.com/community/tutorials/how-to-add-swap-on-ubuntu-12-04">Enable swap</a> on a small instance. Here we set up 1GB of swap (setting swap at twice the available RAM is the recommended rule-of-thumb, though makes less sense once RAM is large)</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> fallocate -l 1G /swapfile
<span class="kw">sudo</span> chmod 600 /swapfile
<span class="kw">sudo</span> mkswap /swapfile
<span class="kw">sudo</span> swapon /swapfile</code></pre>
<p>To make this persistant on reboot edit <code>/etc/fstab</code>:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> echo <span class="st">&quot;/swapfile       none    swap    sw      0       0&quot;</span> <span class="kw">&gt;&gt;</span> /etc/fstab</code></pre>
<p>For better performance, we might tweak swappiness to 10 (default is 60 out of 100, where 0 is never swap and 1 is swap frequently):</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">echo</span> 10 <span class="kw">|</span> <span class="kw">sudo</span> tee /proc/sys/vm/swappiness
<span class="kw">echo</span> vm.swappiness = 10 <span class="kw">|</span> <span class="kw">sudo</span> tee -a /etc/sysctl.conf</code></pre>
<p>Set ownership</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> chown root:root /swapfile
<span class="kw">sudo</span> chmod 0600 /swapfile</code></pre>
<h2 id="server-modules">Server modules</h2>
<p>Running different services as their own docker containers offers serveral advantages:</p>
<ul>
<li><p>Containers often make it easier to install and deploy existing services, since the necessary configuration is scripted in the Dockerfile and we can often find Dockerfiles already made on <a href="http://hub.docker.com">Docker Hub</a> for common services. This note illustrates several examples.</p></li>
<li><p>Containers may provide an added level of stability, since they run largely in isolation from each other.</p></li>
<li><p>Containers can be <a href="http://stackoverflow.com/questions/16084741/how-do-i-set-resources-allocated-to-a-container-using-docker">resource limited</a>, e.g.</p></li>
</ul>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> run -it -m 100m -c 100 ubuntu /bin/bash</code></pre>
<p>would provide the container with 100 MB of RAM and 100 “shares” of CPU (acts kind of like a niceness, where the default share of a container is 1024. On multicore machines you can also pass <code>--cpuset &quot;0&quot;</code> or <code>--cpuset &quot;0,1&quot;</code> etc, which is a list of which cpus (numbered 0 to n-1, as in <code>/proc/cpuinfo</code>) the container is permitted to use.</p>
<p>As noted in the link, restricting disk space is more tricky, though might become easier down the road.</p>
<h3 id="ssh-server">ssh server:</h3>
<p>Permit users to ssh directly into a container rather than access the server itself. Despite its simplicity, I found this a bit tricky to set up correctly, particularly in managing users.</p>
<p>Here’s the basic Dockerfile for an image we’ll call <code>ssh</code>. This creates a user given by the environmental variable. A few tricks:</p>
<ul>
<li>We use <code>adduser</code> instead of <code>useradd</code> so that we get the home directory for the user created and granted the correct permissions automaticalliy. We need the <code>--gecos</code> information so that we’re not prompted to enter the user’s full name etc. We use <code>--disabled-password</code> rather than set a password here.</li>
<li>Login is still possible through ssh key (as well as through nsenter on the host machine). We go ahead and add the ssh key now, though this could be done after the container is running by using nsenter.</li>
<li>In this dockerfile, we’ve added the user to <code>sudo</code>ers group for root access on the container (installing software, etc). This won’t be active until the user has a password.</li>
</ul>
<pre><code>FROM     ubuntu:14.04
ENV USER cboettig
RUN apt-get update &amp;&amp; apt-get install -y openssh-server
RUN mkdir /var/run/sshd
RUN adduser --disabled-password --gecos &quot;&quot; $USER
RUN adduser $USER sudo
ADD authorized_keys /home/$USER/.ssh/authorized_keys
RUN chown $USER /home/$USER/.ssh/authorized_keys
EXPOSE 22
CMD    [&quot;/usr/sbin/sshd&quot;, &quot;-D&quot;]</code></pre>
<p>When building the image, note that a copy of <code>authorized_keys</code> (contains the contents of the <code>id_rda.pub</code> public key) file must be found in the same directory as the Dockerfile so that it can be added to the image.</p>
<p>Start the ssh server on port 2200:</p>
<pre><code>docker run -d -p 2200:22 --name=&quot;ssh&quot; ssh</code></pre>
<p>Add to the firewall permissions</p>
<pre><code>sudo ufw add 2200/tcp</code></pre>
<p>From here I can now ssh in from the computer housing the private key pair to the public key that is added to the image here. However, that user doesn’t have root access since we haven’t provided a password.</p>
<p>Use <code>nsenter</code> to enter the instance:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> run -v /usr/local/bin:/target jpetazzo/nsenter
<span class="kw">nsenter</span> -m -u -n -i -p -t <span class="kw">`docker</span> inspect --format <span class="st">&#39;&#39;</span> ssh<span class="kw">`</span> /bin/bash</code></pre>
<p>Create a password for the user to enable root access:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">echo</span> <span class="st">&#39;$USER:&lt;password&gt;&#39;</span> <span class="kw">|</span> <span class="kw">chpasswd</span></code></pre>
<p>We can create other users and add them to sudoers or not as desired, e.g. add interactively using:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">useradd</span> <span class="kw">&lt;</span>username<span class="kw">&gt;</span></code></pre>
<p>users can later change their passwords once they log in.</p>
<h2 id="restoring-containers-when-restarting">Restoring containers when restarting</h2>
<p>A certain times we need to power cycle the server (e.g. after certain software updates), using the <code>sudo reboot now</code> command or the DigitalOcean console. Any running containers will be automatically stopped. Once the machine is back up and we log back in, these containers can be brought back up with <code>docker restart &lt;container_id&gt;</code> (or <code>&lt;container_name&gt;</code>), and then everything is back to normal.</p>
<p>Note that while we can stop and restart a container, it seems we cannot simply save a container (e.g. with <code>docker commit</code> or <code>docker save</code> and re-run it and expect the server functionality to be restored after the container is destroyed (e.g. by <code>docker rm -f</code>). (See previous notes 2014-09-05) for an illustration of this problem. This occurs because the container image does not include the volume where it writes its data, and that volume address is generated uniquely each time a container is run.</p>
<p>Consequently, a different (probably more traditional) approach is needed to backup the configuration of a server such as Gitlab or Drone-CI even when running in a container. Will explore this later.</p>
<p>Meanwhile, remember remove unneeded containers with</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> rm <span class="ot">$(</span><span class="kw">docker</span> ps -a <span class="kw">|</span> <span class="kw">grep</span> Exited <span class="kw">|</span> <span class="kw">awk</span> <span class="st">&#39;{print $1}&#39;</span><span class="ot">)</span></code></pre>
<p>and not with <code>-f</code> (destroying running containers!)</p>
<h2 id="key-security">Key security</h2>
<p>We can largely avoid needing a private ssh key for the server, though may use https authentication to let us use git (rather than, say, rsync) to develop and save changes made remotely (say, through RStudio server).</p>
<h3 id="backing-up-keys">Backing up keys</h3>
<p>Probably unnecessary to have a backup of the ssh private RSA key, as we can access the DigitalOcean Server or Github through the web consoles and add a new public key and replace our private key.</p>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2014/09/08/server-security-basics.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="col-md-3">
          <header><h4><a href="/2014/09/05/drone-ci-and-docker.html">Drone Ci And Docker</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 05 Sep 2014</p>

<article>
<div class="excerpt">
<h2 id="drone-ci-continous-integration-in-custom-docker-environments">Drone CI: Continous integration in custom docker environments</h2>
<p>Having gotten accustomed to Docker, configuring the appropriate build environment for a Continuous Integration system like Travis CI or Shippable CI starts to feel incredibly tedious and archaic (particularly if you work primarily in a language like R or haskell that usually isn’t supported out of the box).</p>
<ul>
<li>We do not have to hack together a custom image environment</li>
<li>We can build and test our environment locally instead of having to rely on trial-and-error pushes to the CI server</li>
<li>We do not have to download, compile and install the development environment each time, (which frequently takes longer than the CI checks themselves and can break)</li>
</ul>
<p>(Shippable provides a persistent environment too, by preserving the state of your ‘minion’. But unlike Shippable, I believe the Drone approach is unlikely that you can create troublesome side-effects in your environment, such as removing a necessary dependency from the <code>shippable.yml</code> and yet not catching it since the dependency is still available on the minion from before. In the Drone approach, we start on the same docker image each time, but merely avoid the few minutes it might take to download that image).</p>
<p>Unfortunately, custom images are not available on the fully hosted <a href="http://drone.io">drone.io</a> system. (Though perhaps they’d accept pull requests that would add an R environment to <a href="https://github.com/drone/images">their image library</a>). Fortunately, the Drone team kindly provides an <a href="https://github.com/drone.drone">open source version</a> of their platform that can be hosted on a self-hosted / private server (such as the new web darling DigitalOcean or Amazon’s EC2). This has other advantages as well – such as using privately hosted repositories (it also integrates with BitBucket and GitLab) or running very long tests / simulations (since we’re now paying for the server time ourselves, after all).</p>
<h2 id="the-easy-way-use-docker">The easy way: use docker</h2>
<p>We can deploy the Drone CI server somewhat more seamlessly by running it in a container itself. Rather than worry about the above configuration, we can simply launch an existing docker image for Drone, rather cleverly created by Matt Gruter:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> run --name=<span class="st">&#39;drone&#39;</span> -d -p 8080:80 --privileged mattgruter/drone</code></pre>
<ul>
<li>Now we can follow the <a href="http://drone.readthedocs.org/en/latest/setup.html">setup instructions</a>. Be sure to use the matching case in the application name (<code>Drone</code> not <code>drone</code>) and the appropriate URLs for the authorization call back.</li>
</ul>
<p>Note that we must use a different port than 80, and that we must give this port explicitly in the Authorization callback URL: <code>http://localhost:8080/auth/login/github</code> in order to authenticate.</p>
<p>Also note that in this approach, the Drone CI’s docker image library will be separate from the docker image library. To manage or update the images available, we have to first <code>nsenter</code> into the Drone CI container.</p>
<p>This runs rather nicely on a tiny DigitalOcean droplet. Bare in mind that the tiny droplet has only 20 GB of disk space though, which can be consumed rather quickly with too many images. If many of the images use the same base templates, the total disk space required will fortunately be much lower than the sum of their virtual sizes.</p>
<h3 id="experimenting-with-saving-images">experimenting with saving images</h3>
<p>Being a docker image, we can snapshot and export it for later use, and meanwhile can even destroy our server instance.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> export drone <span class="kw">&gt;</span> dronedroplet.tar</code></pre>
<p>Not clear that this works. Consider saving an image instead? Save container named drone as image named drone:droplet</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> commit drone drone:droplet
<span class="kw">docker</span> save drone:droplet <span class="kw">&gt;</span> dronedroplet.tar</code></pre>
<p>are these identical?</p>
<p>Hmm, doesn’t seem to store configuration, login is no longer valid. Starting a stopped container maintains the configuration of course, but not launching from scratch (e.g. the sqlite database is local to the container, not accessible through an externally linked volume).</p>
<p>Note that this tarball does not include the Drone CI image library itself, which is not part of the container but rather connected as a volume. This makes it quite a bit smaller, and that library can presumably be reconstructed from the docker hub.</p>
<h2 id="configuring-drone-ci-the-hard-way">Configuring Drone CI: the hard way</h2>
<ul>
<li>Install and launch drone: (see <a href="https://github.com/drone/drone">drone/README</a>)</li>
<li>Add <code>DOCKER_OPTS=&quot;-H 127.0.0.1:4243 -d&quot;</code> to <code>/etc/default/docker</code></li>
<li>Kill the docker deamon and restart docker. Or run docker with the explicit binding:</li>
</ul>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> docker -d -H 127.0.0.1:4243 <span class="kw">&amp;</span></code></pre>
<ul>
<li>You may need to <a href="http://docs.docker.com/installation/ubuntulinux/#docker-and-ufw">configure firewall</a>, if ufw is running.</li>
<li>References: <a href="https://github.com/drone/drone/issues/149">drone/issues/149</a>, <a href="https://github.com/drone/drone/issues/24">drone/issues/24</a></li>
<li>Now we can follow the <a href="http://drone.readthedocs.org/en/latest/setup.html">setup instructions</a>. Be sure to use the matching case in the application name (<code>Drone</code> not <code>drone</code>) and the appropriate URLs for the authorization call back.</li>
</ul>
<h2 id="configuring-an-already-running-docker-session">Configuring an already-running docker session</h2>
<p>Launch a named repository in deamon mode:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> run -d -p 8787:8787 --name=<span class="st">&#39;drone&#39;</span> mattgruter/drone</code></pre>
<p>Use a docker-based install to add <code>nsenter</code> into your executable path:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> run -v /usr/local/bin:/target jpetazzo/nsenter</code></pre>
<p>Run <code>nsenter</code> to log into the docker image:</p>
<pre><code>nsenter -m -u -n -i -p -t `docker inspect --format &#39;{{ .State.Pid }}&#39; drone` /bin/bash</code></pre>
<p>Now we can update or delete images with <code>docker pull</code>, <code>docker rmi</code>, etc.</p>
<p>This is useful with many containers, for instance, with our ssh container or rstudio container we may want to modify usernames and passwords, etc:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">useradd</span> -m <span class="ot">$USER</span> <span class="kw">&amp;&amp;</span> <span class="kw">echo</span> <span class="st">&quot;</span><span class="ot">$USER</span><span class="st">:</span><span class="ot">$PASSWORD</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="kw">chpasswd</span></code></pre>
<h3 id="making-this-easier">Making this easier:</h3>
<p>Add to <code>.bashrc</code>:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">function</span><span class="fu"> dock</span> <span class="kw">{</span> <span class="kw">sudo</span> nsenter -m -u -n -i -p -t <span class="kw">`docker</span> inspect --format  <span class="st">&quot;</span><span class="ot">$1</span><span class="st">&quot;</span><span class="kw">`</span> /bin/bash<span class="kw">;</span> <span class="kw">}</span></code></pre>
<p>This defines the function <code>dock</code> such that <code>dock &lt;name&gt;</code> will enter a running container named <code>&lt;name&gt;</code>. Note that we have to have <code>nsenter</code> bound to the executable path as indicated above. Yay less typing.</p>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2014/09/05/drone-ci-and-docker.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
    </div>

    <div class="row">
      
        <div class="col-md-3">
          <header><h4><a href="/2014/08/29/docker-notes.html">Docker tricks of the trade and best practices thoughts</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 29 Aug 2014</p>

<article>
<div class="excerpt">
<h2 id="best-practices-questions">Best practices questions</h2>
<p><em>Here are some tricks that may or may not be in keeping with best practices, input would be appreciated.</em></p>
<ul>
<li>Keep images small: use the <code>--no-install-recommends</code> option for <code>apt-get</code>, install true dependencies rather than big metapackages (like <code>texlive-full</code>).</li>
<li>Avoid creating additional AUFS layers by combining RUN commands, etc? (limit was once 42, but is now at least 127).</li>
<li><p>Can use <code>RUN git clone ...</code> to add data to a container in place of ADD, which invalidates caching.</p></li>
<li><p>Use automated builds linked to Github-based Dockerfiles rather than pushing local image builds. Not only does this make the Dockerfile transparently available and provide a link to the repository where one can file issues, but it also helps ensure that the image available on the hub gets its base image (<code>FROM</code> entry) from the hub instead of whatever was available locally. This can help avoid various out-of-sync errors that might otherwise emerge.</p></li>
</ul>
<h3 id="dockers-use-of-tags">Docker’s use of tags</h3>
<p>Unfortunately, Docker seems to use the term <code>tag</code> to refer both to the label applied to an image (e.g. in <code>docker build -t imagelabel .</code> the <code>-t</code> argument “tags” the image as ‘imagelabel’ so we need not remember its hash), but also uses <code>tag</code> to refer to the string applied to the end of an image name after a colon, e.g. <code>latest</code> in <code>ubuntu:latest</code>. The latter is the definition of “tags” as listed under the “tags” tab on the Docker Hub. Best practices for this kind of tag (which I’ll arbitrarily refer to as a ‘version tag’ to distinguish it) are unclear.</p>
<p>One case that is clear is tagging specific versions. Docker’s automated builds lets a user link a “version tag” to either to a branch or a tag in the git history. A “branch” in this case can refer either to a different git branch or merely a different sub-directory. Matching to a Git tag provides the most clear-cut use of the docker version-tag; providing a relatively static version stable link. (I say “relatively” static because even when we do not change the Dockerfile, if we re-build the Dockerfile we may get a new image due the presence of newer versions of the software included. This can be good with respect to fixing security vulnerabilities, but may also break a previously valid environment).</p>
<p>The use case that is less clear is the practice of using these “version tags” in Docker to indicate other differences between related images, such as <code>eddelbuettel/docker-ubuntu-r:add-r</code> and <code>eddelbuettel/docker-ubuntu-r:add-r-devel</code>. Why these are different tags instead of different roots is unclear, unless it is for the convenience of multiple docker files in a single Github repository. Still, it is perfectly possible to configure completely separate docker hub automated builds pointing at the same Github repo, rather than adding additional builds as tags in the same docker hub repo.</p>
<p>Docker linguistics borrow from git terminology, but it’s rather dangerous to interpret these too literally.</p>
<h2 id="keeping-a-clean-docker-environment">Keeping a clean docker environment</h2>
<ul>
<li><p>run interactive containers with <code>--rm</code> flag to avoid having to remove them later.</p></li>
<li><p>Remove all stopped containers:</p></li>
</ul>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> rm <span class="ot">$(</span><span class="kw">docker</span> ps -a <span class="kw">|</span> <span class="kw">grep</span> Exited <span class="kw">|</span> <span class="kw">awk</span> <span class="st">&#39;{print $1}&#39;</span><span class="ot">)</span></code></pre>
<ul>
<li>Clean up un-tagged docker images:</li>
</ul>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> rmi <span class="ot">$(</span><span class="kw">docker</span> images -q --filter <span class="st">&quot;dangling=true&quot;</span><span class="ot">)</span></code></pre>
<ul>
<li>Stop and remove all containers (including running containers!)</li>
</ul>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> rm -f <span class="ot">$(</span><span class="kw">docker</span> ps -a -q<span class="ot">)</span></code></pre>
<h2 id="docker-and-continuous-integration">Docker and Continuous Integration</h2>
<ul>
<li><p>We can install but cannot run Docker on <a href="http://travis.org">Travis-CI</a> at this time. It appears the linux kernel available there is much too old. Maybe when they upgrade to Ubuntu 14:04 images…</p></li>
<li><p>We cannot run Docker on the docker-based <a href="http://shippable.com">Shippable-CI</a> (at least without a vagrant/virtualbox layer in-between). Docker on Docker is not possible (see below).</p></li>
<li><p>For the same reason, we cannot run Docker on <a href="http://drone.io">drone.io</a> CI. However, Drone provides an open-source version of it’s system that can be run on your own server, which unlike the fully hosted offering, permits custom images. Unfortunately I <a href="https://github.com/drone/drone/issues/54">cannot get it working</a> at this time.</p></li>
</ul>
<h2 id="docker-inside-docker">Docker inside docker:</h2>
<p>We cannot directly install docker inside a docker container. We can get around this by adding a complete virtualization layer – e.g. docker running in vagrant/virtualbox running in docker.</p>
<p>Alternatively, we can be somewhat more clever and tell our docker to simply use a different volume to store its AUFS layers. Matt Gruter has a <a href="https://github.com/mattgruter/dockerfile-doubledocker">very clever example</a> of this, which can be used, e.g. to run a Drone server (which runs docker) inside a Docker container (<a href="http://registry.hub.docker.com/u/mattgruter/drone/">mattgruter/drone</a>).</p>
<p>I believe this only works if we run the outer docker image with <code>--privileged</code> permissions, e.g. we cannot use this approach on a server like Shippable that is dropping us into a prebuilt docker container.</p>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2014/08/29/docker-notes.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="col-md-3">
          <header><h4><a href="/2014/08/25/reproducible-research-environments-with-Docker.html">Reproducible research environments with Docker</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 25 Aug 2014</p>

<article>
<div class="excerpt">
<p>Academic research takes place in computational environments of continually increasing complexity. This creates ever-higher barriers not only to reproducing or extending the results of other researchers, but also barriers to collaboration and training of new researchers.</p>
<p>Wouldn’t it be nice if we could all work in equivalent computing environments, such that whatever worked for me on my computer would work for you on yours? Wouldn’t it be nice if we could just clone and copy our entire software environment when we needed to move our computations over to a more powerful cloud or cluster computer? Or perhaps roll back our environment to the state when everything was working yesterday?</p>
<h2 id="reproducibility-and-r">Reproducibility and R</h2>
<p>The situation for users for R is much better than most, since CRAN not only handles most dependencies but provides binaries for most major operating systems. Though subsequent changes in packages can break this chain and cause scripts that once worked to no longer due so, emerging solutions like <a href="https://github.com/rstudio/packrat">packrat</a> try to tackle this problem.</p>
<p>Nevertheless, R is not immune from these issues. Many packages make use of code libraries from other languages, from <code>pandoc</code>‘s system for rendering documents to interfaces with SQL databases, to manipulation of other formats like XML, to highly optimized linear algebra libraries. While an experienced user following careful documentation can usually install the appropriate libraries to create a functionally equivalent system, this raises substantial barriers for collaborators, students, and others. A <a href="https://storify.com/hlapp/reproducibility-repeatability-bigthink">reproducibility study at NESCENT</a> recently found that even computationally savvy experts (though not necessarily specific to the computer language or domain in question) working with code provided by authors who were explicitly committed to reproducibility (including me), could not even reconstruct the necessary computational environment. This inability to install all the correct components for software to run in the same way as it did for the original researchers is commonly known as ’dependency hell’ and has often been shown as the primary cause that computational components of research could not be replicated, (not least because it is one of the very first steps required before replication can be attempted).</p>
<p>Just about anyone who has taught a course involving running software in class will be familiar with the challenges and lost instruction time from installing such dependencies on student’s machines. Even when all dependencies are installed successfully, there is a risk that these changes will break some of the user’s existing code by altering it’s environment.</p>
<h2 id="jumping-in">Jumping in</h2>
<ul>
<li><a href="https://docs.docker.com/installation">Install Docker</a> for your operating system using <code>boot2docker</code>. (Note the Linux instructions do not require boot2docker. I recommend the 1-line curl-script install method for Ubuntu). Now you can launch <code>boot2docker</code> to open a terminal window from where we will run Docker. NOTE: RStudio example requires Docker version <code>&gt;= 1.2</code>.</li>
</ul>
<p>There’s several different ways we can interact with the container. The simplest approach is just run an R terminal on the container:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> docker run --rm -it cboettig/rstudio /usr/bin/R</code></pre>
<p>This should open up the R command line in the current window.</p>
<ul>
<li>Download and run an RStudio server instance:</li>
</ul>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> docker run -d -p 8787:8787 cboettig/rstudio</code></pre>
<p>(These commands will be slow on the first run since the image must be downloaded. Afterwards they should be pretty quick.)</p>
<ul>
<li>You can now reach your RStudio server at <code>http://&lt;system_ip_address&gt;:8787</code>. For Windows/Mac users, run <code>boot2docker ip</code> to get the value of <code>system_ip_address</code>. (This should be <code>http://92.168.59.103:8787</code> but may vary as it is set dynamically).</li>
</ul>
<p>For Linux users, you can just use <code>http://localhost:8787</code>. For cloud instances, check your server’s public IP address, and append the port (<code>:8787</code>)..</p>
<ul>
<li>Login using the default rstudio:rstudio for user:pw, or configure particular users (see below).</li>
</ul>
<h2 id="options">Options</h2>
<ul>
<li><p>Replace <code>cboettig/rstudio</code> with <code>cboettig/ropensci</code> to run a richer (but larger) development environment. See below for details.</p></li>
<li><p>Set user name and password using environmental variables, e.g.</p></li>
</ul>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> run -d -p 8787:8787 -e USER=<span class="kw">&lt;</span>username<span class="kw">&gt;</span> -e PASSWORD=<span class="kw">&lt;</span>password<span class="kw">&gt;</span> -e EMAIL=you@somewhere.com cboettig/rstudio</code></pre>
<ul>
<li>Link the container to a local folder (directory) using the <code>-v</code> option:</li>
</ul>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> run --rm -it -v <span class="ot">$(</span><span class="kw">pwd</span><span class="ot">)</span>:/home/rstudio/<span class="ot">$(</span><span class="kw">basename</span> <span class="st">&quot;</span><span class="ot">$PWD</span><span class="st">&quot;</span><span class="ot">)</span> cboettig/rstudio /usr/bin/R</code></pre>
<p>Note that in this example we have launched an interactive R terminal, rather than an RStudio server. This linking would work just as well with RStudio-server. However, because we have linked the working directory to the container, we are now free to use all our favorite tools from our native operating system to edit and manage our files, rather than being confined to RStudio.</p>
<p>Note that the volumes link (<code>-v</code>) is just taking the path to the directory on the host followed by the path where it should appear inside the container. We could specify these manually, but <code>$(pwd)</code> is just a convenient way to get the full path of the current working directory, and <code>$basename &quot;$PWD&quot;</code> a way to get just the name of that directory. So if working in <code>foo</code>, the directory <code>/path/to/foo</code> would be found at <code>/home/rstudio/foo</code> on the container. Here we’re using the default user, <code>rstudio</code>, but you would want to change that if specifying a different user name as shown in the previous example.</p>
<p>Linking files on a Mac or PC requires an extra step. This links us to the <code>boot2docker</code> volume, but we still must link boot2docker virtual machine to the host OS. It seems like <code>boot2docker</code> may still be working on this issue. Meanwhile, it is straight-forward to do this linking by using <a href="http://vagrantup.com">vagrant</a> to launch boot2docker. I discuss this below.</p>
<ul>
<li><p>Download and run an RStudio server instance: <code>sudo docker run -d -p 8787:8787 cboettig/rstudio</code></p></li>
<li><p>You can now reach your RStudio server at <code>http://&lt;system_ip_address&gt;:8787</code>. For Windows/Mac users, run <code>boot2docker ip</code> to get the value of <code>system_ip_address</code>. (This should be <code>http://92.168.59.103:8787</code> but may vary as it is set dynamically). For linux users, you can just use <code>localhost</code>. For cloud instances, check your server’s public IP address.</p></li>
<li><p>login using the default <code>rstudio:rstudio</code> for <code>user:pw</code>, or configure particular users (see below).</p></li>
</ul>
<h2 id="rstudio-on-digital-ocean">RStudio on Digital Ocean</h2>
<p>Docker also makes it very fast and easy to deploy an RStudio instance in the cloud. More importantly, it lets you deploy an instance that already has your preferred computational environment already completely installed and configured through your docker container. Running Docker on a cloud machine can be useful for many purposes, such as:</p>
<ul>
<li>Giving your collaborator access to your computational environment</li>
<li>Scaling up a computation to a larger machine</li>
<li>running RStudio from your ipad</li>
</ul>
<p>Because we use RStudio for this, we have both a completely secured connection and a familiar environment in which to interact with R. RStudio in the browser looks and feels identical to the desktop edition. Getting started with RStudio in the cloud is particularly easy using Docker and the DigitalOcean cloud provider. We can run RStudio in the <a href="https://www.digitalocean.com/pricing/">DigitalOcean cloud</a> for less than 1 cent an hour ($5 / month if run continuously). Creating an account and launching your first DigitalOcean droplet is dead easy. Head over to <a href="http://digitalocean.com">DigitalOcean.com</a> because they do a much better job of walking you through the few simple steps than I would. Create the cheapest droplet type to get started and ssh into your image once it is up and running, using the ip-address for your droplet and the password sent to you by email or an <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-ssh-keys--2">ssh key</a>.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">ssh</span> root@ip-address</code></pre>
<h3 id="enable-swapping-if-testing-on-the-smallest-image">Enable swapping if testing on the smallest image</h3>
<p>The smallest Digital Ocean servers have only 512 MB of memory and no swap enabled. Adding swap lets the machine cache things it doesn’t need in active memory, which can be important for running things like <code>install.packages</code>. On larger droplets this probably is not so much of an issue. Here, we enable 1GB of swap. SSH into your cloud server (or use the shell DigitalOcean provides in the browser), and run:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> fallocate -l 4G /swapfile
<span class="kw">sudo</span> chmod 600 /swapfile
<span class="kw">sudo</span> mkswap /swapfile
<span class="kw">sudo</span> swapon /swapfile</code></pre>
<h3 id="launch-rstudio">Launch RStudio</h3>
<p>We’re now ready to run RStudio. If you didn’t select the <code>docker</code> application while creating your image, you can install it now:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">curl</span> -sSL https://get.docker.io/ubuntu/ <span class="kw">|</span> <span class="kw">sudo</span> sh</code></pre>
<p>We’re now ready to launch RStudio using docker, just as we did locally above.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> run -e USER your_username -e PASSWORD a_secure_pw \
  <span class="kw">-d</span> -p 8787:8787 --name rstudio cboettig/rstudio</code></pre>
<p>Note that we pass a custom username and secure password in using the <code>-e</code> arguments since our RStudio instance will be publically reachable by it’s ip. We’ve also given the container a name <code>rstudio</code> so we can easily refer to it later. We now go to <code>http://&lt;your-droplet-ip-address&gt;:8787</code> and login with these custom credentials and we’re ready to compute.</p>
<h3 id="saving-your-work">Saving your work</h3>
<p>The best way to save your work is to commit your entire docker image. This will save all installed packages, active RStudio sessions, files, and everything else, even if we destroy the droplet later. This gives us the option of running our environment on a larger DigitalOcean image when the need arises, or running it locally using the <code>boot2docker</code> approach outlined above.</p>
<p>From an ssh terminal into your droplet where you first ran docker, this command will save your container as an image called <code>user/rstudio</code> (use any name combination you like).</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> commit rstudio user/rstudio</code></pre>
<p>If you create an account on <a href="https://hub.docker.com">hub.docker.com</a> we can upload this as a public or private image that we can access from anywhere for later use:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> push user/rstudio</code></pre>
<p>Be sure to use this name to run your container in the future to pick up where you left off. If you’d rather not use the Docker Hub to host your image, you can download the image file instead:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> save -o rstudio.tar rstudio</code></pre>
<p>Then from your local machine, <code>scp</code> the tar file to download it:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">scp</span> root@<span class="kw">&lt;</span>ip-address<span class="kw">&gt;</span>:~/rstudio.tar .</code></pre>
<p>You can now destroy your droplet to avoid future charges when not in use. To deploy this image later, copy it over to the new machine and load in docker:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">scp</span> rstudio.tar root@<span class="kw">&lt;</span>new-ip-address<span class="kw">&gt;</span>:~
<span class="kw">docker</span> load rstudio.tar</code></pre>
<p>and then call <code>docker run</code> as before to get up and running.</p>
<h3 id="misc-remote-linux-clusters-without-root">Misc: Remote Linux clusters without root</h3>
<p>You can run the docker images on a remote linux cluster where you don’t have root access, even if it doesn’t have a web-accessible API (such as a university server). Ask your friendly system administrator to install vagrant and virtualbox. Then we can use a lightweight virtualbox in which we can run Docker (this is just what boot2docker does in windows and mac, in fact, we’ll use an image based on boot2docker since it has just what we need, and at just 24 MB is way smaller than a standard ubuntu virtualbox image).</p>
<p>A Vagrantfile for getting up and running with this image is found in the <code>vagrant</code> directory. This handles exporting ports to the host machine, and sharing files with the host machine (which can also be tricky for boot2docker users on Mac/Windows, so this might be a work-around for them). Run this image with:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">vagrant</span> up</code></pre>
<p>You may want to first adjust the Vagrantfile to allocate more or less memory and CPU nodes to the virtual machine. Vagrant’s default is 512 MB and 1 CPU, though the file currently puts this at 2 CPUS and 1024 MB RAM.</p>
<p>You can now connect to the RStudio server using some ssh port forwarding:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">ssh</span> -o <span class="st">&quot;ExitOnForwardFailure yes&quot;</span> -f -N -L 8787:localhost:8888 <span class="kw">&lt;</span>your.server<span class="kw">&gt;</span></code></pre>
<p>The first number (8787) is the port we want things to appear on localhost, e.g. we can now connect by visiting http://localhost:8787. The second (8888) is the port we configured for the host machine with Vagrant.</p>
<p>Note that sometimes you need to tunnel through a head node to the compute node where you want R to be running, replacing <code>&lt;your.server&gt;</code> with:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">ssh</span> <span class="kw">&lt;</span>head.node.name<span class="kw">&gt;</span> nc -q0 <span class="kw">&lt;</span>compute.node.name<span class="kw">&gt;</span> 22</code></pre>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2014/08/25/reproducible-research-environments-with-Docker.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="col-md-3">
          <header><h4><a href="/2014/08/14/pdg-controlfest-notes.html">Pdg Controlfest Notes</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 14 Aug 2014</p>

<article>
<div class="excerpt">
<p>Just wanted to give a quick update on stuff relevant to our adjustment costs paper in events of this week.</p>
<p>I think the talk on Tuesday went all right, (though thanks to a technology snafu going from reveal.js to pdf my most useful figure actually showing the bluefin tuna didn’t display – I tried not to let on). I tried to keep the focus pretty big-picture throughout (we ignore these costs when we model, they matter) and avoid being too bold / prescriptive (e.g. not suggesting we found the ‘right’ way to model these costs). I also could not stop myself from calling the adjustment cost models L1 L2 L3 instead of “linear” “quadratic” and “fixed”, or _1,2,3. whoops.</p>
<p>One question asked about asymmetric costs. You may recall we started off doing but ran into some unexpected results where they just looked like the cost free case, possibly due to problems with the code. We should probably at least say this is an area for further study.</p>
<p>Another question asked about just restricting the period of adjustment, say, once every 5 years or so. I answered that we hoped to see what cost structures “induced” that behavior rather than enforcing it explicitly; but I should probably add some mention of this to the text as well.</p>
<p>I think the other questions were more straight forward but don’t remember any particulars.</p>
<p>The Monday meeting was very helpful for me in framing the kind of big questions around the paper:</p>
<ol type="1">
<li><p>Can we make this story about more than TAC-managed fisheries? My ideal paper would be something people could cite to show that simply using profit functions with diminishing returns is not a sufficient way to reflect this reality (could be the opposite if reality is more like a transaction fee), and that this mistake can be large. But all our examples are in the fisheries context, so this may take some finesse. (Since we’re aiming for Eco Apps rather than, say, Can Jor Fisheries)</p></li>
<li><p>Emphasizing the “Pretty Darn Good” angle – thinking of the policies we derive with adjustment costs not as the “True optimum” but as a “Pretty Darn Good” policy that can be more robust to adjustment costs – (Provided you have intuition to know if those costs are more like a fixed transaction fee or some proportional cost). The last two figures help with this, since they show using policies under different cost regimes than those under which they were computed to be optimal.</p></li>
<li><p>Need to figure out what to say about policies that can ‘self-adjust’, e.g. when you don’t have to change the law to respond to the fluctuations. (Jim pointed out that Salmon are the best/only case where you can actually manage by “escapement” since you get a complete population census from the annual runs).</p></li>
</ol>
<ul>
<li>Stripping down the complexity of the charts</li>
<li>Conversely, may need to show some examples of the fish stock dynamics (In search for simplicity I’ve focused almost all the graphs on harvest dynamics).</li>
<li>Calibrating and running the case of quadratic control term for comparison</li>
</ul>
<p>As a bonus, I quickly ran the tipping point models, and it looks like these stay really close to the Reed solution – e.g. relative to the safer Beverton Holt world, they are much happier to pay whatever the adjustment cost might be to stick with the optimal than they are to risk total collapse. Not sure but maybe should add this into the paper…</p>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2014/08/14/pdg-controlfest-notes.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
    </div>

  </div>
</div> <!--end row -->

<div class="row socialicons">
  <div class="col-md-11 col-md-offset-1">
      <p> <a href="/archive.html"><i class="icon-calendar"></i> All entries by date</a></p> 
      <p> <a href="/categories.html"><i class="icon-list"></i> All entries by category</a> </p>
      <p> <a href="/tags.html"><i class="icon-tags"></i> All entries by tag</a> </p>
  </div> <!--end col-md-9 -->
</div> <!--end row -->




      <footer class="footer">

<!--************** FOAF information to social networks ***************************** -->
  <div class="row">
    <div class="col-md-3 col-xs-4 socialicons" style="font-size:20px" typeof="foaf:Person" about="http://www.carlboettiger.info#me">
      <p>
          <script type="text/javascript" src="/assets/js/obfuscate-email-link.js"></script> 

          <a rel="foaf:account" href="https://twitter.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Twitter'); 
             return false;"><span class="showtooltip" title="follow me on twitter (reading, discussing)"><i class="fa fa-twitter"></i></span></a> 

          <a rel="foaf:account" href="https://github.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Github'); 
             return false;"><span class="showtooltip" title="follow me on Github (code, research)"><i class="fa fa-github"></i></span></a>
      <!--
          <a rel="foaf:account" href="https://plus.google.com/" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'GPlus'); 
             return false;"><i class="fa fa-google-plus"></i></a>

          <a rel="foaf:account" href="http://www.mendeley.com/profiles/carl-boettiger" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Mendeley'); 
             return false;"><img src="/assets/img/icon-mendeley.png" /></a> 

           citations on google-scholar

           stackoverflow
      -->
      <a rel="foaf:weblog" type="application/atom+xml" href="/blog.xml"  
         class="showtooltip" title="RSS feeds for my blog-style entries. See the feed on my lab notebook (/atom.xml) to follow all entries instead." 
         onclick="recordOutboundLink(this, 'Outbound Links', 'RSS'); 
         return false;"><i class="fa fa-rss"></i></a>
       </p>
    </div>

    
    <!--**************** End social links **************************** -->


    <div class="col-md-4 col-md-offset-1 col-xs-4">
      <p><a onclick="recordOutboundLink(this, 'Outbound Links', 'ONS_claim'); return false;" href="http://onsclaims.wikispaces.com/"><img src="/assets/img/ons-aci2-icon.svg" alt="ONS" class="showtooltip" title="An Open Notebook Science (ONS) project claim: Entry provides all content (AC) immediately (I) or without significant delay.  See link for details"/></a></p>
    </div>


    <div class="col-md-3 col-md-offset-1 col-xs-4">
      <p>
      <a rel="license" property="http://creativecommons.org/ns#license" href="http://creativecommons.org/publicdomain/zero/1.0/" onclick="recordOutboundLink(this, 'Outbound Links', 'CC0'); return false;"><img src="/assets/img/cc-zero.svg" alt="CC0"/></a> 
      </p>
    </div>
  </div>


  
<!-- COinS metadata (for citation managers like Zotero etc), goes in body text -->
  <span
      class="Z3988" 
      title="ctx_ver=Z39.88-2004
      &amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc
      &amp;rfr_id=info%3Asid%2Focoins.info%3Agenerator
      &amp;rft.title=Lab Notebook
      &amp;rft.creator=Carl Boettiger
      &amp;rft.date=
      &amp;rft.language=EN
      &amp;rft.rights=CC0
      &amp;rft_id=http://www.carlboettiger.info/lab-notebook.html">
  </span>


</footer>




          <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

    <!-- JQuery, used on a few pages (still?) -->
    <!-- <script type="text/javascript" src="/assets/js/jquery.js"></script> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <!-- Equations using MathJax -->
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "all"} } });       </script>
    <!-- Twitter Bootstrap Javascript -->
    <!--  <script src="/assets/js/bootstrap.min.js"></script> -->
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>


    

        <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-18401403-1']);
          _gaq.push(['_trackPageview']);
          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
  </script>



<script type="text/javascript">
function recordOutboundLink(link, category, action) {
  try {
    var pageTracker=_gat._getTracker("UA-18401403-1");
    pageTracker._trackEvent(category, action);
    setTimeout('document.location = "' + link.href + '"', 100)
  }catch(err){}
}
</script>




    </div>
  </body>
</html>
   

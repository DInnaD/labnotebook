<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head prefix="dc: http://purl.org/dc/terms/ og: http://ogp.me/ns#"> <!-- namespaces used in metadata.html -->
  <meta http-equiv='Content-Type' content='text/html; charset=utf-8'/>
  <title>Lab Notebook</title>
  <meta name="author" content="Carl Boettiger" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- HTML5 metadata -->
<meta name="keywords" content="" />
<meta name="description" content="" />
<meta name="resource_type" content="website"/> 
<!-- RDFa Metadata (in DublinCore) -->
<meta property="dc:title" content="Lab Notebook" />
<meta property="dc:creator" content="Carl Boettiger" />
<meta property="dc:date" content="" />
<meta property="dc:format" content="text/html" />
<meta property="dc:language" content="en" />
<meta property="dc:identifier" content="/lab-notebook.html" />
<meta property="dc:rights" content="CC0" />
<meta property="dc:source" content="Lab Notebook" />
<meta property="dc:subject" content="Ecology" /> 
<meta property="dc:type" content="website" /> 
<!-- RDFa Metadata (in OpenGraph) -->
<meta property="og:title" content="Lab Notebook" />
<meta property="og:author" content="http://www.carlboettiger.info/index.html#me" />  <!-- Should be Liquid? URI? -->
<meta property="http://ogp.me/ns/profile#first_name" content="Carl"/>
<meta property="http://ogp.me/ns/profile#last_name" content="Boettiger"/>
<meta property="http://ogp.me/ns/article#published_time" content="" />
<meta property="og:site_name" content="Lab Notebook" /> <!-- Same as dc:source? -->
<meta property="og:url" content="http://www.carlboettiger.info/lab-notebook.html" />
<meta property="og:type" content="website" /> 
<!-- Google Scholar Metadata -->
<meta name="citation_author" content="Carl Boettiger"/>
<meta name="citation_date" content=""/>
<meta name="citation_title" content="Lab Notebook"/>
<meta name="citation_journal_title" content="Lab Notebook"/>
<!--NOTE: see also the COinS Metadata in span element in footer -->




  <link href="/assets/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  <!-- Help the browser identify the RSS feed automatically -->
  <link rel="alternate" type="application/rss+xml" title="Carl Boettiger's Lab Notebook" href="/blog.xml" />
</head>


  <body prefix="dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/"> 
    <!-- Navbar  ================================================== -->

<nav class="navbar navbar-default" role="navigation">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/README.html"><i class="icon-info-sign" alt="info"></i></span></a>
    </div>

 <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

          <li  >
          <a href="/index.html">Home</a></li>
          <li  >
          <a href="/vita.html">Vita</a></li>
          <li  >
          <a href="/research.html">Research</a></li>
          <li  >
          <a href="/teaching.html">Teaching</a></li>
          <li  >
          <a href="/community.html">Community</a></li>
          <li  class="active" >
          <a href="/lab-notebook.html">Lab Notebook</a></li>

        </ul>

      <!-- Search site using Google's index -->
        <form class="navbar-form navbar-right" role="search" method="get" action="http://google.com/search">
          <div class="form-group">
            <input type="hidden" name="q" value="site:carlboettiger.info" />
            <input type="text" class="form-control search-query" name="q" placeholder="Search"/>
          </div>
          <button class="btn btn-mini" type="submit"><i class="icon-search"></i></button> 
       </form>

    </div><!--/.nav-collapse -->
  </div> <!-- /container -->
</nav>



    <div class="container"> <!-- Responsive grid layout, doesn't jump to full-width --> 
      <header>
        <h1 class="entry-title">Lab Notebook</h1>
        <h2>(<a href="http://www.carlboettiger.info/2012/09/28/Welcome-to-my-lab-notebook.html">Introduction</a>)</h3>
      </header>

      <div class="row feed">
  <div class="col-md-3 col-md-offset-1">
    <h4>  <a property="account" href="https://github.com/cboettig" onclick="recordOutboundLink(this, 'Outbound Links', 'Github'); return false;"><i class="icon-github" alt="github"></i> Coding </a></h4> 
    <div class="excerpt">
      <div class="scroll">
        <ul><li>cboettig pushed to gh-pages at cboettig/labnotebook: <em>Built from 54eb913c2cd85bfaa244e53a7cdc59e78451c15e.</em> <a href="https://github.com/cboettig/labnotebook/compare/69d1a22206...b15740f0e6">09:21 2014/05/08</a></li><li>cboettig pushed to master at cboettig/labnotebook: <em>no calls to octokit needed draft</em> <a href="https://github.com/cboettig/labnotebook/compare/54eb913c2c...5f76f46526">09:17 2014/05/08</a></li><li>cboettig pushed to master at cboettig/labnotebook: <em>add blog post on template</em> <a href="https://github.com/cboettig/labnotebook/compare/80e508e5f7...54eb913c2c">09:08 2014/05/08</a></li><li>cboettig opened issue cboettig/labnotebook#117: <em>better integrate READMEs and scripts from project repos into the notebook</em> <a href="https://github.com/cboettig/labnotebook/issues/117">08:43 2014/05/08</a></li><li>cboettig pushed to gh-pages at cboettig/labnotebook: <em>Built from 80e508e5f78f57b6195e84f1f2b353af63c9c9e4.</em> <a href="https://github.com/cboettig/labnotebook/compare/7e29264982...69d1a22206">08:38 2014/05/08</a></li></ul>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <h4> <a property="account" href="https://twitter.com/cboettig" onclick="recordOutboundLink(this, 'Outbound Links', 'Twitter'); return false;"><i class="icon-twitter"></i> Discussing </a></h4> 
     <div class="excerpt">
      <div class="scroll">
       <ul><li><p>@polesasunder cool. you can see this in use in some current manuscript drafts too, e.g. <a href="https://t.co/doRpbB5Z75">https://t.co/doRpbB5Z75</a> or <a href="https://t.co/aUjJBsGXEO">https://t.co/aUjJBsGXEO</a></p>
 <a href="http://twitter.com/cboettig/statuses/464187476861407232">11:38 2014/05/07</a> </li><li><p>Rmd great 4 TeX. my template: <a href="https://t.co/0YI9rpdO9k">https://t.co/0YI9rpdO9k</a> @polesasunder @recology_ @<em>inundata @ethanwhite @DistribEcology @kara</em>woo @phylorich</p>
 <a href="http://twitter.com/cboettig/statuses/464181747077242880">11:15 2014/05/07</a> </li><li><p>Nice @F1000Research opinion piece from +Carly Strasser and Kratz on Data Publication … <a href="http://t.co/ublFzwdxil">http://t.co/ublFzwdxil</a></p>
 <a href="http://twitter.com/cboettig/statuses/463796433527656449">09:44 2014/05/06</a> </li><li><p>@pencechp @k8hert @tjvision Indeed! You clearly want XKCD style trees from R, like this: <a href="http://t.co/Dkh4Tb6MfG">http://t.co/Dkh4Tb6MfG</a></p>
 <a href="http://twitter.com/cboettig/statuses/463777774797217792">08:30 2014/05/06</a> </li><li><p>Nice paper on early warning signals in more complex dynamics, from Jeff Gore&#39;s group. <a href="http://t.co/0qTuo9gcMf">http://t.co/0qTuo9gcMf</a></p>
 <a href="http://twitter.com/cboettig/statuses/463776901043990528">08:26 2014/05/06</a> </li></ul>
      </div>
    </div> 
  </div> 
  <div class="col-md-3">
    <h4> <a href="http://www.mendeley.com/groups/634301/theoretical-ecology/papers/" onClick="recordOutboundLink(this, 'Outbound Links', 'Mendeley'); return false;"><i class="icon-book"></i> Reading </a></h4> 
    <div class="excerpt">
      <div class="scroll">
<ul><li>Coevolution can reverse predator-prey cycles: Proceedings of the National Academy of Sciences (2014). M. H. Cortez, J. S. Weitz et al. <a href="http://www.mendeley.com/c/6785818934/g/634301/cortez-2014-coevolution-can-reverse-predator-prey-cycles/">08:54 2014/05/06</a></li><li>Early-Warning Signs for Pattern-Formation in Stochastic Partial Differential Equations: Pages: 26. Karna Gowda, Christian Kuehn et al. <a href="http://www.mendeley.com/c/6778610874/g/634301/gowda-2014-early-warning-signs-for-pattern-formation-in-stochastic-partial-differential-equations/">08:17 2014/05/01</a></li><li>Structural asymmetry and the stability of diverse food webs.: Nature (2006). Volume: 442, Issue: 7100. Pages: 265-9. Neil Rooney, Kevin McCann, Gabriel Gellner, John C Moore et al. <a href="http://www.mendeley.com/c/6778610844/g/634301/rooney-2006-structural-asymmetry-and-the-stability-of-diverse-food-webs/">08:16 2014/05/01</a></li><li>Foraging adaptation and the relationship between food-web complexity and stability.: Science (New York, N.Y.) (2003). Volume: 299, Issue: 5611. Pages: 1388-91. Michio Kondoh et al. <a href="http://www.mendeley.com/c/6778610834/g/634301/kondoh-2003-foraging-adaptation-and-the-relationship-between-food-web-complexity-and-stability/">08:16 2014/05/01</a></li></ul>
      </div>
    </div>
  </div> 
</div>

<hr>
<div class="row postpreview">
  <div class="col-md-11 col-md-offset-1">
    <div class="row">
      <h4> <a href="http://www.carlboettiger.info/atom.xml"
              onClick="recordOutboundLink(this,
              'Outbound Links', 'RSS'); return false;"
              style="color: inherit;"
              ><i class="icon-rss" ></i> Entries</a></h4>
      
        <div class="col-md-3">
          <header><h4><a href="/2014/05/06/steps-to-a-more-portable-workflow.html">Steps To A More Portable Workflow</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 06 May 2014</p>

<article>
<div class="excerpt">
<p>While I have made <a href="http://www.carlboettiger.info/2012/05/06/research-workflow.html">my workflow</a> for most of my ongoing projects available on Github for some time, this does not mean that it has been particularly easy to follow. Further, as I move from project to project I have slowly improved how I handle projects. For instance, I have since added unit tests (with <code>testthat</code>) and continuous integration (with <a href="http://travis-ci.org">travis-ci</a>) to my repositories, and my handling of manuscripts has gotten more automated, with richer latex templates, yaml metadata, and simpler and more powerful makefiles.</p>
<p>Though I have typically used my most recent project as a template for my next one (not so trivial as I work on several at a time), I realized it would make sense to just maintain a general template repo with all the latest goodies. I have now launched my <a href="https://github.com/cboettig/template">template</a> on Github.</p>
<p>I toyed with the idea of just treating the manuscript as a standard vignette, but this would make <code>pandoc</code> an external dependency for the package, putting an unecessary burden on <code>travis</code> and users. I settled on creating a <code>manuscripts</code> directory in the project root folder as the most semantically obvious place. This is added to <code>.Rbuildignore</code> as it doesn’t fit the standard structure of an R package, but since it is not a vignette and cannot be built with the package dependencies anyhow, this seems to make sense to me.<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></p>
<p>The manuscript itslef is written in <code>.Rmd</code>, with a <code>yaml</code> header for the usual metadata of authors, affiliations, and so forth. Pandoc’s recent support for <a href="https://github.com/cboettig/template/blob/master/manuscripts/manuscript.Rmd#L1-27">yaml metadata</a> makes it much easier to use <code>.Rmd</code> with a LaTeX template, making <code>.Rnw</code> rather unnecessary. <a href="https://github.com/cboettig/template/blob/master/manuscripts/components/elsarticle.latex">My template</a> includes a custom <code>LaTeX</code> template that includes pandoc’s macros for inserting authors, affiliations, and so forth in the correct LaTeX elements, though pandoc’s <a href="https://github.com/jgm/pandoc-templates/blob/master/default.latex">default template</a> is rather good and already has macros for most things in place (meaning you can merely declare the layout or font in the yaml header and magically see the tex interpret it).</p>
<p>I have tried to keep the <code>manuscripts</code> directory relatively clean, placing <code>csl</code>, <code>bibtex</code>, <code>figures/</code>, <code>cache/</code> and other such files in a <code>components/</code> sub-directory. I have also tried to keep the <code>Makefile</code> as platform-independent as possible by having it call little Rscripts (also housed in <code>components/</code>) rather than commandline utilities like <code>sed -i</code> and <code>wget</code> that may not behave the same way on all platforms.</p>
<p>Lastly, Ryan Batts recently convinced me that providing binary cache files of results was an important way to allow a reader to quickly engage in exploring an analysis without having to first let potentially long-running code execute. <code>knitr</code> provides an excellent way to create and manage this caching on a code chunk by chunk level, which is also crucial when editing a dynamic document with intensive code (no one wants to rerun your MCMC just to rebuild the pdf). Since git/Github seems like a poor option for distributing binaries, I have for the moment just archived the cache on a (university) web server and added a Make/Rscript line to that can restore it from that location. Upon publication this cache could be permanently archived (along with plain text tables of the graphs) and then installed from that archive instead.</p>
<p>I have also added a separate <a href="https://github.com/cboettig/template/blob/master/manuscripts/README.md">README</a> in the manuscripts directory to provide some guidance to a user seeking to build the manuscript.</p>
<p>Examples of an active projects currently using this layout for manuscripts, etc include <a href="https://github.com/ropensci/RNeXML">RNeXML</a> and <a href="https://github.com/cboettig/nonparametric-bayes/">nonparametric-bayes</a></p>
<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Perhaps I should not have the manuscript on the master branch at all, but putting it on another branch would defeat the purpose of having it in an obviously-named directory of the repository home page where it is most easy to discover.<a href="#fnref1">↩</a></p></li>
</ol>
</section>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2014/05/06/steps-to-a-more-portable-workflow.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="col-md-3">
          <header><h4><a href="/2014/05/05/knitr-workflow-challenges.html">Deep challenges to dynamic documentation in daily workflows</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 05 May 2014</p>

<article>
<div class="excerpt">
<p>We often discuss dynamic documents such as <code>Sweave</code> and <code>knitr</code> in reference to final products such as publications or software package vignettes. In this case, all the elements involved are already fixed: external functions, code, text, and so forth. The dynamic documentation engine is really just a tool to combine them (knit them together). Using dynamic documentation on a day-to-day basis on ongoing research presents a compelling opportunity but a rather more complex challenge as well. The code base grows, some of it gets turned into external custom functions where it continues to change. One analysis script branches into multiple that vary this or that. The text and figures are likewise subject to the same revision as the code, expanding and contracting, or being removed or shunted off into an appendix.</p>
<p>Structuring a dynamic document when all the parts are morphing and moving is one of the major opportunities for the dynamic approach, but also the most challenging. Here I describe some of those challenges along with various tricks I have adopted to deal with them, mostly in hopes that someone with a better strategy might be inspired to fill me in.</p>
<h2 id="the-old-way">The old way</h2>
<p>For a while now I have been using the <a href="http://yihui.name/knitr">knitr</a> dynamic documentation/reproducible research software for my project workflow. Most discussion of dynamic documentation focuses on ‘finished’ products such as journal articles or reports. Over the past year, I have found the dynamic documentation framework to be particularly useful as I develop ideas, and remarkably more challenging to then integrate into a final paper in a way that really takes advantage of its features. I explain both in some detail here.</p>
<p>My former workflow followed a pattern no doubt familiar to many:</p>
<ul>
<li>Bash away in an R terminal, paste useful bits into an R script…</li>
<li>Write manuscript separately, pasting in figures, tables, and in-line values returned from R.</li>
</ul>
<p>This doesn’t leave much of a record of what I did or why, which is particularly frustrating when some discussion reminds me of an earlier idea.</p>
<h2 id="dynamic-docs-.rmd-files">Dynamic docs: <code>.Rmd</code> files</h2>
<p>When I begin a new project, I now start off writing a <code>.Rmd</code> file, intermixing notes to myself and code chunks. Chunks break up the code into conceptual elements, markdown gives me a more expressive way to write notes than comment lines do. Output figures, tables, and in-line values inserted. So far so good. I version manage this creature in git/Github. Great, now I have a trackable history of what is going on, and all is well:</p>
<ol type="1">
<li><p>Document my thinking and code as I go along on a single file scratch-pad</p></li>
<li><p>Version-stamped history of what I put in and what I got out on each step of the way</p></li>
<li><p>Rich markup with equations, figures, tables, embedded.</p></li>
<li><p>Caching of script chunks, allowing me to tweak and rerun an analysis without having to execute the whole script. While we can of course duplicate that behavior with careful save and load commands in a script, in knitr this comes for free.</p></li>
</ol>
<h2 id="limitations-to-.rmd-alone">Limitations to .Rmd alone</h2>
<ol type="1">
<li><p>As I go along, the <code>.Rmd</code> files starts getting too big and cluttered to easily follow the big picture of what I’m trying to do.</p></li>
<li><p>Before long, my investigation branches. Having followed one <code>.Rmd</code> script to some interesting results, I start a new <code>.Rmd</code> script representing a new line of investigation. This new direction will nevertheless want to re-use large amounts of code from the first file.</p></li>
</ol>
<h2 id="a-solution-the-r-package-research-compendium-approach">A solution? The R package “research compendium” approach</h2>
<p>I start abstracting tasks performed in chunks into functions, so I can re-use these things elsewhere, loop over them, and document them carefully somewhere I can reference that won’t be in the way of what I’m thinking. I start to move these functions into <code>R/</code> directory of an R package structure, documenting with <code>Roxygen</code>. I write unit tests for these functions (in <code>inst/tests</code>) to have quick tests to check their sanity without running my big scripts (recent habit). The package structure helps me:</p>
<ul>
<li>Reuse the same code between two analyses without copy-paste or getting our of sync</li>
<li>Document complicated algorithms outside of my working scripts</li>
<li>Test complicated algorithms outside of my working scripts (<code>devtools::check</code> and/or unit tests)</li>
<li>Manage dependencies on other packages (DESCRIPTION, NAMESPACE), including other projects of mine</li>
</ul>
<p>This runs into trouble in several ways.</p>
<h2 id="problem-1-reuse-of-code-chunks">Problem 1: Reuse of code chunks</h2>
<p>What to do with code I want to reuse across blocks but do not want to write as a function, document, or test?</p>
<p><em>Perhaps this category of problem doesn’t exist, except in my laziness.</em></p>
<p>This situation arises all the time, usually through the following mechanism: almost any script performs several steps that are best represented as chunks calling different functions, such as <code>load_data</code>, <code>set_fixed_parameters</code>, <code>fit_model</code>, <code>plot_fits</code>, etc. I then want to re-run almost the same script, but with a slightly different configuration (such as a different data set or extra iterations in the fixed parameters). For just a few such cases, it doesn’t make sense to write these into a single function,<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> instead, I copy this script to a new file and make the changes there.</p>
<p>This is great until I want to change something in about the way both scripts behave that cannot be handled just by changing the <code>R/</code> functions they share. Plotting options are a good example of this (I tend to avoid wrapping <code>ggplot</code> calls as separate functions, as it seems to obfuscate what is otherwise a rather semantic and widely recognized, if sometimes verbose, function call).</p>
<p>I have explored using <code>knitr</code>’s support for external chunk inclusion, which allows me to maintain a single R script with all commonly used chunks, and then import these chunks into multiple <code>.Rmd</code> files. An example of this can be seen in my <code>nonparametric-bayes</code> repo, where several files (in the same directory) draw most of their code from <a href="https://github.com/cboettig/nonparametric-bayes/blob/9232dfd814c40e3c48c5a837be110a870d8639da/inst/examples/BUGS/external-chunks.R">external-chunks.R</a>.</p>
<h2 id="problem-2-package-level-reproducibility">Problem 2: package-level reproducibility</h2>
<p><em>Minor/relatively easy to fix.</em></p>
<p>Separate files can frustrate reproducibility of a given commit. As I change the functions in <code>R/</code>, the <code>.Rmd</code> file can give different results despite being unchanged. (Or fail to reflect changes because it is caching chunks and does not recognize the function definitions have changed underneath it). Git provides a solution to this: since the <code>.Rmd</code> file lives in the same git repository (<code>inst/examples</code>) as the package, I can make sure the whole repository matches the hash of the <code>.Rmd</code> file: <code>install_github(&quot;packagename&quot;, &quot;cboettig&quot;, &quot;hash&quot;)</code>.</p>
<p>This solution is not fail-safe: the installed version, the potentially uncommitted (but possibly installed) version of the R functions in the working directory, and the R functions present at the commit of the <code>.Rmd</code> file (and thus matching the hash) could all be different. If we commit and install before every <code>knit</code>, we can avoid these potential errors (at the cost of some computational overhead), restoring reproducibility to the chain.</p>
<h2 id="problem-3-synthesizing-results-into-a-manuscript">Problem 3: Synthesizing results into a manuscript</h2>
<p>In some ways this is the easiest part, since the code-base is relatively static and it is just a matter of selecting which results and figures to include and what code is necessary to generate it. A few organizational challenges remain:</p>
<p>While we generally want <code>knitr</code> code chunks for the figures and tables that will appear, we usually aren’t interested in displaying much, if any, of the actual code in the document text (unlike the examples until this point, where this was a major advantage of the knitr approach). In principle, this is as simple as setting <code>echo=FALSE</code> in the global chunk options. In practice, it means there is little benefit to having the chunks interwoven in the document. What I tend to want is having all the chunks run at the beginning, such that any variables or results can easily be added (and their appearance tweaked by editing the code) as figure chunks or in-line expressions. The only purpose of maintaining chunks instead of a simple script is the piecewise caching of chunk dependencies which can help debugging.</p>
<p>Since displaying the code is suppressed, we are then left with the somewhat ironic challenge of how best to present code as a supplement. One option is simply to point to the source <code>.Rmd</code>, another is to use the <code>tangle()</code> option to extract all the code as a separate <code>.R</code> file. In either case, the user must also identify the correct version of the R package itself for the external <code>R/</code> functions.</p>
<h2 id="problem-4-branching-into-other-projects">Problem 4: Branching into other projects</h2>
<p>Things get most complicated when projects begin to branch into other projects. In an ideal world this is simple: a new idea can be explored on a new branch of the version control system and merged back in when necessary, and an entirely new project can be built as a new R package in a different repo that depends on the existing project. After several examples of each, I have learned that it is not so simple. Despite the nice tools, I’ve learned I still need to be careful in managing my workflows in order to leave behind material that is understandable, reproducible, and reflects clear provenance. So far, I’ve learned this the hard way. I use this last section of the post to reflect on two of my own examples, as writing this helps me work through what I should have done differently.</p>
<h3 id="example-warning-signals-project">example: warning-signals project</h3>
<p>For instance, my work on early warning signals dates back to the start of my <a href="http://openwetware.org/wiki/User:Carl_Boettiger/Notebook/Stochastic_Population_Dynamics/2010/02/09">open notebook on openwetware</a>, when my code lived on a Google code page which seems to have disappeared. (At the time it was part of my ‘stochastic population dynamics’ project). When I moved to Github, this project got it’s own repository, <a href="https://github.com/cboettig/warningsignals">warningsignals</a>, though after a major re-factorization of the code I moved to a new repository, <a href="https://github.com/cboettig/earlywarning">earlywarning</a>. Okay, so far that was due to me not really knowing what I was doing.</p>
<p>My first paper on this topic was based on the master branch of that repository, which still contains the code required. When one of the R dependencies was moved from CRAN I was able to update the codebase to reflect the replacement package (see issue <a href="https://github.com/cboettig/earlywarning/issues/10">#10</a>). Even before that paper appeared I started exploring other issues on different <a href="https://github.com/cboettig/earlywarning/network">branches</a>, with the <code>prosecutor</code> branch eventually becoming it’s own paper, and then it’s <a href="https://github.com/cboettig/prosecutors-fallacy/">own repository</a>.</p>
<p>That paper sparked a comment letter in response to it, and the analysis involved in my reply piece was just developed on the same master branch of the prosecutor-fallacy repository. This leaves me with a total of three repositories across four branches, with one repo that corresponds more-or-less directly to a paper, one to two papers, and one to no papers.</p>
<p>All four branches have diverged and unmerge-able code. Despite sharing and reusing functions across these projects, I often found it better to simply change the function on the new branch or new repo as I desired for the new work. These changes could not be easily merged back as they broke the original function calls of the earlier work.</p>
<p>Hindsight being 20-20, it would have been preferable that I had maintained one repository, perhaps developed each paper on a different branch and clearly tagged the commit corresponding to the submission of each publication. Ideally these could be merged back where possible to a master branch. Tagged commits provide a more natural solution than unmerged branches to deal with changes to the package that would break methods from earlier publications.</p>
<h3 id="example-optimal-control-projects">example: optimal control projects</h3>
<p>A different line of research began through a NIMBioS working group called “Pretty Darn Good Control”, beginning it’s digital life in my <a href="https://github.com/cboettig/pdg_control">pdg_control</a> repository. Working in different break-out groups as well as further investigation on my own soon created several different projects. Some of these have continue running towards publication, others terminating in dead ends, and still others becoming completely separate lines of work. Later work I have done in optimal control, such <a href="https://github.com/cboettig/nonparametric-bayes">nonparametric-bayes</a> and <a href="https://github.com/cboettig/multiple_uncertainty">multiple_uncertainty</a> depend on this package for certain basic functions, though both also contain their own diverged versions of functions that first appeared in <a href="https://github.com/cboettig/pdg_control">pdg_control</a>.</p>
<p>Because the topics are rather different and the shared code footprint is quite small, separate repositories probably makes more sense here. Still, managing the code dependencies in separate repositories requires extra care, as checking out the right version of the focal repository does not guarantee that one will also have the right version of the [pdg_control] repository. Ideally I should note the hash of [pdg_control] on which I depend, and preferably install that package at that hash (easy enough thanks to <code>devtools</code>), since depending on a separate project that is also still changing can be troublesome. Alternatively it might make more sense to just duplicate the original code and remove this potentially frail dependency. After all, documenting the provenance need not rely on the dependency, and it is more natural to think of these separate repos as divergent forks.</p>
<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>If I have a lot of different configurations, it may make sense to wrap up all these steps into a single function that takes input data and/or parameters as it’s argument and outputs a data frame with the results and inputs.<a href="#fnref1">↩</a></p></li>
</ol>
</section>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2014/05/05/knitr-workflow-challenges.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="col-md-3">
          <header><h4><a href="/2014/05/04/why-I-sign-my-reviews.html">why I sign my reviews</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 04 May 2014</p>

<article>
<div class="excerpt">
<p>For the past four years I have made an effort to sign all my reviews (which I try to keep to about one a month). It isn’t because I believe in radical openness or something crazy like that. Its really just my self interest involved – at least mostly. Writing a review is an incredibly time consuming, and largely thankless task. Supposedly anonymous peer review is supposed to protect the reviewer, particularly the scenario of the less established scientist critiquing the work of the more established. I am sure it occasionally serves that purpose. On the other hand, that very scenario can be the <em>most</em> profitable time to sign a review. Really, when are you more likely to get an esteemed colleague to closely read your every argument than when you’re holding up their publication?</p>
<p>While the possibility of a vindictive and powerful author sounds daunting, but rather inconsistent with my impression of most scientists, who are more apt to be impressed by an intelligent even if flawed critique than by simple praise. I find it hardest to sign a review that I have found very little constructive criticism to offer, though after a decade of being trained to critique science one can always find something. (Of course signing can be hard on the occasional terrible paper for which it is hard to offer much constructive criticism, but fortunately that has been very rare). Both authors and other reviewers (who are sometimes sent the other reviews, a practice I find very educational as a reviewer) have on occasion commented or complemented me on reviews or acknowledged me in the papers, suggesting that the practice does indeed provide for some simple recognition. At times, it may sow seeds for future collaboration.</p>
<p>Signing my reviews has on occasion given the author a chance to follow up with me directly. While I’m not certain about journal policies in this regard, I suspect we can assume that we’re all adults capable of civil discussion. In any event, a phone call or even a few back-and-forth emails can be immensely more efficient in allowing an author to clarify elements that I have sometimes misunderstood or been unable to follow from the text, as well as making it easier to communicate my difficulties with the paper. In my experience this has resulted in both a faster and more satisfactory resolution to issues that have led to see some papers published more quickly and without as many tedious multiple rounds of revision. Given that many competitive journals simply cut off papers that might otherwise be successful with a bit more dialog between reviewer and author, because multiple “Revise and resubmits” put too much demand on editors, this seems like a desirable outcome for all involved. I’m not suggesting that such direct dialog is always desirable, but that no doubt many of us have been in the position in which a little dialog might have resolved issues more satisfactorily.</p>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2014/05/04/why-I-sign-my-reviews.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
    </div>

    <div class="row">
      
        <div class="col-md-3">
          <header><h4><a href="/2014/05/02/scientific-computing-notes.html">Scientific Computing Notes</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 02 May 2014</p>

<article>
<div class="excerpt">
<p>In my experience EC2 is good for some things but not for others. Consequently having some funding allocated for it would be great, but it would still be necessary to have other resources as well. I’ve found EC2 very good for running some reasonably portable analysis where you temporarily want some extra processors or memory. On the other hand, I’ve had some frustrations with it as well. You don’t have a persistent development environment unless you explicitly make and maintain a machine image, which means installing any software dependencies from scratch; sometimes a particular nuisance when you aren’t familiar with the architecture. So this adds more overhead on your time relative to administering your own machine, and much more than a university cluster with a human administrator. Obviously the latter is much more costly, but seems to scale well at least where I’ve seen that in universities.</p>
<p>Costs for maintaining a persistent image (e.g. for a web server), and costs for large data storage on things like S3 still seem a bit high, though actually the Berkeley cloud service listed on it’s IST site looks competitive. EC2 isn’t a great option for tasks that require more processors than can be fit with shared memory on a single node, where the architecture of a cluster is better for things that use MPI. Lastly, I want to think about what environment will be most accessible to my students and postdocs. While surely it’s good for them to learn their way around computing environments, at some point the barriers to enter or keep current with some of the cloud platforms in particular become a distraction from the research.</p>
<hr />
<ul>
<li>See Glenn Lockwood on <a href="http://glennklockwood.blogspot.com/2013/04/quick-mpi-cluster-setup-on-amazon-ec2.html">MPI setup</a> and <a href="http://glennklockwood.blogspot.com/2013/04/mpi-benchmarks-amazon-ec2-cluster.html">MPI benchmarks</a> on EC2.</li>
</ul>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2014/05/02/scientific-computing-notes.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="col-md-3">
          <header><h4><a href="/2014/05/02/multiple-uncertainty-notes.html">Multiple Uncertainty Notes</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 02 May 2014</p>

<article>
<div class="excerpt">
<h3 id="logistic-recruitment-uniform-noise">Logistic recruitment, uniform noise</h3>
<p>(Sethi Fig 3 configuration)</p>
<figure>
<img src="http://cboettig.github.io/multiple_uncertainty/5b3b135-scenarios.svg" />
</figure>
<h3 id="logistic-recruitment-lognormal-noise">Logistic recruitment, lognormal noise</h3>
<figure>
<img src="http://cboettig.github.io/multiple_uncertainty/5b3b135-lognormal.svg" />
</figure>
<h3 id="beverton-holt-recruitement-uniform-noise">Beverton-Holt recruitement, uniform noise</h3>
<figure>
<img src="http://cboettig.github.io/multiple_uncertainty/5b3b135-bevholt_uniform.svg" />
</figure>
<h3 id="beverton-holt-recruitement-lognormal-noise">Beverton-Holt recruitement, lognormal noise</h3>
<figure>
<img src="http://cboettig.github.io/multiple_uncertainty/5b3b135-bevholt_lognormal.svg" />
</figure>
<h3 id="logistic-recruitment-uniform-noise-small-r">Logistic recruitment, uniform noise, small r</h3>
<p><img src="http://cboettig.github.io/multiple_uncertainty/5b3b135-logistic_unif_small_r.svg" /> ### Logistic recruitment, lognormal noise, small r</p>
<figure>
<img src="http://cboettig.github.io/multiple_uncertainty/5b3b135-logistic_lognormal_small_r.svg" />
</figure>
<h2 id="metadata">Metadata</h2>
<p>From <a href="https://github.com/cboettig/multiple_uncertainty/blob/25cc46841908c6ca4da92b8866b836bfeddd707f/inst/matlab/scenarios_meta.txt">scenarios_meta.txt</a></p>
<pre class="sourceCode yaml"><code class="sourceCode yaml"><span class="fu">Columns:</span>
  <span class="fu">y_grid:</span> The observed stock size
  <span class="fu">escapement:</span> The optimal escapement policy. (y_grid value minus the escapement is the quota).
  <span class="fu">sigma_g:</span> The growth noise scaling factor
  <span class="fu">sigma_m:</span> The measurement error scaling factor (between observed stock x and measured stock y)
  <span class="fu">sigma_i:</span> The implementation noise scaling factor (between quota q set and harvest h realized).
  <span class="fu">r:</span> The growth rate parameter of the recuitment function
  <span class="fu">K:</span> The carrying capacity parameter of the recruitment function
  <span class="fu">recruitment:</span>
    <span class="fu">1:</span> Logistic, x+r*x.*(1-x/K)
    <span class="fu">2:</span> Ricker, (1+r)*x.*exp(-(log(1+r)/K)*x)
    <span class="fu">3:</span> Beverton-Holt, (1+r)*x./(1+r/K*x)
  <span class="fu">noise:</span>
    <span class="fu">1:</span> uniform noise distribution
    <span class="fu">2:</span> lognormal noise distribution
  <span class="fu">id:</span> a unique id number for the scenario (for subsetting and plotting)


<span class="fu">Constants:</span>
  <span class="fu">delta:</span>
    <span class="fu">value:</span> 0.05
    <span class="fu">description:</span> Discount rate
  <span class="fu">Tmax:</span>
    <span class="fu">value:</span> 10
    <span class="fu">description:</span> number of years (iterations) over which policy is optimized
  <span class="fu">x_grid:</span>
    <span class="fu">value:</span> linspace(0,200,201)
    <span class="fu">description:</span> True stock size
  <span class="fu">y_grid:</span>
    <span class="fu">value:</span> linspace(0,200,201)
    <span class="fu">description:</span> Observed stock size
  <span class="fu">h_grid:</span>
    <span class="fu">value:</span> linspace(0,120,121)
    <span class="fu">description:</span> Implemented harvest
  <span class="fu">q_grid:</span>
    <span class="fu">value:</span> linspace(0,120,121)
    <span class="fu">description:</span> Target harvest quota

<span class="fu">Notes:</span>
  See the scenarios.m file to confirm values of constants used.</code></pre>
<h2 id="source-code-version-archives">Source code / version archives</h2>
<ul>
<li><p>Data for all the plots shown appears in <a href="https://github.com/cboettig/multiple_uncertainty/blob/4c71612448eb6f33378235e786d149abc8ce0074/inst/matlab/scenarios.csv">scenarios.csv</a>. Because my collaborators have me using Matlab for this and Matlab can neither (afaik) write headers to csv files, append to csv files, or even conviently export non-numeric and numeric data (I write a matrix to the csv file), you’ll just have to consult the <a href="https://github.com/cboettig/multiple_uncertainty/blob/25cc46841908c6ca4da92b8866b836bfeddd707f/inst/matlab/scenarios_meta.txt">scenarios_meta.txt</a> for relevant information.</p></li>
<li><p>All results shown here correspond to files that can be found in <a href="https://github.com/cboettig/multiple_uncertainty/tree/4c71612448eb6f33378235e786d149abc8ce0074/inst/matlab">Commit 4c71612</a>, including the data file. The SVG plots are hosted through the gh-pages branch of the repo, and thus show the most recent versions of those plots. The names have been tagged with the commit hash to avoid accidentally overwriting when programatically generating images. (Clearly that’s not ideal, but cannot link directly to version and have it render).</p></li>
<li><p>Results generated by running <a href="https://github.com/cboettig/multiple_uncertainty/blob/4c71612448eb6f33378235e786d149abc8ce0074/inst/matlab/scenarios.m">scenarios.m</a></p></li>
</ul>
<p><strong>Functions</strong></p>
<ul>
<li>The main routine is (still) in <a href="https://github.com/cboettig/multiple_uncertainty/blob/4c71612448eb6f33378235e786d149abc8ce0074/inst/matlab/multiple_uncertainty.m">multiple_uncertainty.m</a></li>
<li>The scenario template over which we loop is defined as a seperate function in <a href="https://github.com/cboettig/multiple_uncertainty/blob/4c71612448eb6f33378235e786d149abc8ce0074/inst/matlab/scenario.m">scenario.m</a></li>
<li>scenarios.m also calls the script <a href="https://github.com/cboettig/multiple_uncertainty/blob/4c71612448eb6f33378235e786d149abc8ce0074/inst/matlab/plot_scenarios.m">plot_scenarios.m</a>, which can be run to generate the plots from scenarios.csv directly without first regenerating the results data.</li>
</ul>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2014/05/02/multiple-uncertainty-notes.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="col-md-3">
          <header><h4><a href="/2014/04/29/notes.html">Notes</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 29 Apr 2014</p>

<article>
<div class="excerpt">
<h2 id="labnotebook">Labnotebook</h2>
<ul>
<li>Configure Github CDN</li>
<li>Hmm, <a href="https://github.com/ixti/jekyll-assets">jekyll-assets</a>. Not sure that this is preferable from just using the makefile to compile and minify assets seperately as needed.</li>
<li>Move <code>www.carlboettiger.info</code> to host from gh-pages branch of labnotebook. This self-contained system is more standard, and it is strange for other gh-pages hosting to be using the same domain/subdomain to reference content that is actually on a gh-pages branch of some totally different repository.</li>
<li>Updated rakefile for this purpose, based on <a href="http://evansosenko.com/posts/automatic-publishing-github-pages-travis-ci/">evan sosenko’s</a>, and see <a href="https://github.com/razor-x/evansosenko.com">evan’s sources</a></li>
</ul>
<h2 id="packages">packages</h2>
<ul>
<li>fix emergent rfigshare bug due to API change.</li>
<li>Ooh: Trigger <a href="https://github.com/philou/daily-travis">daily automated checks</a> with travis. Could be good for builds too.</li>
</ul>
<h2 id="multiple-uncertainty">multiple-uncertainty</h2>
<ul>
<li>see repo.</li>
</ul>
<h2 id="reading">Reading</h2>
<ul>
<li>Summary of the First Workshop on Sustainable Software for Science: Practice and Experiences (WSSSPE1) http://arxiv.org/abs/1404.7414</li>
<li>PLOSBiology piece by MS Research and friends (Drew Purves): http://doi.org/10.1371/journal.pbio.1001841, also see: https://t.co/ODw9BDNgHe</li>
</ul>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2014/04/29/notes.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
    </div>

    <div class="row">
      
        <div class="col-md-3">
          <header><h4><a href="/2014/04/24/notebook-design-notes.html">Notebook Design Notes</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 24 Apr 2014</p>

<article>
<div class="excerpt">
<p>Reading a little about Flat UI design (<a href="http://www.sitepoint.com/getting-started-flat-ui-design/">1</a>, <a href="http://en.wikipedia.org/wiki/Flat_UI_Design">2</a>). Basic concept is that users now realize they can click on things without them looking like actual three-dimensional buttons. (Along with links, checkboxes, and forms). Frequently seems to use many different <a href="http://flatuicolors.com">colors</a> on a single page to bring some life back, though this might just make the design look like Windows 8 instead. I’ve started noticing this everwhere now that I know what it is.</p>
<p>Easy enough to implement in web design thanks to projects like <a href="http://designmodo.github.io/Flat-UI/">Flat-UI</a>. Not psyched about their colors or components myself, but rather nice to see the way they approach theming Bootstrap 3.1.1 without altering the original Bootstrap css. (Can potentially involve duplicating much of the original LESS).</p>
<p>I’ve found it easy to theme by adding a customized <code>variables.less</code> under the original (thereby overwriting the original where specified while otherwise using the original as default) and then adding my own <code>custom.less</code> at the bottom of the <code>bootstrap.less</code> file that wraps them all together.</p>
<p>Looking into upgrading my css to Twitter <a href="http://getbootstrap.com">Bootstrap 3.1.1</a>. They have replaced a simple Makefile with the rather heavy nodejs based Grunt to compile the css. No doubt there are good reasons for this, but a couple rather terrible gotchas in building from the LESS (see below). Otherwise the upgrades are mostly straight forward with a little regex to adopt the new grid class syntax. After swapping in my old <code>.less</code> files as described above I only needed to update the navigation bar and the accordion folding on categories to have the transition completed. Changes are subtle, but:</p>
<ul>
<li>Design is now flatter, with the navbar and buttons having no 3D shading</li>
<li>multiple-column layout can persist on mobile devices</li>
<li>new (default) fonts</li>
<li><p>Currently on fluid container, which can make the text a bit wide on widesreen displays.</p></li>
<li>Removed the alternative CSS styles. Writing the solarized themes and javascript toggles was a fun exercise but more of an amatuerish trick (that didn’t always reset correctly or provide any real functionality) than a mature feature</li>
<li>Haven’t upgraded the icons, though have added the FontAwesome4 CDN to the header so that these icons can be used anywhere.</li>
<li>Cleaned out some javascript and some old templates, mostly related to search.</li>
<li><p>enabled code toggling with <code>toggleR</code> (on pages with <code>page.code: yes</code>), e.g. <a href="http://www.carlboettiger.info/2012/06/13/Sethi-policy-functions.html">2012-06-13 post</a>.</p></li>
</ul>
<p><strong>Building Bootstrap from LESS</strong></p>
<ul>
<li><p>Can’t work with Ubuntu’s <code>npm</code>, but needs a custom ppa install. <a href="http://stackoverflow.com/questions/23251351/fail-to-install-twitter-bootstrap-node-js-dependencies-on-ubuntu">See SO question and solution</a></p></li>
<li><p>Even then things aren’t ready to run due to crazy-stupid namespace conflict over <code>node</code>. The only thing worse than the uniformative error above is the complete absence of any error at all, again <a href="http://stackoverflow.com/questions/20937313/grunt-command-doesnt-do-anything">resolved thanks to SO</a>.</p></li>
</ul>
<p>After this I am able to start from scrach again and compile the less files. Which is good, since my Makefile fails now (as it seems taht lessc is a <code>nodejs</code> creature anyway and my node environment is completely local, as I’ve removed the conflicting node <code>.deb</code>s installed from apt…). However, it does mean learning to edit the Grunt file in order to make any changes to the build list (e.g. don’t build the docs css), or otherwise just working around these issues. I’ve taken the latter path with a new Makefile that calls Grunt to do the compile and then cleans up and deploys the output as I want, rather than making these edits to the Grunt file directly. By changing less of the boilerplate code, this should be easier to maintain for upgrades.</p>
<p>Developing almost anything (Ruby, R, javascript, haskell, tex, etc) seems to require it’s own package mananger even though these things are packages in Ubuntu distributions. Meanwhile ubuntu focused things all want their own ppa installed. Maybe I should strip my sources.list back to just what ships with the base Ubuntu release since I have to extend this way instead of through <code>apt-get</code> now anyway. Still, surely feels like this is asking for trouble.</p>
<h3 id="github-hosting">Github hosting</h3>
<ul>
<li>Configuring Custom URL / Domain name.</li>
<li><p>Configuring <a href="https://github.com/blog/1715-faster-more-awesome-github-pages">Github CDN</a> with custom domain. Not quite clear how this works, see query to <a href="http://webmasters.stackexchange.com/questions/56826/do-i-set-a-dns-a-record-for-the-new-github-pages-to-use-their-cdn/56862#56862">webmasters SO</a>.</p></li>
<li><p><strong>Edit</strong>: Relatively straight-forward to fix. Adjusted dreamhost settings for carlboettiger.info from DNS to a redirect to www.carlboettiger.info. With the CNAME already set for www.carlboettiger.info and the Github CNAME configured, the rest is automatic. Yay for for a free and easy CDN from Github.</p></li>
<li><p>Have to wonder: is it then still worth using alternative CDNs, e.g. for CSS and Javascript. Currently MathJax, FontAwesome4 icons, JQuery, and Twitter Bootstrap Javascript are all on external CDNs.</p></li>
<li></li>
</ul>
<h3 id="version-managing-the-output-as-well-as-the-source">Version managing the output (as well as the source)</h3>
<p>Checkout git by date:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">git</span> rev-list -n1 --before=2013-7-4 master <span class="kw">|</span> <span class="kw">xargs</span> git checkout</code></pre>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2014/04/24/notebook-design-notes.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="col-md-3">
          <header><h4><a href="/2014/04/23/multiple-uncertainty-notes.html">Multiple Uncertainty Notes</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 23 Apr 2014</p>

<article>
<div class="excerpt">
<h2 id="multiple-uncertainty">Multiple uncertainty</h2>
<p>Handling variation in different grids. Cleaned up a bunch of transpose expressions in the code and make sure that dimensions are always properly aligned. Now problem can be solved on arbitrarily different grid discritizations for stock <span class="math">\(x\)</span>, observed stock <span class="math">\(y\)</span>, harvest <span class="math">\(h\)</span> and quota <span class="math">\(q\)</span>. See <a href="https://github.com/cboettig/multiple_uncertainty/blob/61e34979df93617e6229a6031ea624934acbe93c/inst/matlab/multiple_uncertainty.m">multiple_uncertainty.m</a> and example calls in <a href="https://github.com/cboettig/multiple_uncertainty/blob/61e34979df93617e6229a6031ea624934acbe93c/inst/matlab/testing.m">testing.m</a></p>
<p>Taking a look a how we handle normalization when some of the probability density falls outside the discritized space. Currently we just renormalize, which distributes the weights over all non-zero weighted points. Might be more reasonable to map all that probability to the boundary, though this is tricky. I’ve taken a stab at this based on only normalizing the resulting matrix without knowing the underlying pdf, which has some challenges. See unused function: <a href="https://github.com/cboettig/multiple_uncertainty/blob/61e34979df93617e6229a6031ea624934acbe93c/inst/matlab/norm_pile_bdry.m">norm_pile_bdry.m</a></p>
<p>Also added line to enforce the assumption that quota should not exceed assessment estimate, though certainly it is sometimes optimal that it should when either implementation or measurement are uncertain. This seems easiest to enforce by just setting those terms in the value matrix to zero:</p>
<pre class="sourceCode matlab"><code class="sourceCode matlab"> V = tril(V);</code></pre>
<p>(see in code, <a href="https://github.com/cboettig/multiple_uncertainty/blob/61e34979df93617e6229a6031ea624934acbe93c/inst/matlab/multiple_uncertainty.m#L111">#L111</a>)</p>
<h3 id="lognormal">lognormal</h3>
<figure>
<img src="http://cboettig.github.com/multiple_uncertainty/lognormal_multiple_uncertainty.svg" />
</figure>
<h3 id="uniform">Uniform</h3>
<figure>
<img src="http://cboettig.github.com/multiple_uncertainty/multiple_uncertainty.svg" />
</figure>
<h3 id="comparisons">Comparisons</h3>
<p>Took a quick look at Paul’s code yesterday. He does enforce the quota &lt;= assessment value, which while a logical constraint, is also trivially sub-optimal for some certain measurement and implementation uncertainty.</p>
<p>It also looks like he has a very coarse grid for the shocks, which I don’t quite understand. It looks like each of the uncertainties is defined as a set of weights over only 7 points; I’m not quite sure why that is so low when he uses quite a fine grid for the state space and action space. I define my shocks over the same grid as the state space.</p>
<p>His approach looks quite interesting: he enumerates all possible combinations of state-action pairs and computes the expected reward at each of these pairs ahead of time as part of the model statement, as a sum over all possible measurement and implementation shocks:</p>
<pre class="sourceCode matlab"><code class="sourceCode matlab">R=<span class="fl">0</span>;
for i=<span class="fl">1</span>:length(zi)      <span class="co">% Grid size for implementation error</span>
  for j=<span class="fl">1</span>:length(zm)    <span class="co">% Grid size for measurement error</span>
    R=R + harv(X(:,<span class="fl">1</span>) / zm(j), X(:,<span class="fl">2</span>), zi(i)) * pm(j) * pi(i);
  end
end</code></pre>
<p>Which might be read as:</p>
<p><span class="math">\[ \sum_i \sum_j \min \left(\textrm{assessed stock} / \textrm{measurement grid}_j,  \textrm{quota} * \textrm{implementation grid}_i\right)   * \textrm{measurement shock}_j * \textrm{implementation shock}_i \]</span></p>
<p>(Not clear to me why assessed stock is divided by the grid.)</p>
<p>He also computes these grids for the uncertainty, ee=rectgrid(zg,zi,zm,zm), where zg is the growth uncertainty grid, etc. Again I like this, as it seems like a nice abstraction of the uncertainty process, but I can’t quite penetrate what this does but he uses it to create the transition matrix, P, through some g2P function I haven’t looked at. Also not sure why zm appears twice, though perhaps it is related to handling both the current and predicted stock sizes (after all, the M matrix appears twice in my equations too).</p>
<p>For a lark I tried setting the uncertainty grids to match the state space grid, all having 100 points. This has been running overnight…</p>
<p>Anyway, it looks clever and I which I had a better idea of how he was setting up the model, and what discretizations and assumptions were being made.</p>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2014/04/23/multiple-uncertainty-notes.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="col-md-3">
          <header><h4><a href="/2014/04/18/notes.html">Notes</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 18 Apr 2014</p>

<article>
<div class="excerpt">
<h2 id="eml">EML</h2>
<p>I’ve added a interface for custom units. You don’t have to mess around with <code>additionalMetadata</code> as it should be handled automatically. Just define the unit itself, like this <a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>:</p>
<pre class="sourceCode coffee"><code class="sourceCode coffee">  create_custom_unit<span class="kw">(</span>id <span class="kw">=</span> <span class="st">&quot;metersSquaredPerHectare&quot;</span><span class="kw">,</span>
                     parentSI <span class="kw">=</span> <span class="st">&quot;dimensionless&quot;</span><span class="kw">,</span>
                     unitType <span class="kw">=</span> <span class="st">&quot;dimensionless&quot;</span><span class="kw">,</span>
                     multiplierToSI <span class="kw">=</span> <span class="st">&quot;0.0001&quot;</span><span class="kw">,</span>
                     description <span class="kw">=</span> <span class="st">&quot;Square meters per hectare&quot;</span><span class="kw">)</span></code></pre>
<p>and then use the <code>id</code> you give as the unit type in your <code>unit.defs</code>. <code>create_custom_unit</code> updates a <code>custom_units</code> list in the <code>EMLConfig</code> environment, which the <code>eml</code> or <code>write_eml</code> functions detect and use to write in the additional metadata. <a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a></p>
<p>If the custom unit is not defined and the session is interactive, EML will prompt for essential fields in the unit definition. Other optional fields are also described in the documentation.</p>
<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Note that I just use “dimensionless” as an illustration here, a the better choice might perhaps be to define an area/area <code>unitType</code> as <span class="citation" data-cites="mbjones">@mbjones</span> discusses in #12. (We’ll add support for OBOE semantics eventually, but that’s much more complex)<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>This isn’t ideal, since the use of environments means the function has “side effects” and you could inadvertently include unit definitions you defined for some other reason in your EML file (if you didn’t do <code>eml_reset_config()</code> or start a fresh R session). That wouldn’t break anything technical, but would seem a bit strange to define units you didn’t use. The environment mechanism can be avoided by explicitly passing list of custom_units to the <code>eml</code> or <code>eml_write</code> functions.<a href="#fnref2">↩</a></p></li>
</ol>
</section>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2014/04/18/notes.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
    </div>

  </div>
</div> <!--end row -->

<div class="row socialicons">
  <div class="col-md-11 col-md-offset-1">
      <p> <a href="/archive.html"><i class="icon-calendar"></i> All entries by date</a></p> 
      <p> <a href="/categories.html"><i class="icon-list"></i> All entries by category</a> </p>
      <p> <a href="/tags.html"><i class="icon-tags"></i> All entries by tag</a> </p>
  </div> <!--end col-md-9 -->
</div> <!--end row -->




      <footer class="footer">

<!--************** FOAF information to social networks ***************************** -->
  <div class="row">
    <div class="col-md-3 col-xs-4 socialicons" style="font-size:20px" typeof="foaf:Person" about="http://www.carlboettiger.info#me">
      <p>
          <script type="text/javascript" src="/assets/js/obfuscate-email-link.js" language="javascript"></script> 

          <a rel="foaf:account" alt="twitter" href="https://twitter.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Twitter'); 
             return false;"><span class="showtooltip" title="follow me on twitter (reading, discussing)"><i class="icon-twitter"></i></span></a> 

          <a rel="foaf:account" alt="github" href="https://github.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Github'); 
             return false;"><span class="showtooltip" title="follow me on Github (code, research)"><i class="icon-github"></i></span></a>
      <!--
          <a rel="foaf:account" href="https://plus.google.com/" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'GPlus'); 
             return false;"><i class="icon-google-plus"></i></a>

          <a rel="foaf:account" href="http://www.mendeley.com/profiles/carl-boettiger" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Mendeley'); 
             return false;"><img src="/assets/img/icon-mendeley.png" alt="mendeley" /></a> 

           citations on google-scholar

           stackoverflow
      -->
      <a alt="rss" rel="foaf:weblog", type="application/atom+xml" href="/blog.xml"  
         class="showtooltip" title="RSS feeds for my blog-style entries. See the feed on my lab notebook (/atom.xml) to follow all entries instead." 
         onclick="recordOutboundLink(this, 'Outbound Links', 'RSS'); 
         return false;"><i class="icon-rss"></i></a>
       </p>
    </div>

    
    <!--**************** End social links **************************** -->


    <div class="col-md-4 col-md-offset-1 col-xs-4">
      <p><a onclick="recordOutboundLink(this, 'Outbound Links', 'ONS_claim'); return false;" href="http://onsclaims.wikispaces.com/"><img src="/assets/img/ons-aci2-icon.svg" alt="ONS" class="showtooltip" title="An Open Notebook Science (ONS) project claim: Entry provides all content (AC) immediately (I) or without significant delay.  See link for details"/></a></p>
    </div>


    <div class="col-md-3 col-md-offset-1 col-xs-4">
      <p>
      <a rel="license" property="http://creativecommons.org/ns#license" href="http://creativecommons.org/publicdomain/zero/1.0/" onclick="recordOutboundLink(this, 'Outbound Links', 'CC0'); return false;"><img src="/assets/img/cc-zero.svg" alt="CC0"/></a> 
      </p>
    </div>
  </div>


  
<!-- COinS metadata (for citation managers like Zotero etc), goes in body text -->
  <span
      class="Z3988" 
      title="ctx_ver=Z39.88-2004
      &amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc
      &amp;rfr_id=info%3Asid%2Focoins.info%3Agenerator
      &amp;rft.title=Lab Notebook
      &amp;rft.creator=Carl Boettiger
      &amp;rft.date=
      &amp;rft.language=EN
      &amp;rft.rights=CC0
      &amp;rft_id=http://www.carlboettiger.info/lab-notebook.html">
  </span>


</footer>




          <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

    <!-- JQuery, used on a few pages (still?) -->
    <!-- <script type="text/javascript" src="/assets/js/jquery.js"></script> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <!-- Equations using MathJax -->
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "all"} } });       </script>
    <!-- Twitter Bootstrap Javascript -->
    <!--  <script src="/assets/js/bootstrap.min.js"></script> -->
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>


    

        <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-18401403-1']);
          _gaq.push(['_trackPageview']);
          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
  </script>



<script type="text/javascript">
function recordOutboundLink(link, category, action) {
  try {
    var pageTracker=_gat._getTracker("UA-18401403-1");
    pageTracker._trackEvent(category, action);
    setTimeout('document.location = "' + link.href + '"', 100)
  }catch(err){}
}
</script>




    </div>
  </body>
</html>
   

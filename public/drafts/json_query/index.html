<pre class="r"><code>library(tidyverse)
library(jsonlite)
#library(printr)

knitr::opts_chunk$set(comment=&quot;&quot;)</code></pre>
<pre class="r"><code>options(stringsAsFactors=FALSE)
x &lt;- data.frame(driver = c(&quot;Bowser&quot;, &quot;Peach&quot;), occupation = c(&quot;Koopa&quot;, &quot;Princess&quot;))
x$vehicle &lt;- data.frame(model = c(&quot;Piranha Prowler&quot;, &quot;Royal Racer&quot;))
x$vehicle$stats &lt;- data.frame(speed = c(55, 34), weight = c(67, 24), drift = c(35, 32))
dat &lt;- toJSON(x, pretty = TRUE)
dat</code></pre>
<pre><code>[
  {
    &quot;driver&quot;: &quot;Bowser&quot;,
    &quot;occupation&quot;: &quot;Koopa&quot;,
    &quot;vehicle&quot;: {
      &quot;model&quot;: &quot;Piranha Prowler&quot;,
      &quot;stats&quot;: {
        &quot;speed&quot;: 55,
        &quot;weight&quot;: 67,
        &quot;drift&quot;: 35
      }
    }
  },
  {
    &quot;driver&quot;: &quot;Peach&quot;,
    &quot;occupation&quot;: &quot;Princess&quot;,
    &quot;vehicle&quot;: {
      &quot;model&quot;: &quot;Royal Racer&quot;,
      &quot;stats&quot;: {
        &quot;speed&quot;: 34,
        &quot;weight&quot;: 24,
        &quot;drift&quot;: 32
      }
    }
  }
] </code></pre>
<pre class="r"><code>df &lt;- fromJSON(dat)
df</code></pre>
<pre><code>  driver occupation   vehicle.model vehicle.stats.speed
1 Bowser      Koopa Piranha Prowler                  55
2  Peach   Princess     Royal Racer                  34
  vehicle.stats.weight vehicle.stats.drift
1                   67                  35
2                   24                  32</code></pre>
<pre class="r"><code>library(dplyr)
## Errors: can&#39;t have &lt;data.frame&gt; columns in tidyverse land
df %&gt;% filter(driver == &quot;Peach&quot;) </code></pre>
<pre><code>Error: Column `vehicle` must be a 1d atomic vector or a list</code></pre>
<p>We can flatten it of course:</p>
<pre class="r"><code>df &lt;- fromJSON(dat, flatten = TRUE)
df</code></pre>
<pre><code>  driver occupation   vehicle.model vehicle.stats.speed
1 Bowser      Koopa Piranha Prowler                  55
2  Peach   Princess     Royal Racer                  34
  vehicle.stats.weight vehicle.stats.drift
1                   67                  35
2                   24                  32</code></pre>
<pre class="r"><code>library(dplyr)
df %&gt;% filter(driver == &quot;Peach&quot;) </code></pre>
<pre><code>  driver occupation vehicle.model vehicle.stats.speed vehicle.stats.weight
1  Peach   Princess   Royal Racer                  34                   24
  vehicle.stats.drift
1                  32</code></pre>
<hr />
<p>But what we want is data that looks like this:</p>
<pre class="r"><code>dat2 &lt;- fromJSON(dat, simplifyDataFrame = FALSE)
df2 &lt;- data_frame(driver = map_chr(dat2, &quot;driver&quot;), 
                 occupation = map_chr(dat2, &quot;occupation&quot;), 
                 vehicle = map(dat2, &quot;vehicle&quot;))

## RStudio notebook&#39;s pretty print has some trouble formatting this...
df2</code></pre>
<pre><code># A tibble: 2 x 3
  driver occupation    vehicle
   &lt;chr&gt;      &lt;chr&gt;     &lt;list&gt;
1 Bowser      Koopa &lt;list [2]&gt;
2  Peach   Princess &lt;list [2]&gt;</code></pre>
<pre class="r"><code>df2 %&gt;% filter(driver == &quot;Peach&quot;) %&gt;% getElement(&quot;vehicle&quot;)</code></pre>
<pre><code>[[1]]
[[1]]$model
[1] &quot;Royal Racer&quot;

[[1]]$stats
[[1]]$stats$speed
[1] 34

[[1]]$stats$weight
[1] 24

[[1]]$stats$drift
[1] 32</code></pre>
<pre class="r"><code>df2[df2$driver == &quot;Peach&quot;,&quot;vehicle&quot;]</code></pre>
<pre><code># A tibble: 1 x 1
     vehicle
      &lt;list&gt;
1 &lt;list [2]&gt;</code></pre>
<hr />
<div id="additional-examples" class="section level2">
<h2>additional examples</h2>
<p>Consider some nested json data:</p>
<pre class="r"><code>aut &lt;- &#39;{
&quot;authors&quot;: [
{
&quot;name&quot;: &quot;Person A&quot;,
&quot;address&quot;: {
  &quot;street&quot;: &quot;A street&quot;,
  &quot;city&quot;: &quot;A city&quot;,
  &quot;coordinates&quot;: {&quot;north&quot;: 10,
                  &quot;west&quot;: 20
                  }
  }
},
{
&quot;name&quot;: &quot;Person B&quot;,
&quot;address&quot;: {
  &quot;street&quot;: &quot;B street&quot;,
  &quot;city&quot;: &quot;B city&quot;
  }
},
{
&quot;name&quot;: &quot;Person C&quot;
}]
}&#39;</code></pre>
<p>Is there a good (rboust, simple) way to map such data into a data.frame which uses list-columns?</p>
<pre class="r"><code>out &lt;- fromJSON(aut, flatten = FALSE)
## WTF why is this showing up as flattened?
out</code></pre>
<pre><code>$authors
      name address.street address.city address.coordinates.north
1 Person A       A street       A city                        10
2 Person B       B street       B city                        NA
3 Person C           &lt;NA&gt;         &lt;NA&gt;                        NA
  address.coordinates.west
1                       20
2                       NA
3                       NA</code></pre>
<pre class="r"><code>out[[1]]$address</code></pre>
<pre><code>    street   city coordinates.north coordinates.west
1 A street A city                10               20
2 B street B city                NA               NA
3     &lt;NA&gt;   &lt;NA&gt;                NA               NA</code></pre>
</div>
